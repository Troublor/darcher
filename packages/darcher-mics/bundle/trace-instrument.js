module.exports=(()=>{"use strict";var t={362:function(t,e,r){var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),o=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||n(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),o(r(240),e),o(r(825),e)},240:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=void 0;var r=function(){function t(t,e){this.module=t,this.level=e}return t.prototype.parseLog=function(e,r,n){var o,a=new Date,i=a.getMonth().toString().padStart(2,"0")+"-"+a.getDay().toString().padStart(2,"0")+"|"+a.getHours().toString().padStart(2,"0")+":"+a.getMinutes().toString().padStart(2,"0")+":"+a.getSeconds().toString().padStart(2,"0")+"."+a.getMilliseconds().toString().padEnd(3,"0").slice(0,3),s=function(t,e){return e},c="";if(n)for(var u in n)n.hasOwnProperty(u)&&(c+=s(0,u)+"="+(null===(o=n[u])||void 0===o?void 0:o.toString())+" ");return s(0,t.Level.levelString(e).padEnd(5," "))+"["+i+"]["+this.module+"] "+r.toString().padEnd(48," ")+" "+c},t.prototype.log=function(e,r,n){if(this.level<=e)switch(this.level){case t.Level.ERROR:console.error(this.parseLog(e,r,n));break;case t.Level.WARN:console.warn(this.parseLog(e,r,n));break;case t.Level.INFO:console.info(this.parseLog(e,r,n));break;case t.Level.DEBUG:console.debug(this.parseLog(e,r,n));break;default:console.log(this.parseLog(e,r,n))}},t.prototype.info=function(e,r){this.log(t.Level.INFO,e,r)},t.prototype.warn=function(e,r){this.log(t.Level.WARN,e,r)},t.prototype.debug=function(e,r){this.log(t.Level.DEBUG,e,r)},t.prototype.error=function(e,r){this.log(t.Level.ERROR,e,r)},t.Level={DEBUG:1,INFO:2,WARN:3,ERROR:4,levelString:function(t){switch(t){case 1:return"DEBUG";case 2:return"INFO";case 3:return"WARN";case 4:return"ERROR";default:return"UNKNOWN"}}},t}();e.Logger=r},825:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.prettifyHash=void 0,e.prettifyHash=function(t){var e=0;return t.startsWith("0x")&&(e=2),t.substring(e,e+6)+"â€¦"+t.substring(t.length-6,t.length)}},846:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,a){function i(t){try{c(n.next(t))}catch(t){a(t)}}function s(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,s)}c((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.traceSend=e.traceSendAsync=e.getStackTraceByCrawljax=void 0;var a=r(362),i=new a.Logger("Trace",a.Logger.Level.INFO);function s(t,e){return n(this,void 0,void 0,(function(){return o(this,(function(r){return[2,new Promise((function(r,n){var o=new WebSocket(t);o.onopen=function(){o.send(JSON.stringify(e))},o.onerror=function(t){n(t)},o.onmessage=function(t){var e=JSON.parse(t.data);r(e),o.close()}}))]}))}))}function c(t,e,r){var n={method:t,params:e,stack:null};if(["eth_sendTransaction","eth_sendRawTransaction","eth_estimateGas"].includes(t)){var o={stack:void 0};Error.captureStackTrace(o,c),r=new Proxy(r,{apply:function(r,s,c){if("eth_estimateGas"===t)n.params[0].gas=c[1],n.stack=o.stack.split(/\n/).map((function(t){return t.trim()})).filter((function(t){return t.length>0&&"Error"!==t})),window.traceHistories.push(n);else if(["eth_sendTransaction","eth_sendRawTransaction"].includes(t)){for(var u=function(t){var r=window.traceHistories[t];if("eth_estimateGas"===r.method&&r.params[0]&&e[0]&&r.params[0].from===e[0].from&&r.params[0].to===e[0].to&&r.params[0].data===e[0].data)return window.traceHistories=window.traceHistories.filter((function(t){return t!==r})),n.stack=r.stack,"break"},l=window.traceHistories.length-1;l>=0&&"break"!==u(l);l--);n.stack||(n.stack=o.stack.split(/\n/).map((function(t){return t.trim()})).filter((function(t){return t.length>0&&"Error"!==t})));var f={hash:c[1],stack:n.stack};i.info("Transaction trace",{hash:a.prettifyHash(f.hash),stack:f.stack});var p=new WebSocket("ws://localhost:1236");p.onopen=function(){p.send(JSON.stringify(f))},p.onerror=function(t){i.error("Send transaction trace error",{err:t})},p.onmessage=function(){p.close()}}r.apply(s,c)}})}return r}e.getStackTraceByCrawljax=function(){return n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,s("ws://localhost:1237",{type:"FetchStackTrace",stack:[]})];case 1:return[2,t.sent().stack]}}))}))},"undefined"==typeof window||window.traceHistories||(window.traceHistories=[]),e.traceSendAsync=c,e.traceSend=function(t,e){if("eth_sendTransaction"===t||"eth_sendRawTransaction"===t){var r={stack:void 0};Error.captureStackTrace(r,c);var n={hash:e,stack:r.stack.split(/\n/).map((function(t){return t.trim()})).filter((function(t){return t.length>0&&"Error"!==t}))};i.info("Transaction trace",{hash:a.prettifyHash(n.hash),stack:n.stack});var o=new WebSocket("ws://localhost:1236");o.onopen=function(){o.send(JSON.stringify(n))},o.onerror=function(t){i.error("Send transaction trace error",{err:t})},o.onmessage=function(){o.close()}}}}},e={};return function r(n){if(e[n])return e[n].exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,r),o.exports}(846)})();
//# sourceMappingURL=trace-instrument.js.map