{"version":3,"sources":["webpack://@darcher/misc/../darcher-helpers-browser/dist/index.js","webpack://@darcher/misc/../darcher-helpers-browser/dist/log.js","webpack://@darcher/misc/../darcher-helpers-browser/dist/utility.js","webpack://@darcher/misc/webpack/bootstrap","webpack://@darcher/misc/./src/metamask-notifier.ts"],"names":["__createBinding","this","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__exportStar","exports","p","prototype","hasOwnProperty","call","value","Logger","module","level","parseLog","message","context","_a","now","Date","logTime","getMonth","toString","padStart","getDay","getHours","getMinutes","getSeconds","getMilliseconds","padEnd","slice","colored","payload","contextLiteral","key","Level","levelString","log","ERROR","console","error","WARN","warn","INFO","info","DEBUG","debug","lvl","prettifyHash","hash","startIndex","startsWith","substring","length","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","address","logger","start","ws","WebSocket","onmessage","msg","onMessage","data","onerror","e","onError","onclose","onClose","onopen","err","setTimeout","notify","send","JSON","stringify","notifyUnapprovedTx","from","to","notifyUnlockRequest","notifyPermissionRequest","notifyUnconfirmedMessage"],"mappings":"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","file":"metamask-notifier.js","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./log\"), exports);\n__exportStar(require(\"./utility\"), exports);\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Logger = void 0;\nvar Logger = /** @class */ (function () {\n    function Logger(module, level) {\n        this.module = module;\n        this.level = level;\n    }\n    Logger.prototype.parseLog = function (level, message, context) {\n        var _a;\n        var now = new Date();\n        var month = now.getMonth().toString().padStart(2, \"0\");\n        var day = now.getDay().toString().padStart(2, \"0\");\n        var hour = now.getHours().toString().padStart(2, \"0\");\n        var minute = now.getMinutes().toString().padStart(2, \"0\");\n        var second = now.getSeconds().toString().padStart(2, \"0\");\n        var millisecond = now.getMilliseconds().toString().padEnd(3, \"0\").slice(0, 3);\n        var logTime = month + \"-\" + day + \"|\" + hour + \":\" + minute + \":\" + second + \".\" + millisecond;\n        var colored = function (level, payload) {\n            // TODO coloring in Browser Console\n            return payload;\n        };\n        var contextLiteral = \"\";\n        if (context) {\n            for (var key in context) {\n                if (context.hasOwnProperty(key)) {\n                    // @ts-ignore\n                    contextLiteral += colored(level, key) + \"=\" + ((_a = context[key]) === null || _a === void 0 ? void 0 : _a.toString()) + \" \";\n                }\n            }\n        }\n        return colored(level, Logger.Level.levelString(level).padEnd(5, \" \")) + \"[\" + logTime + \"][\" + this.module + \"] \" + message.toString().padEnd(48, \" \") + \" \" + contextLiteral;\n    };\n    Logger.prototype.log = function (level, message, context) {\n        if (this.level <= level) {\n            switch (this.level) {\n                case Logger.Level.ERROR:\n                    console.error(this.parseLog(level, message, context));\n                    break;\n                case Logger.Level.WARN:\n                    console.warn(this.parseLog(level, message, context));\n                    break;\n                case Logger.Level.INFO:\n                    console.info(this.parseLog(level, message, context));\n                    break;\n                case Logger.Level.DEBUG:\n                    console.debug(this.parseLog(level, message, context));\n                    break;\n                default:\n                    console.log(this.parseLog(level, message, context));\n            }\n        }\n    };\n    Logger.prototype.info = function (message, context) {\n        this.log(Logger.Level.INFO, message, context);\n    };\n    Logger.prototype.warn = function (message, context) {\n        this.log(Logger.Level.WARN, message, context);\n    };\n    Logger.prototype.debug = function (message, context) {\n        this.log(Logger.Level.DEBUG, message, context);\n    };\n    Logger.prototype.error = function (message, context) {\n        this.log(Logger.Level.ERROR, message, context);\n    };\n    Logger.Level = {\n        DEBUG: 1,\n        INFO: 2,\n        WARN: 3,\n        ERROR: 4,\n        levelString: function (lvl) {\n            switch (lvl) {\n                case 1:\n                    return 'DEBUG';\n                case 2:\n                    return 'INFO';\n                case 3:\n                    return 'WARN';\n                case 4:\n                    return 'ERROR';\n                default:\n                    return 'UNKNOWN';\n            }\n        }\n    };\n    return Logger;\n}());\nexports.Logger = Logger;\n//# sourceMappingURL=log.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.prettifyHash = void 0;\nfunction prettifyHash(hash) {\n    var startIndex = 0;\n    if (hash.startsWith(\"0x\")) {\n        startIndex = 2;\n    }\n    return hash.substring(startIndex, startIndex + 6) + \"\\u2026\" + hash.substring(hash.length - 6, hash.length);\n}\nexports.prettifyHash = prettifyHash;\n//# sourceMappingURL=utility.js.map","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\"use strict\"\n\nimport {Logger} from \"@darcher/helpers-browser\";\n\nexport interface Data {\n    type: string\n}\n\nexport interface UnlockRequest extends Data {\n    type: 'UnlockRequest',\n}\n\nexport interface PermissionRequest extends Data {\n    type: 'PermissionRequest',\n}\n\nexport interface UnconfirmedMessage extends Data {\n    type: 'UnconfirmedMessage',\n}\n\nexport interface UnapprovedTx extends Data {\n    type: \"UnapprovedTx\",\n    from: string,\n    to: string,\n    gas: string,\n    gasPrice: string,\n    value: string,\n    hash?: string,\n}\n\nexport default class MetaMaskNotifier {\n    private ws: WebSocket;\n    private logger: Logger;\n\n    constructor(\n        private readonly address: string,\n    ) {\n        this.logger = new Logger('MetaMask-Notifier', Logger.Level.DEBUG);\n    }\n\n    public start() {\n        this.ws = new WebSocket(this.address);\n        this.ws.onmessage = msg => this.onMessage(msg.data);\n        this.ws.onerror = e => this.onError(e);\n        this.ws.onclose = () => this.onClose();\n        this.ws.onopen = () => this.logger.info(\"WebSocket connection opened\");\n    }\n\n    public onMessage(payload: string) {\n        this.logger.debug(\"receive message\", {msg: payload});\n    }\n\n    public onError(err: any) {\n        this.logger.error(err);\n    }\n\n    public onClose() {\n        this.ws = undefined;\n        this.logger.info(\"WebSocket connection closed\");\n        // try to reconnect\n        setTimeout(() => {\n            this.logger.warn(\"reconnecting...\");\n            this.start();\n        }, 1000);\n    }\n\n    private notify(data: Data) {\n        if (!this.ws) {\n            this.logger.error(\"WebSocket not connected, fail to notify new transaction:\", data);\n            return;\n        }\n        try {\n            this.ws.send(JSON.stringify(data));\n        } catch (e) {\n            this.logger.error(\"Notify error\", {err: e});\n        }\n    }\n\n    public notifyUnapprovedTx(data: UnapprovedTx) {\n        this.logger.debug(\"Notify unapproved transaction\", {from: data.from, to: data.to});\n        this.notify(data);\n    }\n\n    public notifyUnlockRequest(data: UnlockRequest) {\n        this.logger.debug(\"Notify unlock request\");\n        this.notify(data);\n    }\n\n    public notifyPermissionRequest(data: PermissionRequest) {\n        this.logger.debug(\"Notify permission request\");\n        this.notify(data);\n    }\n\n    public notifyUnconfirmedMessage(data: UnconfirmedMessage) {\n        this.logger.debug(\"Notify unconfirmed message\");\n        this.notify(data);\n    }\n}\n\n"],"sourceRoot":""}