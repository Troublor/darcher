module.exports=(()=>{"use strict";var t={31:t=>{t.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},362:function(t,e,r){var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),o=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||n(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),o(r(240),e),o(r(825),e)},240:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=void 0;var r=function(){function t(t,e){this.module=t,this.level=e}return t.prototype.parseLog=function(e,r,n){var o,a=new Date,i=a.getMonth().toString().padStart(2,"0")+"-"+a.getDay().toString().padStart(2,"0")+"|"+a.getHours().toString().padStart(2,"0")+":"+a.getMinutes().toString().padStart(2,"0")+":"+a.getSeconds().toString().padStart(2,"0")+"."+a.getMilliseconds().toString().padEnd(3,"0").slice(0,3),s=function(t,e){return e},c="";if(n)for(var u in n)n.hasOwnProperty(u)&&(c+=s(0,u)+"="+(null===(o=n[u])||void 0===o?void 0:o.toString())+" ");return s(0,t.Level.levelString(e).padEnd(5," "))+"["+i+"]["+this.module+"] "+r.toString().padEnd(48," ")+" "+c},t.prototype.log=function(e,r,n){if(this.level<=e)switch(this.level){case t.Level.ERROR:console.error(this.parseLog(e,r,n));break;case t.Level.WARN:console.warn(this.parseLog(e,r,n));break;case t.Level.INFO:console.info(this.parseLog(e,r,n));break;case t.Level.DEBUG:console.debug(this.parseLog(e,r,n));break;default:console.log(this.parseLog(e,r,n))}},t.prototype.info=function(e,r){this.log(t.Level.INFO,e,r)},t.prototype.warn=function(e,r){this.log(t.Level.WARN,e,r)},t.prototype.debug=function(e,r){this.log(t.Level.DEBUG,e,r)},t.prototype.error=function(e,r){this.log(t.Level.ERROR,e,r)},t.Level={DEBUG:1,INFO:2,WARN:3,ERROR:4,levelString:function(t){switch(t){case 1:return"DEBUG";case 2:return"INFO";case 3:return"WARN";case 4:return"ERROR";default:return"UNKNOWN"}}},t}();e.Logger=r},825:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.prettifyHash=void 0,e.prettifyHash=function(t){var e=0;return t.startsWith("0x")&&(e=2),t.substring(e,e+6)+"â€¦"+t.substring(t.length-6,t.length)}},846:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,a){function i(t){try{c(n.next(t))}catch(t){a(t)}}function s(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,s)}c((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.traceSend=e.traceSendAsync=e.getStackTraceByCrawljax=void 0;var a,i,s=r(362),c=new s.Logger("Trace",s.Logger.Level.INFO);function u(t,e){return n(this,void 0,void 0,(function(){return o(this,(function(r){return[2,new Promise((function(r,n){var o=new WebSocket(t);o.onopen=function(){o.send(JSON.stringify(e))},o.onerror=function(t){n(t)},o.onmessage=function(t){var e=JSON.parse(t.data);r(e),o.close()}}))]}))}))}if(e.getStackTraceByCrawljax=function(){return n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,u("ws://localhost:1237",{type:"FetchStackTrace",stack:[]})];case 1:return[2,t.sent().stack]}}))}))},"undefined"!=typeof window)i=window,a=!0;else{if(void 0===r.g)throw new Error("Failed to load trace-instrument");i=r.g,a=!1}function l(t,e,n){var o={method:t,params:e,stack:null};if(["eth_sendTransaction","eth_sendRawTransaction","eth_estimateGas"].includes(t)){var u={stack:void 0};Error.captureStackTrace(u,l),n=new Proxy(n,{apply:function(n,l,f){if("eth_estimateGas"===t)o.params[0].gas=f[1],o.stack=u.stack.split(/\n/).map((function(t){return t.trim()})).filter((function(t){return t.length>0&&"Error"!==t})),i.traceHistories.push(o);else if(["eth_sendTransaction","eth_sendRawTransaction"].includes(t)){for(var h=function(t){var r=i.traceHistories[t];if("eth_estimateGas"===r.method&&r.params[0]&&e[0]&&r.params[0].from===e[0].from&&r.params[0].to===e[0].to&&r.params[0].data===e[0].data)return i.traceHistories=i.traceHistories.filter((function(t){return t!==r})),o.stack=r.stack,"break"},p=i.traceHistories.length-1;p>=0&&"break"!==h(p);p--);o.stack||(o.stack=u.stack.split(/\n/).map((function(t){return t.trim()})).filter((function(t){return t.length>0&&"Error"!==t})));var d={hash:f[1],stack:o.stack};if(c.info("Transaction trace",{hash:s.prettifyHash(d.hash),stack:d.stack}),a){var g=new WebSocket("ws://localhost:1236");g.onopen=function(){g.send(JSON.stringify(d))},g.onerror=function(t){c.error("Send transaction trace error",{err:t})},g.onmessage=function(){g.close()}}else{var v=new(r(31))("ws://localhost:1236");v.on("open",(function(){v.send(JSON.stringify(d))})),v.on("error",(function(t){c.error("Send transaction trace error",{err:t})})),v.on("message",(function(){v.close()}))}}n.apply(l,f)}})}return n}void 0===i||i.traceHistories||(i.traceHistories=[]),e.traceSendAsync=l,e.traceSend=function(t,e){if("eth_sendTransaction"===t||"eth_sendRawTransaction"===t){var r={stack:void 0};Error.captureStackTrace(r,l);var n={hash:e,stack:r.stack.split(/\n/).map((function(t){return t.trim()})).filter((function(t){return t.length>0&&"Error"!==t}))};c.info("Transaction trace",{hash:s.prettifyHash(n.hash),stack:n.stack});var o=new WebSocket("ws://localhost:1236");o.onopen=function(){o.send(JSON.stringify(n))},o.onerror=function(t){c.error("Send transaction trace error",{err:t})},o.onmessage=function(){o.close()}}};var f=function(t,e){};(f=l("eth_sendTransaction",[{from:"12"}],f))(null,"123")}},e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,r),o.exports}return r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r(846)})();
//# sourceMappingURL=trace-instrument.web.js.map