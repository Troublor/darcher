{"version":3,"sources":["webpack://@darcher/misc/../node_modules/bufferutil/fallback.js","webpack://@darcher/misc/../node_modules/bufferutil/index.js","webpack://@darcher/misc/../node_modules/node-gyp-build/index.js","webpack://@darcher/misc/../node_modules/utf-8-validate/fallback.js","webpack://@darcher/misc/../node_modules/utf-8-validate/index.js","webpack://@darcher/misc/../node_modules/ws/index.js","webpack://@darcher/misc/../node_modules/ws/lib/buffer-util.js","webpack://@darcher/misc/../node_modules/ws/lib/constants.js","webpack://@darcher/misc/../node_modules/ws/lib/event-target.js","webpack://@darcher/misc/../node_modules/ws/lib/extension.js","webpack://@darcher/misc/../node_modules/ws/lib/limiter.js","webpack://@darcher/misc/../node_modules/ws/lib/permessage-deflate.js","webpack://@darcher/misc/../node_modules/ws/lib/receiver.js","webpack://@darcher/misc/../node_modules/ws/lib/sender.js","webpack://@darcher/misc/../node_modules/ws/lib/stream.js","webpack://@darcher/misc/../node_modules/ws/lib/validation.js","webpack://@darcher/misc/../node_modules/ws/lib/websocket-server.js","webpack://@darcher/misc/../node_modules/ws/lib/websocket.js","webpack://@darcher/misc/../darcher-helpers-browser/dist/index.js","webpack://@darcher/misc/../darcher-helpers-browser/dist/log.js","webpack://@darcher/misc/../darcher-helpers-browser/dist/utility.js","webpack://@darcher/misc/./src/trace-instrument.ts","webpack://@darcher/misc/external \"crypto\"","webpack://@darcher/misc/external \"events\"","webpack://@darcher/misc/external \"fs\"","webpack://@darcher/misc/external \"http\"","webpack://@darcher/misc/external \"https\"","webpack://@darcher/misc/external \"net\"","webpack://@darcher/misc/external \"os\"","webpack://@darcher/misc/external \"path\"","webpack://@darcher/misc/external \"stream\"","webpack://@darcher/misc/external \"tls\"","webpack://@darcher/misc/external \"url\"","webpack://@darcher/misc/external \"zlib\"","webpack://@darcher/misc/webpack/bootstrap","webpack://@darcher/misc/webpack/startup"],"names":["module","exports","mask","source","output","offset","length","i","unmask","buffer","__dirname","e","fs","path","os","runtimeRequire","vars","process","config","variables","prebuildsOnly","env","PREBUILDS_ONLY","abi","versions","modules","runtime","electron","ELECTRON_RUN_AS_NODE","window","type","arch","platform","libc","LIBC","existsSync","isAlpine","armv","ARM_VERSION","arm_version","uv","split","load","dir","readdirSync","err","getFirst","filter","files","join","matchBuild","name","test","parseTags","file","arr","tags","specificity","pop","tag","napi","slice","matchTags","runtimeAgnostic","compareTags","a","b","resolve","toUpperCase","replace","release","debug","prebuild","nearby","dirname","execPath","target","node","Boolean","Error","prebuilds","winner","map","sort","buf","len","WebSocket","createWebSocketStream","Server","Receiver","Sender","EMPTY_BUFFER","concat","list","totalLength","Buffer","allocUnsafe","set","_mask","_unmask","toArrayBuffer","byteLength","byteOffset","toBuffer","data","readOnly","isBuffer","ArrayBuffer","from","isView","bufferUtil","bu","BufferUtil","BINARY_TYPES","GUID","kStatusCode","Symbol","kWebSocket","alloc","NOOP","Event","this","MessageEvent","super","CloseEvent","code","reason","wasClean","_closeFrameReceived","_closeFrameSent","OpenEvent","ErrorEvent","error","message","EventTarget","listener","options","onMessage","call","onClose","onError","onOpen","method","once","_listener","listeners","removeListener","tokenChars","push","dest","elem","undefined","format","extensions","Object","keys","extension","configurations","Array","isArray","params","k","values","v","parse","header","offers","create","extensionName","paramName","mustUnescape","isEscaping","inQuotes","start","end","charCodeAt","SyntaxError","value","token","kDone","kRun","concurrency","pending","Infinity","jobs","job","shift","zlib","Limiter","TRAILER","kPerMessageDeflate","kTotalLength","kCallback","kBuffers","kError","zlibLimiter","deflateOnData","chunk","inflateOnData","_maxPayload","RangeError","reset","inflateOnError","_inflate","isServer","maxPayload","_options","_threshold","threshold","_isServer","_deflate","concurrencyLimit","serverNoContextTakeover","server_no_context_takeover","clientNoContextTakeover","client_no_context_takeover","serverMaxWindowBits","server_max_window_bits","clientMaxWindowBits","client_max_window_bits","normalizeParams","acceptAsServer","acceptAsClient","close","callback","opts","accepted","find","response","forEach","key","num","Number","isInteger","TypeError","fin","add","done","_decompress","result","_compress","endpoint","windowBits","Z_DEFAULT_WINDOWBITS","createInflateRaw","zlibInflateOptions","on","write","flush","createDeflateRaw","zlibDeflateOptions","Z_SYNC_FLUSH","Writable","PerMessageDeflate","isValidStatusCode","isValidUTF8","ErrorCtor","prefix","statusCode","captureStackTrace","binaryType","_binaryType","_extensions","_bufferedBytes","_buffers","_compressed","_payloadLength","_fragmented","_masked","_fin","_opcode","_totalPayloadLength","_messageLength","_fragments","_state","_loop","encoding","cb","startLoop","n","dst","Uint8Array","getInfo","getPayloadLength16","getPayloadLength64","getMask","getData","consume","compressed","haveLength","readUInt16BE","readUInt32BE","Math","pow","controlMessage","decompress","dataMessage","er","messageLength","fragments","emit","toString","randomFillSync","applyMask","socket","_socket","_firstFragment","_deflating","_queue","merge","payloadLength","opcode","rsv1","writeUInt16BE","writeUInt32BE","enqueue","doClose","sendFrame","frame","doPing","doPong","perMessageDeflate","binary","compress","dispatch","_","destroyed","dequeue","Reflect","apply","cork","uncork","Duplex","emitClose","stream","duplexOnEnd","_writableState","finished","destroy","duplexOnError","listenerCount","ws","resumeOnReceiverDrain","receiverOnDrain","resume","readyState","CONNECTING","_receiver","removeAllListeners","duplex","autoDestroy","objectMode","writableObjectMode","msg","pause","_destroy","CLOSED","nextTick","called","terminate","_final","_readableState","endEmitted","_read","OPEN","needDrain","_write","send","Validation","EventEmitter","createHash","createServer","STATUS_CODES","keyRegex","server","socketOnError","abortHandshake","headers","writable","Connection","h","handleProtocols","clientTracking","verifyClient","noServer","backlog","host","port","_server","req","res","body","writeHead","listen","emitConnection","bind","_removeListeners","event","addListeners","listening","upgrade","head","handleUpgrade","clients","Set","address","client","index","url","indexOf","trim","version","toLowerCase","shouldHandle","accept","info","origin","secure","connection","authorized","encrypted","verified","completeUpgrade","readable","update","digest","protocol","_protocol","setSocket","delete","https","http","net","tls","randomBytes","URL","addEventListener","removeEventListener","readyStates","protocolVersions","protocols","_closeCode","_closeMessage","_closeTimer","_readyState","_sender","_bufferedAmount","_redirects","initAsClient","includes","_url","receiver","receiverOnConclude","receiverOnError","receiverOnMessage","receiverOnPing","receiverOnPong","setTimeout","setNoDelay","unshift","socketOnClose","socketOnData","socketOnEnd","cleanup","_req","CLOSING","ping","sendAfterClose","pong","websocket","protocolVersion","followRedirects","maxRedirects","createConnection","socketPath","hostname","timeout","parsedUrl","href","isUnixSocket","pathname","isSecure","defaultPort","get","tlsConnect","netConnect","startsWith","Upgrade","search","handshakeTimeout","offer","Origin","username","password","auth","parts","aborted","location","abort","addr","serverProt","protList","protError","connect","servername","setHeader","receiverOnFinish","read","clearTimeout","errorEmitted","descriptor","enumerable","defineProperty","prototype","property","configurable","__createBinding","o","m","k2","__exportStar","p","hasOwnProperty","Logger","level","parseLog","context","_a","now","Date","logTime","getMonth","padStart","getDay","getHours","getMinutes","getSeconds","getMilliseconds","padEnd","colored","payload","contextLiteral","Level","levelString","log","ERROR","console","WARN","warn","INFO","DEBUG","lvl","prettifyHash","hash","startIndex","substring","isBrowser","GLOBAL","logger","oneTimeWebSocketRequest","Promise","reject","onopen","JSON","stringify","onerror","ev","onmessage","stack","global","traceSendAsync","traceCache","Proxy","thisArg","argArray","gas","item","traceHistories","to","traceObj","require","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__"],"mappings":"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","file":"trace-instrument.node.js","sourcesContent":["'use strict';\n\n/**\n * Masks a buffer using the given mask.\n *\n * @param {Buffer} source The buffer to mask\n * @param {Buffer} mask The mask to use\n * @param {Buffer} output The buffer where to store the result\n * @param {Number} offset The offset at which to start writing\n * @param {Number} length The number of bytes to mask.\n * @public\n */\nconst mask = (source, mask, output, offset, length) => {\n  for (var i = 0; i < length; i++) {\n    output[offset + i] = source[i] ^ mask[i & 3];\n  }\n};\n\n/**\n * Unmasks a buffer using the given mask.\n *\n * @param {Buffer} buffer The buffer to unmask\n * @param {Buffer} mask The mask to use\n * @public\n */\nconst unmask = (buffer, mask) => {\n  // Required until https://github.com/nodejs/node/issues/9006 is resolved.\n  const length = buffer.length;\n  for (var i = 0; i < length; i++) {\n    buffer[i] ^= mask[i & 3];\n  }\n};\n\nmodule.exports = { mask, unmask };\n","'use strict';\n\ntry {\n  module.exports = require('node-gyp-build')(__dirname);\n} catch (e) {\n  module.exports = require('./fallback');\n}\n","var fs = require('fs')\nvar path = require('path')\nvar os = require('os')\n\n// Workaround to fix webpack's build warnings: 'the request of a dependency is an expression'\nvar runtimeRequire = typeof __webpack_require__ === 'function' ? __non_webpack_require__ : require // eslint-disable-line\n\nvar vars = (process.config && process.config.variables) || {}\nvar prebuildsOnly = !!process.env.PREBUILDS_ONLY\nvar abi = process.versions.modules // TODO: support old node where this is undef\nvar runtime = isElectron() ? 'electron' : 'node'\nvar arch = os.arch()\nvar platform = os.platform()\nvar libc = process.env.LIBC || (isAlpine(platform) ? 'musl' : 'glibc')\nvar armv = process.env.ARM_VERSION || (arch === 'arm64' ? '8' : vars.arm_version) || ''\nvar uv = (process.versions.uv || '').split('.')[0]\n\nmodule.exports = load\n\nfunction load (dir) {\n  return runtimeRequire(load.path(dir))\n}\n\nload.path = function (dir) {\n  dir = path.resolve(dir || '.')\n\n  try {\n    var name = runtimeRequire(path.join(dir, 'package.json')).name.toUpperCase().replace(/-/g, '_')\n    if (process.env[name + '_PREBUILD']) dir = process.env[name + '_PREBUILD']\n  } catch (err) {}\n\n  if (!prebuildsOnly) {\n    var release = getFirst(path.join(dir, 'build/Release'), matchBuild)\n    if (release) return release\n\n    var debug = getFirst(path.join(dir, 'build/Debug'), matchBuild)\n    if (debug) return debug\n  }\n\n  var prebuild = resolve(dir)\n  if (prebuild) return prebuild\n\n  var nearby = resolve(path.dirname(process.execPath))\n  if (nearby) return nearby\n\n  var target = [\n    'platform=' + platform,\n    'arch=' + arch,\n    'runtime=' + runtime,\n    'abi=' + abi,\n    'uv=' + uv,\n    armv ? 'armv=' + armv : '',\n    'libc=' + libc,\n    'node=' + process.versions.node,\n    (process.versions && process.versions.electron) ? 'electron=' + process.versions.electron : '',\n    typeof __webpack_require__ === 'function' ? 'webpack=true' : '' // eslint-disable-line\n  ].filter(Boolean).join(' ')\n\n  throw new Error('No native build was found for ' + target + '\\n    loaded from: ' + dir + '\\n')\n\n  function resolve (dir) {\n    // Find most specific flavor first\n    var prebuilds = path.join(dir, 'prebuilds', platform + '-' + arch)\n    var parsed = readdirSync(prebuilds).map(parseTags)\n    var candidates = parsed.filter(matchTags(runtime, abi))\n    var winner = candidates.sort(compareTags(runtime))[0]\n    if (winner) return path.join(prebuilds, winner.file)\n  }\n}\n\nfunction readdirSync (dir) {\n  try {\n    return fs.readdirSync(dir)\n  } catch (err) {\n    return []\n  }\n}\n\nfunction getFirst (dir, filter) {\n  var files = readdirSync(dir).filter(filter)\n  return files[0] && path.join(dir, files[0])\n}\n\nfunction matchBuild (name) {\n  return /\\.node$/.test(name)\n}\n\nfunction parseTags (file) {\n  var arr = file.split('.')\n  var extension = arr.pop()\n  var tags = { file: file, specificity: 0 }\n\n  if (extension !== 'node') return\n\n  for (var i = 0; i < arr.length; i++) {\n    var tag = arr[i]\n\n    if (tag === 'node' || tag === 'electron' || tag === 'node-webkit') {\n      tags.runtime = tag\n    } else if (tag === 'napi') {\n      tags.napi = true\n    } else if (tag.slice(0, 3) === 'abi') {\n      tags.abi = tag.slice(3)\n    } else if (tag.slice(0, 2) === 'uv') {\n      tags.uv = tag.slice(2)\n    } else if (tag.slice(0, 4) === 'armv') {\n      tags.armv = tag.slice(4)\n    } else if (tag === 'glibc' || tag === 'musl') {\n      tags.libc = tag\n    } else {\n      continue\n    }\n\n    tags.specificity++\n  }\n\n  return tags\n}\n\nfunction matchTags (runtime, abi) {\n  return function (tags) {\n    if (tags == null) return false\n    if (tags.runtime !== runtime && !runtimeAgnostic(tags)) return false\n    if (tags.abi !== abi && !tags.napi) return false\n    if (tags.uv && tags.uv !== uv) return false\n    if (tags.armv && tags.armv !== armv) return false\n    if (tags.libc && tags.libc !== libc) return false\n\n    return true\n  }\n}\n\nfunction runtimeAgnostic (tags) {\n  return tags.runtime === 'node' && tags.napi\n}\n\nfunction compareTags (runtime) {\n  // Precedence: non-agnostic runtime, abi over napi, then by specificity.\n  return function (a, b) {\n    if (a.runtime !== b.runtime) {\n      return a.runtime === runtime ? -1 : 1\n    } else if (a.abi !== b.abi) {\n      return a.abi ? -1 : 1\n    } else if (a.specificity !== b.specificity) {\n      return a.specificity > b.specificity ? -1 : 1\n    } else {\n      return 0\n    }\n  }\n}\n\nfunction isElectron () {\n  if (process.versions && process.versions.electron) return true\n  if (process.env.ELECTRON_RUN_AS_NODE) return true\n  return typeof window !== 'undefined' && window.process && window.process.type === 'renderer'\n}\n\nfunction isAlpine (platform) {\n  return platform === 'linux' && fs.existsSync('/etc/alpine-release')\n}\n\n// Exposed for unit tests\n// TODO: move to lib\nload.parseTags = parseTags\nload.matchTags = matchTags\nload.compareTags = compareTags\n","'use strict';\n\n/**\n * Checks if a given buffer contains only correct UTF-8.\n * Ported from https://www.cl.cam.ac.uk/%7Emgk25/ucs/utf8_check.c by\n * Markus Kuhn.\n *\n * @param {Buffer} buf The buffer to check\n * @return {Boolean} `true` if `buf` contains only correct UTF-8, else `false`\n * @public\n */\nconst isValidUTF8 = (buf) => {\n  var len = buf.length;\n  var i = 0;\n\n  while (i < len) {\n    if (buf[i] < 0x80) {  // 0xxxxxxx\n      i++;\n    } else if ((buf[i] & 0xe0) === 0xc0) {  // 110xxxxx 10xxxxxx\n      if (\n        i + 1 === len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i] & 0xfe) === 0xc0  // overlong\n      ) {\n        return false;\n      } else {\n        i += 2;\n      }\n    } else if ((buf[i] & 0xf0) === 0xe0) {  // 1110xxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 2 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        buf[i] === 0xe0 && (buf[i + 1] & 0xe0) === 0x80 ||  // overlong\n        buf[i] === 0xed && (buf[i + 1] & 0xe0) === 0xa0     // surrogate (U+D800 - U+DFFF)\n      ) {\n        return false;\n      } else {\n        i += 3;\n      }\n    } else if ((buf[i] & 0xf8) === 0xf0) {  // 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 3 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        (buf[i + 3] & 0xc0) !== 0x80 ||\n        buf[i] === 0xf0 && (buf[i + 1] & 0xf0) === 0x80 ||  // overlong\n        buf[i] === 0xf4 && buf[i + 1] > 0x8f || buf[i] > 0xf4  // > U+10FFFF\n      ) {\n        return false;\n      } else {\n        i += 4;\n      }\n    } else {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nmodule.exports = isValidUTF8;\n","'use strict';\n\ntry {\n  module.exports = require('node-gyp-build')(__dirname);\n} catch (e) {\n  module.exports = require('./fallback');\n}\n","'use strict';\n\nconst WebSocket = require('./lib/websocket');\n\nWebSocket.createWebSocketStream = require('./lib/stream');\nWebSocket.Server = require('./lib/websocket-server');\nWebSocket.Receiver = require('./lib/receiver');\nWebSocket.Sender = require('./lib/sender');\n\nmodule.exports = WebSocket;\n","'use strict';\n\nconst { EMPTY_BUFFER } = require('./constants');\n\n/**\n * Merges an array of buffers into a new buffer.\n *\n * @param {Buffer[]} list The array of buffers to concat\n * @param {Number} totalLength The total length of buffers in the list\n * @return {Buffer} The resulting buffer\n * @public\n */\nfunction concat(list, totalLength) {\n  if (list.length === 0) return EMPTY_BUFFER;\n  if (list.length === 1) return list[0];\n\n  const target = Buffer.allocUnsafe(totalLength);\n  let offset = 0;\n\n  for (let i = 0; i < list.length; i++) {\n    const buf = list[i];\n    target.set(buf, offset);\n    offset += buf.length;\n  }\n\n  if (offset < totalLength) return target.slice(0, offset);\n\n  return target;\n}\n\n/**\n * Masks a buffer using the given mask.\n *\n * @param {Buffer} source The buffer to mask\n * @param {Buffer} mask The mask to use\n * @param {Buffer} output The buffer where to store the result\n * @param {Number} offset The offset at which to start writing\n * @param {Number} length The number of bytes to mask.\n * @public\n */\nfunction _mask(source, mask, output, offset, length) {\n  for (let i = 0; i < length; i++) {\n    output[offset + i] = source[i] ^ mask[i & 3];\n  }\n}\n\n/**\n * Unmasks a buffer using the given mask.\n *\n * @param {Buffer} buffer The buffer to unmask\n * @param {Buffer} mask The mask to use\n * @public\n */\nfunction _unmask(buffer, mask) {\n  // Required until https://github.com/nodejs/node/issues/9006 is resolved.\n  const length = buffer.length;\n  for (let i = 0; i < length; i++) {\n    buffer[i] ^= mask[i & 3];\n  }\n}\n\n/**\n * Converts a buffer to an `ArrayBuffer`.\n *\n * @param {Buffer} buf The buffer to convert\n * @return {ArrayBuffer} Converted buffer\n * @public\n */\nfunction toArrayBuffer(buf) {\n  if (buf.byteLength === buf.buffer.byteLength) {\n    return buf.buffer;\n  }\n\n  return buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.byteLength);\n}\n\n/**\n * Converts `data` to a `Buffer`.\n *\n * @param {*} data The data to convert\n * @return {Buffer} The buffer\n * @throws {TypeError}\n * @public\n */\nfunction toBuffer(data) {\n  toBuffer.readOnly = true;\n\n  if (Buffer.isBuffer(data)) return data;\n\n  let buf;\n\n  if (data instanceof ArrayBuffer) {\n    buf = Buffer.from(data);\n  } else if (ArrayBuffer.isView(data)) {\n    buf = Buffer.from(data.buffer, data.byteOffset, data.byteLength);\n  } else {\n    buf = Buffer.from(data);\n    toBuffer.readOnly = false;\n  }\n\n  return buf;\n}\n\ntry {\n  const bufferUtil = require('bufferutil');\n  const bu = bufferUtil.BufferUtil || bufferUtil;\n\n  module.exports = {\n    concat,\n    mask(source, mask, output, offset, length) {\n      if (length < 48) _mask(source, mask, output, offset, length);\n      else bu.mask(source, mask, output, offset, length);\n    },\n    toArrayBuffer,\n    toBuffer,\n    unmask(buffer, mask) {\n      if (buffer.length < 32) _unmask(buffer, mask);\n      else bu.unmask(buffer, mask);\n    }\n  };\n} catch (e) /* istanbul ignore next */ {\n  module.exports = {\n    concat,\n    mask: _mask,\n    toArrayBuffer,\n    toBuffer,\n    unmask: _unmask\n  };\n}\n","'use strict';\n\nmodule.exports = {\n  BINARY_TYPES: ['nodebuffer', 'arraybuffer', 'fragments'],\n  GUID: '258EAFA5-E914-47DA-95CA-C5AB0DC85B11',\n  kStatusCode: Symbol('status-code'),\n  kWebSocket: Symbol('websocket'),\n  EMPTY_BUFFER: Buffer.alloc(0),\n  NOOP: () => {}\n};\n","'use strict';\n\n/**\n * Class representing an event.\n *\n * @private\n */\nclass Event {\n  /**\n   * Create a new `Event`.\n   *\n   * @param {String} type The name of the event\n   * @param {Object} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(type, target) {\n    this.target = target;\n    this.type = type;\n  }\n}\n\n/**\n * Class representing a message event.\n *\n * @extends Event\n * @private\n */\nclass MessageEvent extends Event {\n  /**\n   * Create a new `MessageEvent`.\n   *\n   * @param {(String|Buffer|ArrayBuffer|Buffer[])} data The received data\n   * @param {WebSocket} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(data, target) {\n    super('message', target);\n\n    this.data = data;\n  }\n}\n\n/**\n * Class representing a close event.\n *\n * @extends Event\n * @private\n */\nclass CloseEvent extends Event {\n  /**\n   * Create a new `CloseEvent`.\n   *\n   * @param {Number} code The status code explaining why the connection is being\n   *     closed\n   * @param {String} reason A human-readable string explaining why the\n   *     connection is closing\n   * @param {WebSocket} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(code, reason, target) {\n    super('close', target);\n\n    this.wasClean = target._closeFrameReceived && target._closeFrameSent;\n    this.reason = reason;\n    this.code = code;\n  }\n}\n\n/**\n * Class representing an open event.\n *\n * @extends Event\n * @private\n */\nclass OpenEvent extends Event {\n  /**\n   * Create a new `OpenEvent`.\n   *\n   * @param {WebSocket} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(target) {\n    super('open', target);\n  }\n}\n\n/**\n * Class representing an error event.\n *\n * @extends Event\n * @private\n */\nclass ErrorEvent extends Event {\n  /**\n   * Create a new `ErrorEvent`.\n   *\n   * @param {Object} error The error that generated this event\n   * @param {WebSocket} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(error, target) {\n    super('error', target);\n\n    this.message = error.message;\n    this.error = error;\n  }\n}\n\n/**\n * This provides methods for emulating the `EventTarget` interface. It's not\n * meant to be used directly.\n *\n * @mixin\n */\nconst EventTarget = {\n  /**\n   * Register an event listener.\n   *\n   * @param {String} type A string representing the event type to listen for\n   * @param {Function} listener The listener to add\n   * @param {Object} [options] An options object specifies characteristics about\n   *     the event listener\n   * @param {Boolean} [options.once=false] A `Boolean`` indicating that the\n   *     listener should be invoked at most once after being added. If `true`,\n   *     the listener would be automatically removed when invoked.\n   * @public\n   */\n  addEventListener(type, listener, options) {\n    if (typeof listener !== 'function') return;\n\n    function onMessage(data) {\n      listener.call(this, new MessageEvent(data, this));\n    }\n\n    function onClose(code, message) {\n      listener.call(this, new CloseEvent(code, message, this));\n    }\n\n    function onError(error) {\n      listener.call(this, new ErrorEvent(error, this));\n    }\n\n    function onOpen() {\n      listener.call(this, new OpenEvent(this));\n    }\n\n    const method = options && options.once ? 'once' : 'on';\n\n    if (type === 'message') {\n      onMessage._listener = listener;\n      this[method](type, onMessage);\n    } else if (type === 'close') {\n      onClose._listener = listener;\n      this[method](type, onClose);\n    } else if (type === 'error') {\n      onError._listener = listener;\n      this[method](type, onError);\n    } else if (type === 'open') {\n      onOpen._listener = listener;\n      this[method](type, onOpen);\n    } else {\n      this[method](type, listener);\n    }\n  },\n\n  /**\n   * Remove an event listener.\n   *\n   * @param {String} type A string representing the event type to remove\n   * @param {Function} listener The listener to remove\n   * @public\n   */\n  removeEventListener(type, listener) {\n    const listeners = this.listeners(type);\n\n    for (let i = 0; i < listeners.length; i++) {\n      if (listeners[i] === listener || listeners[i]._listener === listener) {\n        this.removeListener(type, listeners[i]);\n      }\n    }\n  }\n};\n\nmodule.exports = EventTarget;\n","'use strict';\n\n//\n// Allowed token characters:\n//\n// '!', '#', '$', '%', '&', ''', '*', '+', '-',\n// '.', 0-9, A-Z, '^', '_', '`', a-z, '|', '~'\n//\n// tokenChars[32] === 0 // ' '\n// tokenChars[33] === 1 // '!'\n// tokenChars[34] === 0 // '\"'\n// ...\n//\n// prettier-ignore\nconst tokenChars = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 0 - 15\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 16 - 31\n  0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, // 32 - 47\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, // 48 - 63\n  0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 64 - 79\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, // 80 - 95\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 96 - 111\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0 // 112 - 127\n];\n\n/**\n * Adds an offer to the map of extension offers or a parameter to the map of\n * parameters.\n *\n * @param {Object} dest The map of extension offers or parameters\n * @param {String} name The extension or parameter name\n * @param {(Object|Boolean|String)} elem The extension parameters or the\n *     parameter value\n * @private\n */\nfunction push(dest, name, elem) {\n  if (dest[name] === undefined) dest[name] = [elem];\n  else dest[name].push(elem);\n}\n\n/**\n * Parses the `Sec-WebSocket-Extensions` header into an object.\n *\n * @param {String} header The field value of the header\n * @return {Object} The parsed object\n * @public\n */\nfunction parse(header) {\n  const offers = Object.create(null);\n\n  if (header === undefined || header === '') return offers;\n\n  let params = Object.create(null);\n  let mustUnescape = false;\n  let isEscaping = false;\n  let inQuotes = false;\n  let extensionName;\n  let paramName;\n  let start = -1;\n  let end = -1;\n  let i = 0;\n\n  for (; i < header.length; i++) {\n    const code = header.charCodeAt(i);\n\n    if (extensionName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20 /* ' ' */ || code === 0x09 /* '\\t' */) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b /* ';' */ || code === 0x2c /* ',' */) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        const name = header.slice(start, end);\n        if (code === 0x2c) {\n          push(offers, name, params);\n          params = Object.create(null);\n        } else {\n          extensionName = name;\n        }\n\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else if (paramName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20 || code === 0x09) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        push(params, header.slice(start, end), true);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = Object.create(null);\n          extensionName = undefined;\n        }\n\n        start = end = -1;\n      } else if (code === 0x3d /* '=' */ && start !== -1 && end === -1) {\n        paramName = header.slice(start, i);\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else {\n      //\n      // The value of a quoted-string after unescaping must conform to the\n      // token ABNF, so only token characters are valid.\n      // Ref: https://tools.ietf.org/html/rfc6455#section-9.1\n      //\n      if (isEscaping) {\n        if (tokenChars[code] !== 1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n        if (start === -1) start = i;\n        else if (!mustUnescape) mustUnescape = true;\n        isEscaping = false;\n      } else if (inQuotes) {\n        if (tokenChars[code] === 1) {\n          if (start === -1) start = i;\n        } else if (code === 0x22 /* '\"' */ && start !== -1) {\n          inQuotes = false;\n          end = i;\n        } else if (code === 0x5c /* '\\' */) {\n          isEscaping = true;\n        } else {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n      } else if (code === 0x22 && header.charCodeAt(i - 1) === 0x3d) {\n        inQuotes = true;\n      } else if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (start !== -1 && (code === 0x20 || code === 0x09)) {\n        if (end === -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        let value = header.slice(start, end);\n        if (mustUnescape) {\n          value = value.replace(/\\\\/g, '');\n          mustUnescape = false;\n        }\n        push(params, paramName, value);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = Object.create(null);\n          extensionName = undefined;\n        }\n\n        paramName = undefined;\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    }\n  }\n\n  if (start === -1 || inQuotes) {\n    throw new SyntaxError('Unexpected end of input');\n  }\n\n  if (end === -1) end = i;\n  const token = header.slice(start, end);\n  if (extensionName === undefined) {\n    push(offers, token, params);\n  } else {\n    if (paramName === undefined) {\n      push(params, token, true);\n    } else if (mustUnescape) {\n      push(params, paramName, token.replace(/\\\\/g, ''));\n    } else {\n      push(params, paramName, token);\n    }\n    push(offers, extensionName, params);\n  }\n\n  return offers;\n}\n\n/**\n * Builds the `Sec-WebSocket-Extensions` header field value.\n *\n * @param {Object} extensions The map of extensions and parameters to format\n * @return {String} A string representing the given object\n * @public\n */\nfunction format(extensions) {\n  return Object.keys(extensions)\n    .map((extension) => {\n      let configurations = extensions[extension];\n      if (!Array.isArray(configurations)) configurations = [configurations];\n      return configurations\n        .map((params) => {\n          return [extension]\n            .concat(\n              Object.keys(params).map((k) => {\n                let values = params[k];\n                if (!Array.isArray(values)) values = [values];\n                return values\n                  .map((v) => (v === true ? k : `${k}=${v}`))\n                  .join('; ');\n              })\n            )\n            .join('; ');\n        })\n        .join(', ');\n    })\n    .join(', ');\n}\n\nmodule.exports = { format, parse };\n","'use strict';\n\nconst kDone = Symbol('kDone');\nconst kRun = Symbol('kRun');\n\n/**\n * A very simple job queue with adjustable concurrency. Adapted from\n * https://github.com/STRML/async-limiter\n */\nclass Limiter {\n  /**\n   * Creates a new `Limiter`.\n   *\n   * @param {Number} [concurrency=Infinity] The maximum number of jobs allowed\n   *     to run concurrently\n   */\n  constructor(concurrency) {\n    this[kDone] = () => {\n      this.pending--;\n      this[kRun]();\n    };\n    this.concurrency = concurrency || Infinity;\n    this.jobs = [];\n    this.pending = 0;\n  }\n\n  /**\n   * Adds a job to the queue.\n   *\n   * @param {Function} job The job to run\n   * @public\n   */\n  add(job) {\n    this.jobs.push(job);\n    this[kRun]();\n  }\n\n  /**\n   * Removes a job from the queue and runs it if possible.\n   *\n   * @private\n   */\n  [kRun]() {\n    if (this.pending === this.concurrency) return;\n\n    if (this.jobs.length) {\n      const job = this.jobs.shift();\n\n      this.pending++;\n      job(this[kDone]);\n    }\n  }\n}\n\nmodule.exports = Limiter;\n","'use strict';\n\nconst zlib = require('zlib');\n\nconst bufferUtil = require('./buffer-util');\nconst Limiter = require('./limiter');\nconst { kStatusCode, NOOP } = require('./constants');\n\nconst TRAILER = Buffer.from([0x00, 0x00, 0xff, 0xff]);\nconst kPerMessageDeflate = Symbol('permessage-deflate');\nconst kTotalLength = Symbol('total-length');\nconst kCallback = Symbol('callback');\nconst kBuffers = Symbol('buffers');\nconst kError = Symbol('error');\n\n//\n// We limit zlib concurrency, which prevents severe memory fragmentation\n// as documented in https://github.com/nodejs/node/issues/8871#issuecomment-250915913\n// and https://github.com/websockets/ws/issues/1202\n//\n// Intentionally global; it's the global thread pool that's an issue.\n//\nlet zlibLimiter;\n\n/**\n * permessage-deflate implementation.\n */\nclass PerMessageDeflate {\n  /**\n   * Creates a PerMessageDeflate instance.\n   *\n   * @param {Object} [options] Configuration options\n   * @param {Boolean} [options.serverNoContextTakeover=false] Request/accept\n   *     disabling of server context takeover\n   * @param {Boolean} [options.clientNoContextTakeover=false] Advertise/\n   *     acknowledge disabling of client context takeover\n   * @param {(Boolean|Number)} [options.serverMaxWindowBits] Request/confirm the\n   *     use of a custom server window size\n   * @param {(Boolean|Number)} [options.clientMaxWindowBits] Advertise support\n   *     for, or request, a custom client window size\n   * @param {Object} [options.zlibDeflateOptions] Options to pass to zlib on\n   *     deflate\n   * @param {Object} [options.zlibInflateOptions] Options to pass to zlib on\n   *     inflate\n   * @param {Number} [options.threshold=1024] Size (in bytes) below which\n   *     messages should not be compressed\n   * @param {Number} [options.concurrencyLimit=10] The number of concurrent\n   *     calls to zlib\n   * @param {Boolean} [isServer=false] Create the instance in either server or\n   *     client mode\n   * @param {Number} [maxPayload=0] The maximum allowed message length\n   */\n  constructor(options, isServer, maxPayload) {\n    this._maxPayload = maxPayload | 0;\n    this._options = options || {};\n    this._threshold =\n      this._options.threshold !== undefined ? this._options.threshold : 1024;\n    this._isServer = !!isServer;\n    this._deflate = null;\n    this._inflate = null;\n\n    this.params = null;\n\n    if (!zlibLimiter) {\n      const concurrency =\n        this._options.concurrencyLimit !== undefined\n          ? this._options.concurrencyLimit\n          : 10;\n      zlibLimiter = new Limiter(concurrency);\n    }\n  }\n\n  /**\n   * @type {String}\n   */\n  static get extensionName() {\n    return 'permessage-deflate';\n  }\n\n  /**\n   * Create an extension negotiation offer.\n   *\n   * @return {Object} Extension parameters\n   * @public\n   */\n  offer() {\n    const params = {};\n\n    if (this._options.serverNoContextTakeover) {\n      params.server_no_context_takeover = true;\n    }\n    if (this._options.clientNoContextTakeover) {\n      params.client_no_context_takeover = true;\n    }\n    if (this._options.serverMaxWindowBits) {\n      params.server_max_window_bits = this._options.serverMaxWindowBits;\n    }\n    if (this._options.clientMaxWindowBits) {\n      params.client_max_window_bits = this._options.clientMaxWindowBits;\n    } else if (this._options.clientMaxWindowBits == null) {\n      params.client_max_window_bits = true;\n    }\n\n    return params;\n  }\n\n  /**\n   * Accept an extension negotiation offer/response.\n   *\n   * @param {Array} configurations The extension negotiation offers/reponse\n   * @return {Object} Accepted configuration\n   * @public\n   */\n  accept(configurations) {\n    configurations = this.normalizeParams(configurations);\n\n    this.params = this._isServer\n      ? this.acceptAsServer(configurations)\n      : this.acceptAsClient(configurations);\n\n    return this.params;\n  }\n\n  /**\n   * Releases all resources used by the extension.\n   *\n   * @public\n   */\n  cleanup() {\n    if (this._inflate) {\n      this._inflate.close();\n      this._inflate = null;\n    }\n\n    if (this._deflate) {\n      const callback = this._deflate[kCallback];\n\n      this._deflate.close();\n      this._deflate = null;\n\n      if (callback) {\n        callback(\n          new Error(\n            'The deflate stream was closed while data was being processed'\n          )\n        );\n      }\n    }\n  }\n\n  /**\n   *  Accept an extension negotiation offer.\n   *\n   * @param {Array} offers The extension negotiation offers\n   * @return {Object} Accepted configuration\n   * @private\n   */\n  acceptAsServer(offers) {\n    const opts = this._options;\n    const accepted = offers.find((params) => {\n      if (\n        (opts.serverNoContextTakeover === false &&\n          params.server_no_context_takeover) ||\n        (params.server_max_window_bits &&\n          (opts.serverMaxWindowBits === false ||\n            (typeof opts.serverMaxWindowBits === 'number' &&\n              opts.serverMaxWindowBits > params.server_max_window_bits))) ||\n        (typeof opts.clientMaxWindowBits === 'number' &&\n          !params.client_max_window_bits)\n      ) {\n        return false;\n      }\n\n      return true;\n    });\n\n    if (!accepted) {\n      throw new Error('None of the extension offers can be accepted');\n    }\n\n    if (opts.serverNoContextTakeover) {\n      accepted.server_no_context_takeover = true;\n    }\n    if (opts.clientNoContextTakeover) {\n      accepted.client_no_context_takeover = true;\n    }\n    if (typeof opts.serverMaxWindowBits === 'number') {\n      accepted.server_max_window_bits = opts.serverMaxWindowBits;\n    }\n    if (typeof opts.clientMaxWindowBits === 'number') {\n      accepted.client_max_window_bits = opts.clientMaxWindowBits;\n    } else if (\n      accepted.client_max_window_bits === true ||\n      opts.clientMaxWindowBits === false\n    ) {\n      delete accepted.client_max_window_bits;\n    }\n\n    return accepted;\n  }\n\n  /**\n   * Accept the extension negotiation response.\n   *\n   * @param {Array} response The extension negotiation response\n   * @return {Object} Accepted configuration\n   * @private\n   */\n  acceptAsClient(response) {\n    const params = response[0];\n\n    if (\n      this._options.clientNoContextTakeover === false &&\n      params.client_no_context_takeover\n    ) {\n      throw new Error('Unexpected parameter \"client_no_context_takeover\"');\n    }\n\n    if (!params.client_max_window_bits) {\n      if (typeof this._options.clientMaxWindowBits === 'number') {\n        params.client_max_window_bits = this._options.clientMaxWindowBits;\n      }\n    } else if (\n      this._options.clientMaxWindowBits === false ||\n      (typeof this._options.clientMaxWindowBits === 'number' &&\n        params.client_max_window_bits > this._options.clientMaxWindowBits)\n    ) {\n      throw new Error(\n        'Unexpected or invalid parameter \"client_max_window_bits\"'\n      );\n    }\n\n    return params;\n  }\n\n  /**\n   * Normalize parameters.\n   *\n   * @param {Array} configurations The extension negotiation offers/reponse\n   * @return {Array} The offers/response with normalized parameters\n   * @private\n   */\n  normalizeParams(configurations) {\n    configurations.forEach((params) => {\n      Object.keys(params).forEach((key) => {\n        let value = params[key];\n\n        if (value.length > 1) {\n          throw new Error(`Parameter \"${key}\" must have only a single value`);\n        }\n\n        value = value[0];\n\n        if (key === 'client_max_window_bits') {\n          if (value !== true) {\n            const num = +value;\n            if (!Number.isInteger(num) || num < 8 || num > 15) {\n              throw new TypeError(\n                `Invalid value for parameter \"${key}\": ${value}`\n              );\n            }\n            value = num;\n          } else if (!this._isServer) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n        } else if (key === 'server_max_window_bits') {\n          const num = +value;\n          if (!Number.isInteger(num) || num < 8 || num > 15) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n          value = num;\n        } else if (\n          key === 'client_no_context_takeover' ||\n          key === 'server_no_context_takeover'\n        ) {\n          if (value !== true) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n        } else {\n          throw new Error(`Unknown parameter \"${key}\"`);\n        }\n\n        params[key] = value;\n      });\n    });\n\n    return configurations;\n  }\n\n  /**\n   * Decompress data. Concurrency limited.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @public\n   */\n  decompress(data, fin, callback) {\n    zlibLimiter.add((done) => {\n      this._decompress(data, fin, (err, result) => {\n        done();\n        callback(err, result);\n      });\n    });\n  }\n\n  /**\n   * Compress data. Concurrency limited.\n   *\n   * @param {Buffer} data Data to compress\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @public\n   */\n  compress(data, fin, callback) {\n    zlibLimiter.add((done) => {\n      this._compress(data, fin, (err, result) => {\n        done();\n        callback(err, result);\n      });\n    });\n  }\n\n  /**\n   * Decompress data.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @private\n   */\n  _decompress(data, fin, callback) {\n    const endpoint = this._isServer ? 'client' : 'server';\n\n    if (!this._inflate) {\n      const key = `${endpoint}_max_window_bits`;\n      const windowBits =\n        typeof this.params[key] !== 'number'\n          ? zlib.Z_DEFAULT_WINDOWBITS\n          : this.params[key];\n\n      this._inflate = zlib.createInflateRaw({\n        ...this._options.zlibInflateOptions,\n        windowBits\n      });\n      this._inflate[kPerMessageDeflate] = this;\n      this._inflate[kTotalLength] = 0;\n      this._inflate[kBuffers] = [];\n      this._inflate.on('error', inflateOnError);\n      this._inflate.on('data', inflateOnData);\n    }\n\n    this._inflate[kCallback] = callback;\n\n    this._inflate.write(data);\n    if (fin) this._inflate.write(TRAILER);\n\n    this._inflate.flush(() => {\n      const err = this._inflate[kError];\n\n      if (err) {\n        this._inflate.close();\n        this._inflate = null;\n        callback(err);\n        return;\n      }\n\n      const data = bufferUtil.concat(\n        this._inflate[kBuffers],\n        this._inflate[kTotalLength]\n      );\n\n      if (fin && this.params[`${endpoint}_no_context_takeover`]) {\n        this._inflate.close();\n        this._inflate = null;\n      } else {\n        this._inflate[kTotalLength] = 0;\n        this._inflate[kBuffers] = [];\n      }\n\n      callback(null, data);\n    });\n  }\n\n  /**\n   * Compress data.\n   *\n   * @param {Buffer} data Data to compress\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @private\n   */\n  _compress(data, fin, callback) {\n    const endpoint = this._isServer ? 'server' : 'client';\n\n    if (!this._deflate) {\n      const key = `${endpoint}_max_window_bits`;\n      const windowBits =\n        typeof this.params[key] !== 'number'\n          ? zlib.Z_DEFAULT_WINDOWBITS\n          : this.params[key];\n\n      this._deflate = zlib.createDeflateRaw({\n        ...this._options.zlibDeflateOptions,\n        windowBits\n      });\n\n      this._deflate[kTotalLength] = 0;\n      this._deflate[kBuffers] = [];\n\n      //\n      // An `'error'` event is emitted, only on Node.js < 10.0.0, if the\n      // `zlib.DeflateRaw` instance is closed while data is being processed.\n      // This can happen if `PerMessageDeflate#cleanup()` is called at the wrong\n      // time due to an abnormal WebSocket closure.\n      //\n      this._deflate.on('error', NOOP);\n      this._deflate.on('data', deflateOnData);\n    }\n\n    this._deflate[kCallback] = callback;\n\n    this._deflate.write(data);\n    this._deflate.flush(zlib.Z_SYNC_FLUSH, () => {\n      if (!this._deflate) {\n        //\n        // The deflate stream was closed while data was being processed.\n        //\n        return;\n      }\n\n      let data = bufferUtil.concat(\n        this._deflate[kBuffers],\n        this._deflate[kTotalLength]\n      );\n\n      if (fin) data = data.slice(0, data.length - 4);\n\n      //\n      // Ensure that the callback will not be called again in\n      // `PerMessageDeflate#cleanup()`.\n      //\n      this._deflate[kCallback] = null;\n\n      if (fin && this.params[`${endpoint}_no_context_takeover`]) {\n        this._deflate.close();\n        this._deflate = null;\n      } else {\n        this._deflate[kTotalLength] = 0;\n        this._deflate[kBuffers] = [];\n      }\n\n      callback(null, data);\n    });\n  }\n}\n\nmodule.exports = PerMessageDeflate;\n\n/**\n * The listener of the `zlib.DeflateRaw` stream `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction deflateOnData(chunk) {\n  this[kBuffers].push(chunk);\n  this[kTotalLength] += chunk.length;\n}\n\n/**\n * The listener of the `zlib.InflateRaw` stream `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction inflateOnData(chunk) {\n  this[kTotalLength] += chunk.length;\n\n  if (\n    this[kPerMessageDeflate]._maxPayload < 1 ||\n    this[kTotalLength] <= this[kPerMessageDeflate]._maxPayload\n  ) {\n    this[kBuffers].push(chunk);\n    return;\n  }\n\n  this[kError] = new RangeError('Max payload size exceeded');\n  this[kError][kStatusCode] = 1009;\n  this.removeListener('data', inflateOnData);\n  this.reset();\n}\n\n/**\n * The listener of the `zlib.InflateRaw` stream `'error'` event.\n *\n * @param {Error} err The emitted error\n * @private\n */\nfunction inflateOnError(err) {\n  //\n  // There is no need to call `Zlib#close()` as the handle is automatically\n  // closed when an error is emitted.\n  //\n  this[kPerMessageDeflate]._inflate = null;\n  err[kStatusCode] = 1007;\n  this[kCallback](err);\n}\n","'use strict';\n\nconst { Writable } = require('stream');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst {\n  BINARY_TYPES,\n  EMPTY_BUFFER,\n  kStatusCode,\n  kWebSocket\n} = require('./constants');\nconst { concat, toArrayBuffer, unmask } = require('./buffer-util');\nconst { isValidStatusCode, isValidUTF8 } = require('./validation');\n\nconst GET_INFO = 0;\nconst GET_PAYLOAD_LENGTH_16 = 1;\nconst GET_PAYLOAD_LENGTH_64 = 2;\nconst GET_MASK = 3;\nconst GET_DATA = 4;\nconst INFLATING = 5;\n\n/**\n * HyBi Receiver implementation.\n *\n * @extends stream.Writable\n */\nclass Receiver extends Writable {\n  /**\n   * Creates a Receiver instance.\n   *\n   * @param {String} [binaryType=nodebuffer] The type for binary data\n   * @param {Object} [extensions] An object containing the negotiated extensions\n   * @param {Boolean} [isServer=false] Specifies whether to operate in client or\n   *     server mode\n   * @param {Number} [maxPayload=0] The maximum allowed message length\n   */\n  constructor(binaryType, extensions, isServer, maxPayload) {\n    super();\n\n    this._binaryType = binaryType || BINARY_TYPES[0];\n    this[kWebSocket] = undefined;\n    this._extensions = extensions || {};\n    this._isServer = !!isServer;\n    this._maxPayload = maxPayload | 0;\n\n    this._bufferedBytes = 0;\n    this._buffers = [];\n\n    this._compressed = false;\n    this._payloadLength = 0;\n    this._mask = undefined;\n    this._fragmented = 0;\n    this._masked = false;\n    this._fin = false;\n    this._opcode = 0;\n\n    this._totalPayloadLength = 0;\n    this._messageLength = 0;\n    this._fragments = [];\n\n    this._state = GET_INFO;\n    this._loop = false;\n  }\n\n  /**\n   * Implements `Writable.prototype._write()`.\n   *\n   * @param {Buffer} chunk The chunk of data to write\n   * @param {String} encoding The character encoding of `chunk`\n   * @param {Function} cb Callback\n   * @private\n   */\n  _write(chunk, encoding, cb) {\n    if (this._opcode === 0x08 && this._state == GET_INFO) return cb();\n\n    this._bufferedBytes += chunk.length;\n    this._buffers.push(chunk);\n    this.startLoop(cb);\n  }\n\n  /**\n   * Consumes `n` bytes from the buffered data.\n   *\n   * @param {Number} n The number of bytes to consume\n   * @return {Buffer} The consumed bytes\n   * @private\n   */\n  consume(n) {\n    this._bufferedBytes -= n;\n\n    if (n === this._buffers[0].length) return this._buffers.shift();\n\n    if (n < this._buffers[0].length) {\n      const buf = this._buffers[0];\n      this._buffers[0] = buf.slice(n);\n      return buf.slice(0, n);\n    }\n\n    const dst = Buffer.allocUnsafe(n);\n\n    do {\n      const buf = this._buffers[0];\n      const offset = dst.length - n;\n\n      if (n >= buf.length) {\n        dst.set(this._buffers.shift(), offset);\n      } else {\n        dst.set(new Uint8Array(buf.buffer, buf.byteOffset, n), offset);\n        this._buffers[0] = buf.slice(n);\n      }\n\n      n -= buf.length;\n    } while (n > 0);\n\n    return dst;\n  }\n\n  /**\n   * Starts the parsing loop.\n   *\n   * @param {Function} cb Callback\n   * @private\n   */\n  startLoop(cb) {\n    let err;\n    this._loop = true;\n\n    do {\n      switch (this._state) {\n        case GET_INFO:\n          err = this.getInfo();\n          break;\n        case GET_PAYLOAD_LENGTH_16:\n          err = this.getPayloadLength16();\n          break;\n        case GET_PAYLOAD_LENGTH_64:\n          err = this.getPayloadLength64();\n          break;\n        case GET_MASK:\n          this.getMask();\n          break;\n        case GET_DATA:\n          err = this.getData(cb);\n          break;\n        default:\n          // `INFLATING`\n          this._loop = false;\n          return;\n      }\n    } while (this._loop);\n\n    cb(err);\n  }\n\n  /**\n   * Reads the first two bytes of a frame.\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  getInfo() {\n    if (this._bufferedBytes < 2) {\n      this._loop = false;\n      return;\n    }\n\n    const buf = this.consume(2);\n\n    if ((buf[0] & 0x30) !== 0x00) {\n      this._loop = false;\n      return error(RangeError, 'RSV2 and RSV3 must be clear', true, 1002);\n    }\n\n    const compressed = (buf[0] & 0x40) === 0x40;\n\n    if (compressed && !this._extensions[PerMessageDeflate.extensionName]) {\n      this._loop = false;\n      return error(RangeError, 'RSV1 must be clear', true, 1002);\n    }\n\n    this._fin = (buf[0] & 0x80) === 0x80;\n    this._opcode = buf[0] & 0x0f;\n    this._payloadLength = buf[1] & 0x7f;\n\n    if (this._opcode === 0x00) {\n      if (compressed) {\n        this._loop = false;\n        return error(RangeError, 'RSV1 must be clear', true, 1002);\n      }\n\n      if (!this._fragmented) {\n        this._loop = false;\n        return error(RangeError, 'invalid opcode 0', true, 1002);\n      }\n\n      this._opcode = this._fragmented;\n    } else if (this._opcode === 0x01 || this._opcode === 0x02) {\n      if (this._fragmented) {\n        this._loop = false;\n        return error(RangeError, `invalid opcode ${this._opcode}`, true, 1002);\n      }\n\n      this._compressed = compressed;\n    } else if (this._opcode > 0x07 && this._opcode < 0x0b) {\n      if (!this._fin) {\n        this._loop = false;\n        return error(RangeError, 'FIN must be set', true, 1002);\n      }\n\n      if (compressed) {\n        this._loop = false;\n        return error(RangeError, 'RSV1 must be clear', true, 1002);\n      }\n\n      if (this._payloadLength > 0x7d) {\n        this._loop = false;\n        return error(\n          RangeError,\n          `invalid payload length ${this._payloadLength}`,\n          true,\n          1002\n        );\n      }\n    } else {\n      this._loop = false;\n      return error(RangeError, `invalid opcode ${this._opcode}`, true, 1002);\n    }\n\n    if (!this._fin && !this._fragmented) this._fragmented = this._opcode;\n    this._masked = (buf[1] & 0x80) === 0x80;\n\n    if (this._isServer) {\n      if (!this._masked) {\n        this._loop = false;\n        return error(RangeError, 'MASK must be set', true, 1002);\n      }\n    } else if (this._masked) {\n      this._loop = false;\n      return error(RangeError, 'MASK must be clear', true, 1002);\n    }\n\n    if (this._payloadLength === 126) this._state = GET_PAYLOAD_LENGTH_16;\n    else if (this._payloadLength === 127) this._state = GET_PAYLOAD_LENGTH_64;\n    else return this.haveLength();\n  }\n\n  /**\n   * Gets extended payload length (7+16).\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  getPayloadLength16() {\n    if (this._bufferedBytes < 2) {\n      this._loop = false;\n      return;\n    }\n\n    this._payloadLength = this.consume(2).readUInt16BE(0);\n    return this.haveLength();\n  }\n\n  /**\n   * Gets extended payload length (7+64).\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  getPayloadLength64() {\n    if (this._bufferedBytes < 8) {\n      this._loop = false;\n      return;\n    }\n\n    const buf = this.consume(8);\n    const num = buf.readUInt32BE(0);\n\n    //\n    // The maximum safe integer in JavaScript is 2^53 - 1. An error is returned\n    // if payload length is greater than this number.\n    //\n    if (num > Math.pow(2, 53 - 32) - 1) {\n      this._loop = false;\n      return error(\n        RangeError,\n        'Unsupported WebSocket frame: payload length > 2^53 - 1',\n        false,\n        1009\n      );\n    }\n\n    this._payloadLength = num * Math.pow(2, 32) + buf.readUInt32BE(4);\n    return this.haveLength();\n  }\n\n  /**\n   * Payload length has been read.\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  haveLength() {\n    if (this._payloadLength && this._opcode < 0x08) {\n      this._totalPayloadLength += this._payloadLength;\n      if (this._totalPayloadLength > this._maxPayload && this._maxPayload > 0) {\n        this._loop = false;\n        return error(RangeError, 'Max payload size exceeded', false, 1009);\n      }\n    }\n\n    if (this._masked) this._state = GET_MASK;\n    else this._state = GET_DATA;\n  }\n\n  /**\n   * Reads mask bytes.\n   *\n   * @private\n   */\n  getMask() {\n    if (this._bufferedBytes < 4) {\n      this._loop = false;\n      return;\n    }\n\n    this._mask = this.consume(4);\n    this._state = GET_DATA;\n  }\n\n  /**\n   * Reads data bytes.\n   *\n   * @param {Function} cb Callback\n   * @return {(Error|RangeError|undefined)} A possible error\n   * @private\n   */\n  getData(cb) {\n    let data = EMPTY_BUFFER;\n\n    if (this._payloadLength) {\n      if (this._bufferedBytes < this._payloadLength) {\n        this._loop = false;\n        return;\n      }\n\n      data = this.consume(this._payloadLength);\n      if (this._masked) unmask(data, this._mask);\n    }\n\n    if (this._opcode > 0x07) return this.controlMessage(data);\n\n    if (this._compressed) {\n      this._state = INFLATING;\n      this.decompress(data, cb);\n      return;\n    }\n\n    if (data.length) {\n      //\n      // This message is not compressed so its lenght is the sum of the payload\n      // length of all fragments.\n      //\n      this._messageLength = this._totalPayloadLength;\n      this._fragments.push(data);\n    }\n\n    return this.dataMessage();\n  }\n\n  /**\n   * Decompresses data.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Function} cb Callback\n   * @private\n   */\n  decompress(data, cb) {\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n\n    perMessageDeflate.decompress(data, this._fin, (err, buf) => {\n      if (err) return cb(err);\n\n      if (buf.length) {\n        this._messageLength += buf.length;\n        if (this._messageLength > this._maxPayload && this._maxPayload > 0) {\n          return cb(\n            error(RangeError, 'Max payload size exceeded', false, 1009)\n          );\n        }\n\n        this._fragments.push(buf);\n      }\n\n      const er = this.dataMessage();\n      if (er) return cb(er);\n\n      this.startLoop(cb);\n    });\n  }\n\n  /**\n   * Handles a data message.\n   *\n   * @return {(Error|undefined)} A possible error\n   * @private\n   */\n  dataMessage() {\n    if (this._fin) {\n      const messageLength = this._messageLength;\n      const fragments = this._fragments;\n\n      this._totalPayloadLength = 0;\n      this._messageLength = 0;\n      this._fragmented = 0;\n      this._fragments = [];\n\n      if (this._opcode === 2) {\n        let data;\n\n        if (this._binaryType === 'nodebuffer') {\n          data = concat(fragments, messageLength);\n        } else if (this._binaryType === 'arraybuffer') {\n          data = toArrayBuffer(concat(fragments, messageLength));\n        } else {\n          data = fragments;\n        }\n\n        this.emit('message', data);\n      } else {\n        const buf = concat(fragments, messageLength);\n\n        if (!isValidUTF8(buf)) {\n          this._loop = false;\n          return error(Error, 'invalid UTF-8 sequence', true, 1007);\n        }\n\n        this.emit('message', buf.toString());\n      }\n    }\n\n    this._state = GET_INFO;\n  }\n\n  /**\n   * Handles a control message.\n   *\n   * @param {Buffer} data Data to handle\n   * @return {(Error|RangeError|undefined)} A possible error\n   * @private\n   */\n  controlMessage(data) {\n    if (this._opcode === 0x08) {\n      this._loop = false;\n\n      if (data.length === 0) {\n        this.emit('conclude', 1005, '');\n        this.end();\n      } else if (data.length === 1) {\n        return error(RangeError, 'invalid payload length 1', true, 1002);\n      } else {\n        const code = data.readUInt16BE(0);\n\n        if (!isValidStatusCode(code)) {\n          return error(RangeError, `invalid status code ${code}`, true, 1002);\n        }\n\n        const buf = data.slice(2);\n\n        if (!isValidUTF8(buf)) {\n          return error(Error, 'invalid UTF-8 sequence', true, 1007);\n        }\n\n        this.emit('conclude', code, buf.toString());\n        this.end();\n      }\n    } else if (this._opcode === 0x09) {\n      this.emit('ping', data);\n    } else {\n      this.emit('pong', data);\n    }\n\n    this._state = GET_INFO;\n  }\n}\n\nmodule.exports = Receiver;\n\n/**\n * Builds an error object.\n *\n * @param {(Error|RangeError)} ErrorCtor The error constructor\n * @param {String} message The error message\n * @param {Boolean} prefix Specifies whether or not to add a default prefix to\n *     `message`\n * @param {Number} statusCode The status code\n * @return {(Error|RangeError)} The error\n * @private\n */\nfunction error(ErrorCtor, message, prefix, statusCode) {\n  const err = new ErrorCtor(\n    prefix ? `Invalid WebSocket frame: ${message}` : message\n  );\n\n  Error.captureStackTrace(err, error);\n  err[kStatusCode] = statusCode;\n  return err;\n}\n","'use strict';\n\nconst { randomFillSync } = require('crypto');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst { EMPTY_BUFFER } = require('./constants');\nconst { isValidStatusCode } = require('./validation');\nconst { mask: applyMask, toBuffer } = require('./buffer-util');\n\nconst mask = Buffer.alloc(4);\n\n/**\n * HyBi Sender implementation.\n */\nclass Sender {\n  /**\n   * Creates a Sender instance.\n   *\n   * @param {net.Socket} socket The connection socket\n   * @param {Object} [extensions] An object containing the negotiated extensions\n   */\n  constructor(socket, extensions) {\n    this._extensions = extensions || {};\n    this._socket = socket;\n\n    this._firstFragment = true;\n    this._compress = false;\n\n    this._bufferedBytes = 0;\n    this._deflating = false;\n    this._queue = [];\n  }\n\n  /**\n   * Frames a piece of data according to the HyBi WebSocket protocol.\n   *\n   * @param {Buffer} data The data to frame\n   * @param {Object} options Options object\n   * @param {Number} options.opcode The opcode\n   * @param {Boolean} [options.readOnly=false] Specifies whether `data` can be\n   *     modified\n   * @param {Boolean} [options.fin=false] Specifies whether or not to set the\n   *     FIN bit\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Boolean} [options.rsv1=false] Specifies whether or not to set the\n   *     RSV1 bit\n   * @return {Buffer[]} The framed data as a list of `Buffer` instances\n   * @public\n   */\n  static frame(data, options) {\n    const merge = options.mask && options.readOnly;\n    let offset = options.mask ? 6 : 2;\n    let payloadLength = data.length;\n\n    if (data.length >= 65536) {\n      offset += 8;\n      payloadLength = 127;\n    } else if (data.length > 125) {\n      offset += 2;\n      payloadLength = 126;\n    }\n\n    const target = Buffer.allocUnsafe(merge ? data.length + offset : offset);\n\n    target[0] = options.fin ? options.opcode | 0x80 : options.opcode;\n    if (options.rsv1) target[0] |= 0x40;\n\n    target[1] = payloadLength;\n\n    if (payloadLength === 126) {\n      target.writeUInt16BE(data.length, 2);\n    } else if (payloadLength === 127) {\n      target.writeUInt32BE(0, 2);\n      target.writeUInt32BE(data.length, 6);\n    }\n\n    if (!options.mask) return [target, data];\n\n    randomFillSync(mask, 0, 4);\n\n    target[1] |= 0x80;\n    target[offset - 4] = mask[0];\n    target[offset - 3] = mask[1];\n    target[offset - 2] = mask[2];\n    target[offset - 1] = mask[3];\n\n    if (merge) {\n      applyMask(data, mask, target, offset, data.length);\n      return [target];\n    }\n\n    applyMask(data, mask, data, 0, data.length);\n    return [target, data];\n  }\n\n  /**\n   * Sends a close message to the other peer.\n   *\n   * @param {Number} [code] The status code component of the body\n   * @param {String} [data] The message component of the body\n   * @param {Boolean} [mask=false] Specifies whether or not to mask the message\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  close(code, data, mask, cb) {\n    let buf;\n\n    if (code === undefined) {\n      buf = EMPTY_BUFFER;\n    } else if (typeof code !== 'number' || !isValidStatusCode(code)) {\n      throw new TypeError('First argument must be a valid error code number');\n    } else if (data === undefined || data === '') {\n      buf = Buffer.allocUnsafe(2);\n      buf.writeUInt16BE(code, 0);\n    } else {\n      const length = Buffer.byteLength(data);\n\n      if (length > 123) {\n        throw new RangeError('The message must not be greater than 123 bytes');\n      }\n\n      buf = Buffer.allocUnsafe(2 + length);\n      buf.writeUInt16BE(code, 0);\n      buf.write(data, 2);\n    }\n\n    if (this._deflating) {\n      this.enqueue([this.doClose, buf, mask, cb]);\n    } else {\n      this.doClose(buf, mask, cb);\n    }\n  }\n\n  /**\n   * Frames and sends a close message.\n   *\n   * @param {Buffer} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  doClose(data, mask, cb) {\n    this.sendFrame(\n      Sender.frame(data, {\n        fin: true,\n        rsv1: false,\n        opcode: 0x08,\n        mask,\n        readOnly: false\n      }),\n      cb\n    );\n  }\n\n  /**\n   * Sends a ping message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  ping(data, mask, cb) {\n    const buf = toBuffer(data);\n\n    if (buf.length > 125) {\n      throw new RangeError('The data size must not be greater than 125 bytes');\n    }\n\n    if (this._deflating) {\n      this.enqueue([this.doPing, buf, mask, toBuffer.readOnly, cb]);\n    } else {\n      this.doPing(buf, mask, toBuffer.readOnly, cb);\n    }\n  }\n\n  /**\n   * Frames and sends a ping message.\n   *\n   * @param {Buffer} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Boolean} [readOnly=false] Specifies whether `data` can be modified\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  doPing(data, mask, readOnly, cb) {\n    this.sendFrame(\n      Sender.frame(data, {\n        fin: true,\n        rsv1: false,\n        opcode: 0x09,\n        mask,\n        readOnly\n      }),\n      cb\n    );\n  }\n\n  /**\n   * Sends a pong message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  pong(data, mask, cb) {\n    const buf = toBuffer(data);\n\n    if (buf.length > 125) {\n      throw new RangeError('The data size must not be greater than 125 bytes');\n    }\n\n    if (this._deflating) {\n      this.enqueue([this.doPong, buf, mask, toBuffer.readOnly, cb]);\n    } else {\n      this.doPong(buf, mask, toBuffer.readOnly, cb);\n    }\n  }\n\n  /**\n   * Frames and sends a pong message.\n   *\n   * @param {Buffer} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Boolean} [readOnly=false] Specifies whether `data` can be modified\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  doPong(data, mask, readOnly, cb) {\n    this.sendFrame(\n      Sender.frame(data, {\n        fin: true,\n        rsv1: false,\n        opcode: 0x0a,\n        mask,\n        readOnly\n      }),\n      cb\n    );\n  }\n\n  /**\n   * Sends a data message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Object} options Options object\n   * @param {Boolean} [options.compress=false] Specifies whether or not to\n   *     compress `data`\n   * @param {Boolean} [options.binary=false] Specifies whether `data` is binary\n   *     or text\n   * @param {Boolean} [options.fin=false] Specifies whether the fragment is the\n   *     last one\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  send(data, options, cb) {\n    const buf = toBuffer(data);\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n    let opcode = options.binary ? 2 : 1;\n    let rsv1 = options.compress;\n\n    if (this._firstFragment) {\n      this._firstFragment = false;\n      if (rsv1 && perMessageDeflate) {\n        rsv1 = buf.length >= perMessageDeflate._threshold;\n      }\n      this._compress = rsv1;\n    } else {\n      rsv1 = false;\n      opcode = 0;\n    }\n\n    if (options.fin) this._firstFragment = true;\n\n    if (perMessageDeflate) {\n      const opts = {\n        fin: options.fin,\n        rsv1,\n        opcode,\n        mask: options.mask,\n        readOnly: toBuffer.readOnly\n      };\n\n      if (this._deflating) {\n        this.enqueue([this.dispatch, buf, this._compress, opts, cb]);\n      } else {\n        this.dispatch(buf, this._compress, opts, cb);\n      }\n    } else {\n      this.sendFrame(\n        Sender.frame(buf, {\n          fin: options.fin,\n          rsv1: false,\n          opcode,\n          mask: options.mask,\n          readOnly: toBuffer.readOnly\n        }),\n        cb\n      );\n    }\n  }\n\n  /**\n   * Dispatches a data message.\n   *\n   * @param {Buffer} data The message to send\n   * @param {Boolean} [compress=false] Specifies whether or not to compress\n   *     `data`\n   * @param {Object} options Options object\n   * @param {Number} options.opcode The opcode\n   * @param {Boolean} [options.readOnly=false] Specifies whether `data` can be\n   *     modified\n   * @param {Boolean} [options.fin=false] Specifies whether or not to set the\n   *     FIN bit\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Boolean} [options.rsv1=false] Specifies whether or not to set the\n   *     RSV1 bit\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  dispatch(data, compress, options, cb) {\n    if (!compress) {\n      this.sendFrame(Sender.frame(data, options), cb);\n      return;\n    }\n\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n\n    this._bufferedBytes += data.length;\n    this._deflating = true;\n    perMessageDeflate.compress(data, options.fin, (_, buf) => {\n      if (this._socket.destroyed) {\n        const err = new Error(\n          'The socket was closed while data was being compressed'\n        );\n\n        if (typeof cb === 'function') cb(err);\n\n        for (let i = 0; i < this._queue.length; i++) {\n          const callback = this._queue[i][4];\n\n          if (typeof callback === 'function') callback(err);\n        }\n\n        return;\n      }\n\n      this._bufferedBytes -= data.length;\n      this._deflating = false;\n      options.readOnly = false;\n      this.sendFrame(Sender.frame(buf, options), cb);\n      this.dequeue();\n    });\n  }\n\n  /**\n   * Executes queued send operations.\n   *\n   * @private\n   */\n  dequeue() {\n    while (!this._deflating && this._queue.length) {\n      const params = this._queue.shift();\n\n      this._bufferedBytes -= params[1].length;\n      Reflect.apply(params[0], this, params.slice(1));\n    }\n  }\n\n  /**\n   * Enqueues a send operation.\n   *\n   * @param {Array} params Send operation parameters.\n   * @private\n   */\n  enqueue(params) {\n    this._bufferedBytes += params[1].length;\n    this._queue.push(params);\n  }\n\n  /**\n   * Sends a frame.\n   *\n   * @param {Buffer[]} list The frame to send\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  sendFrame(list, cb) {\n    if (list.length === 2) {\n      this._socket.cork();\n      this._socket.write(list[0]);\n      this._socket.write(list[1], cb);\n      this._socket.uncork();\n    } else {\n      this._socket.write(list[0], cb);\n    }\n  }\n}\n\nmodule.exports = Sender;\n","'use strict';\n\nconst { Duplex } = require('stream');\n\n/**\n * Emits the `'close'` event on a stream.\n *\n * @param {stream.Duplex} The stream.\n * @private\n */\nfunction emitClose(stream) {\n  stream.emit('close');\n}\n\n/**\n * The listener of the `'end'` event.\n *\n * @private\n */\nfunction duplexOnEnd() {\n  if (!this.destroyed && this._writableState.finished) {\n    this.destroy();\n  }\n}\n\n/**\n * The listener of the `'error'` event.\n *\n * @param {Error} err The error\n * @private\n */\nfunction duplexOnError(err) {\n  this.removeListener('error', duplexOnError);\n  this.destroy();\n  if (this.listenerCount('error') === 0) {\n    // Do not suppress the throwing behavior.\n    this.emit('error', err);\n  }\n}\n\n/**\n * Wraps a `WebSocket` in a duplex stream.\n *\n * @param {WebSocket} ws The `WebSocket` to wrap\n * @param {Object} [options] The options for the `Duplex` constructor\n * @return {stream.Duplex} The duplex stream\n * @public\n */\nfunction createWebSocketStream(ws, options) {\n  let resumeOnReceiverDrain = true;\n\n  function receiverOnDrain() {\n    if (resumeOnReceiverDrain) ws._socket.resume();\n  }\n\n  if (ws.readyState === ws.CONNECTING) {\n    ws.once('open', function open() {\n      ws._receiver.removeAllListeners('drain');\n      ws._receiver.on('drain', receiverOnDrain);\n    });\n  } else {\n    ws._receiver.removeAllListeners('drain');\n    ws._receiver.on('drain', receiverOnDrain);\n  }\n\n  const duplex = new Duplex({\n    ...options,\n    autoDestroy: false,\n    emitClose: false,\n    objectMode: false,\n    writableObjectMode: false\n  });\n\n  ws.on('message', function message(msg) {\n    if (!duplex.push(msg)) {\n      resumeOnReceiverDrain = false;\n      ws._socket.pause();\n    }\n  });\n\n  ws.once('error', function error(err) {\n    if (duplex.destroyed) return;\n\n    duplex.destroy(err);\n  });\n\n  ws.once('close', function close() {\n    if (duplex.destroyed) return;\n\n    duplex.push(null);\n  });\n\n  duplex._destroy = function (err, callback) {\n    if (ws.readyState === ws.CLOSED) {\n      callback(err);\n      process.nextTick(emitClose, duplex);\n      return;\n    }\n\n    let called = false;\n\n    ws.once('error', function error(err) {\n      called = true;\n      callback(err);\n    });\n\n    ws.once('close', function close() {\n      if (!called) callback(err);\n      process.nextTick(emitClose, duplex);\n    });\n    ws.terminate();\n  };\n\n  duplex._final = function (callback) {\n    if (ws.readyState === ws.CONNECTING) {\n      ws.once('open', function open() {\n        duplex._final(callback);\n      });\n      return;\n    }\n\n    // If the value of the `_socket` property is `null` it means that `ws` is a\n    // client websocket and the handshake failed. In fact, when this happens, a\n    // socket is never assigned to the websocket. Wait for the `'error'` event\n    // that will be emitted by the websocket.\n    if (ws._socket === null) return;\n\n    if (ws._socket._writableState.finished) {\n      callback();\n      if (duplex._readableState.endEmitted) duplex.destroy();\n    } else {\n      ws._socket.once('finish', function finish() {\n        // `duplex` is not destroyed here because the `'end'` event will be\n        // emitted on `duplex` after this `'finish'` event. The EOF signaling\n        // `null` chunk is, in fact, pushed when the websocket emits `'close'`.\n        callback();\n      });\n      ws.close();\n    }\n  };\n\n  duplex._read = function () {\n    if (ws.readyState === ws.OPEN && !resumeOnReceiverDrain) {\n      resumeOnReceiverDrain = true;\n      if (!ws._receiver._writableState.needDrain) ws._socket.resume();\n    }\n  };\n\n  duplex._write = function (chunk, encoding, callback) {\n    if (ws.readyState === ws.CONNECTING) {\n      ws.once('open', function open() {\n        duplex._write(chunk, encoding, callback);\n      });\n      return;\n    }\n\n    ws.send(chunk, callback);\n  };\n\n  duplex.on('end', duplexOnEnd);\n  duplex.on('error', duplexOnError);\n  return duplex;\n}\n\nmodule.exports = createWebSocketStream;\n","'use strict';\n\ntry {\n  const isValidUTF8 = require('utf-8-validate');\n\n  exports.isValidUTF8 =\n    typeof isValidUTF8 === 'object'\n      ? isValidUTF8.Validation.isValidUTF8 // utf-8-validate@<3.0.0\n      : isValidUTF8;\n} catch (e) /* istanbul ignore next */ {\n  exports.isValidUTF8 = () => true;\n}\n\n/**\n * Checks if a status code is allowed in a close frame.\n *\n * @param {Number} code The status code\n * @return {Boolean} `true` if the status code is valid, else `false`\n * @public\n */\nexports.isValidStatusCode = (code) => {\n  return (\n    (code >= 1000 &&\n      code <= 1014 &&\n      code !== 1004 &&\n      code !== 1005 &&\n      code !== 1006) ||\n    (code >= 3000 && code <= 4999)\n  );\n};\n","'use strict';\n\nconst EventEmitter = require('events');\nconst { createHash } = require('crypto');\nconst { createServer, STATUS_CODES } = require('http');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst WebSocket = require('./websocket');\nconst { format, parse } = require('./extension');\nconst { GUID, kWebSocket } = require('./constants');\n\nconst keyRegex = /^[+/0-9A-Za-z]{22}==$/;\n\n/**\n * Class representing a WebSocket server.\n *\n * @extends EventEmitter\n */\nclass WebSocketServer extends EventEmitter {\n  /**\n   * Create a `WebSocketServer` instance.\n   *\n   * @param {Object} options Configuration options\n   * @param {Number} [options.backlog=511] The maximum length of the queue of\n   *     pending connections\n   * @param {Boolean} [options.clientTracking=true] Specifies whether or not to\n   *     track clients\n   * @param {Function} [options.handleProtocols] A hook to handle protocols\n   * @param {String} [options.host] The hostname where to bind the server\n   * @param {Number} [options.maxPayload=104857600] The maximum allowed message\n   *     size\n   * @param {Boolean} [options.noServer=false] Enable no server mode\n   * @param {String} [options.path] Accept only connections matching this path\n   * @param {(Boolean|Object)} [options.perMessageDeflate=false] Enable/disable\n   *     permessage-deflate\n   * @param {Number} [options.port] The port where to bind the server\n   * @param {http.Server} [options.server] A pre-created HTTP/S server to use\n   * @param {Function} [options.verifyClient] A hook to reject connections\n   * @param {Function} [callback] A listener for the `listening` event\n   */\n  constructor(options, callback) {\n    super();\n\n    options = {\n      maxPayload: 100 * 1024 * 1024,\n      perMessageDeflate: false,\n      handleProtocols: null,\n      clientTracking: true,\n      verifyClient: null,\n      noServer: false,\n      backlog: null, // use default (511 as implemented in net.js)\n      server: null,\n      host: null,\n      path: null,\n      port: null,\n      ...options\n    };\n\n    if (options.port == null && !options.server && !options.noServer) {\n      throw new TypeError(\n        'One of the \"port\", \"server\", or \"noServer\" options must be specified'\n      );\n    }\n\n    if (options.port != null) {\n      this._server = createServer((req, res) => {\n        const body = STATUS_CODES[426];\n\n        res.writeHead(426, {\n          'Content-Length': body.length,\n          'Content-Type': 'text/plain'\n        });\n        res.end(body);\n      });\n      this._server.listen(\n        options.port,\n        options.host,\n        options.backlog,\n        callback\n      );\n    } else if (options.server) {\n      this._server = options.server;\n    }\n\n    if (this._server) {\n      const emitConnection = this.emit.bind(this, 'connection');\n\n      this._removeListeners = addListeners(this._server, {\n        listening: this.emit.bind(this, 'listening'),\n        error: this.emit.bind(this, 'error'),\n        upgrade: (req, socket, head) => {\n          this.handleUpgrade(req, socket, head, emitConnection);\n        }\n      });\n    }\n\n    if (options.perMessageDeflate === true) options.perMessageDeflate = {};\n    if (options.clientTracking) this.clients = new Set();\n    this.options = options;\n  }\n\n  /**\n   * Returns the bound address, the address family name, and port of the server\n   * as reported by the operating system if listening on an IP socket.\n   * If the server is listening on a pipe or UNIX domain socket, the name is\n   * returned as a string.\n   *\n   * @return {(Object|String|null)} The address of the server\n   * @public\n   */\n  address() {\n    if (this.options.noServer) {\n      throw new Error('The server is operating in \"noServer\" mode');\n    }\n\n    if (!this._server) return null;\n    return this._server.address();\n  }\n\n  /**\n   * Close the server.\n   *\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  close(cb) {\n    if (cb) this.once('close', cb);\n\n    //\n    // Terminate all associated clients.\n    //\n    if (this.clients) {\n      for (const client of this.clients) client.terminate();\n    }\n\n    const server = this._server;\n\n    if (server) {\n      this._removeListeners();\n      this._removeListeners = this._server = null;\n\n      //\n      // Close the http server if it was internally created.\n      //\n      if (this.options.port != null) {\n        server.close(() => this.emit('close'));\n        return;\n      }\n    }\n\n    process.nextTick(emitClose, this);\n  }\n\n  /**\n   * See if a given request should be handled by this server instance.\n   *\n   * @param {http.IncomingMessage} req Request object to inspect\n   * @return {Boolean} `true` if the request is valid, else `false`\n   * @public\n   */\n  shouldHandle(req) {\n    if (this.options.path) {\n      const index = req.url.indexOf('?');\n      const pathname = index !== -1 ? req.url.slice(0, index) : req.url;\n\n      if (pathname !== this.options.path) return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Handle a HTTP Upgrade request.\n   *\n   * @param {http.IncomingMessage} req The request object\n   * @param {net.Socket} socket The network socket between the server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Function} cb Callback\n   * @public\n   */\n  handleUpgrade(req, socket, head, cb) {\n    socket.on('error', socketOnError);\n\n    const key =\n      req.headers['sec-websocket-key'] !== undefined\n        ? req.headers['sec-websocket-key'].trim()\n        : false;\n    const version = +req.headers['sec-websocket-version'];\n    const extensions = {};\n\n    if (\n      req.method !== 'GET' ||\n      req.headers.upgrade.toLowerCase() !== 'websocket' ||\n      !key ||\n      !keyRegex.test(key) ||\n      (version !== 8 && version !== 13) ||\n      !this.shouldHandle(req)\n    ) {\n      return abortHandshake(socket, 400);\n    }\n\n    if (this.options.perMessageDeflate) {\n      const perMessageDeflate = new PerMessageDeflate(\n        this.options.perMessageDeflate,\n        true,\n        this.options.maxPayload\n      );\n\n      try {\n        const offers = parse(req.headers['sec-websocket-extensions']);\n\n        if (offers[PerMessageDeflate.extensionName]) {\n          perMessageDeflate.accept(offers[PerMessageDeflate.extensionName]);\n          extensions[PerMessageDeflate.extensionName] = perMessageDeflate;\n        }\n      } catch (err) {\n        return abortHandshake(socket, 400);\n      }\n    }\n\n    //\n    // Optionally call external client verification handler.\n    //\n    if (this.options.verifyClient) {\n      const info = {\n        origin:\n          req.headers[`${version === 8 ? 'sec-websocket-origin' : 'origin'}`],\n        secure: !!(req.connection.authorized || req.connection.encrypted),\n        req\n      };\n\n      if (this.options.verifyClient.length === 2) {\n        this.options.verifyClient(info, (verified, code, message, headers) => {\n          if (!verified) {\n            return abortHandshake(socket, code || 401, message, headers);\n          }\n\n          this.completeUpgrade(key, extensions, req, socket, head, cb);\n        });\n        return;\n      }\n\n      if (!this.options.verifyClient(info)) return abortHandshake(socket, 401);\n    }\n\n    this.completeUpgrade(key, extensions, req, socket, head, cb);\n  }\n\n  /**\n   * Upgrade the connection to WebSocket.\n   *\n   * @param {String} key The value of the `Sec-WebSocket-Key` header\n   * @param {Object} extensions The accepted extensions\n   * @param {http.IncomingMessage} req The request object\n   * @param {net.Socket} socket The network socket between the server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Function} cb Callback\n   * @throws {Error} If called more than once with the same socket\n   * @private\n   */\n  completeUpgrade(key, extensions, req, socket, head, cb) {\n    //\n    // Destroy the socket if the client has already sent a FIN packet.\n    //\n    if (!socket.readable || !socket.writable) return socket.destroy();\n\n    if (socket[kWebSocket]) {\n      throw new Error(\n        'server.handleUpgrade() was called more than once with the same ' +\n          'socket, possibly due to a misconfiguration'\n      );\n    }\n\n    const digest = createHash('sha1')\n      .update(key + GUID)\n      .digest('base64');\n\n    const headers = [\n      'HTTP/1.1 101 Switching Protocols',\n      'Upgrade: websocket',\n      'Connection: Upgrade',\n      `Sec-WebSocket-Accept: ${digest}`\n    ];\n\n    const ws = new WebSocket(null);\n    let protocol = req.headers['sec-websocket-protocol'];\n\n    if (protocol) {\n      protocol = protocol.trim().split(/ *, */);\n\n      //\n      // Optionally call external protocol selection handler.\n      //\n      if (this.options.handleProtocols) {\n        protocol = this.options.handleProtocols(protocol, req);\n      } else {\n        protocol = protocol[0];\n      }\n\n      if (protocol) {\n        headers.push(`Sec-WebSocket-Protocol: ${protocol}`);\n        ws._protocol = protocol;\n      }\n    }\n\n    if (extensions[PerMessageDeflate.extensionName]) {\n      const params = extensions[PerMessageDeflate.extensionName].params;\n      const value = format({\n        [PerMessageDeflate.extensionName]: [params]\n      });\n      headers.push(`Sec-WebSocket-Extensions: ${value}`);\n      ws._extensions = extensions;\n    }\n\n    //\n    // Allow external modification/inspection of handshake headers.\n    //\n    this.emit('headers', headers, req);\n\n    socket.write(headers.concat('\\r\\n').join('\\r\\n'));\n    socket.removeListener('error', socketOnError);\n\n    ws.setSocket(socket, head, this.options.maxPayload);\n\n    if (this.clients) {\n      this.clients.add(ws);\n      ws.on('close', () => this.clients.delete(ws));\n    }\n\n    cb(ws, req);\n  }\n}\n\nmodule.exports = WebSocketServer;\n\n/**\n * Add event listeners on an `EventEmitter` using a map of <event, listener>\n * pairs.\n *\n * @param {EventEmitter} server The event emitter\n * @param {Object.<String, Function>} map The listeners to add\n * @return {Function} A function that will remove the added listeners when\n *     called\n * @private\n */\nfunction addListeners(server, map) {\n  for (const event of Object.keys(map)) server.on(event, map[event]);\n\n  return function removeListeners() {\n    for (const event of Object.keys(map)) {\n      server.removeListener(event, map[event]);\n    }\n  };\n}\n\n/**\n * Emit a `'close'` event on an `EventEmitter`.\n *\n * @param {EventEmitter} server The event emitter\n * @private\n */\nfunction emitClose(server) {\n  server.emit('close');\n}\n\n/**\n * Handle premature socket errors.\n *\n * @private\n */\nfunction socketOnError() {\n  this.destroy();\n}\n\n/**\n * Close the connection when preconditions are not fulfilled.\n *\n * @param {net.Socket} socket The socket of the upgrade request\n * @param {Number} code The HTTP response status code\n * @param {String} [message] The HTTP response body\n * @param {Object} [headers] Additional HTTP response headers\n * @private\n */\nfunction abortHandshake(socket, code, message, headers) {\n  if (socket.writable) {\n    message = message || STATUS_CODES[code];\n    headers = {\n      Connection: 'close',\n      'Content-Type': 'text/html',\n      'Content-Length': Buffer.byteLength(message),\n      ...headers\n    };\n\n    socket.write(\n      `HTTP/1.1 ${code} ${STATUS_CODES[code]}\\r\\n` +\n        Object.keys(headers)\n          .map((h) => `${h}: ${headers[h]}`)\n          .join('\\r\\n') +\n        '\\r\\n\\r\\n' +\n        message\n    );\n  }\n\n  socket.removeListener('error', socketOnError);\n  socket.destroy();\n}\n","'use strict';\n\nconst EventEmitter = require('events');\nconst https = require('https');\nconst http = require('http');\nconst net = require('net');\nconst tls = require('tls');\nconst { randomBytes, createHash } = require('crypto');\nconst { URL } = require('url');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst Receiver = require('./receiver');\nconst Sender = require('./sender');\nconst {\n  BINARY_TYPES,\n  EMPTY_BUFFER,\n  GUID,\n  kStatusCode,\n  kWebSocket,\n  NOOP\n} = require('./constants');\nconst { addEventListener, removeEventListener } = require('./event-target');\nconst { format, parse } = require('./extension');\nconst { toBuffer } = require('./buffer-util');\n\nconst readyStates = ['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED'];\nconst protocolVersions = [8, 13];\nconst closeTimeout = 30 * 1000;\n\n/**\n * Class representing a WebSocket.\n *\n * @extends EventEmitter\n */\nclass WebSocket extends EventEmitter {\n  /**\n   * Create a new `WebSocket`.\n   *\n   * @param {(String|url.URL)} address The URL to which to connect\n   * @param {(String|String[])} [protocols] The subprotocols\n   * @param {Object} [options] Connection options\n   */\n  constructor(address, protocols, options) {\n    super();\n\n    this._binaryType = BINARY_TYPES[0];\n    this._closeCode = 1006;\n    this._closeFrameReceived = false;\n    this._closeFrameSent = false;\n    this._closeMessage = '';\n    this._closeTimer = null;\n    this._extensions = {};\n    this._protocol = '';\n    this._readyState = WebSocket.CONNECTING;\n    this._receiver = null;\n    this._sender = null;\n    this._socket = null;\n\n    if (address !== null) {\n      this._bufferedAmount = 0;\n      this._isServer = false;\n      this._redirects = 0;\n\n      if (Array.isArray(protocols)) {\n        protocols = protocols.join(', ');\n      } else if (typeof protocols === 'object' && protocols !== null) {\n        options = protocols;\n        protocols = undefined;\n      }\n\n      initAsClient(this, address, protocols, options);\n    } else {\n      this._isServer = true;\n    }\n  }\n\n  /**\n   * This deviates from the WHATWG interface since ws doesn't support the\n   * required default \"blob\" type (instead we define a custom \"nodebuffer\"\n   * type).\n   *\n   * @type {String}\n   */\n  get binaryType() {\n    return this._binaryType;\n  }\n\n  set binaryType(type) {\n    if (!BINARY_TYPES.includes(type)) return;\n\n    this._binaryType = type;\n\n    //\n    // Allow to change `binaryType` on the fly.\n    //\n    if (this._receiver) this._receiver._binaryType = type;\n  }\n\n  /**\n   * @type {Number}\n   */\n  get bufferedAmount() {\n    if (!this._socket) return this._bufferedAmount;\n\n    return this._socket._writableState.length + this._sender._bufferedBytes;\n  }\n\n  /**\n   * @type {String}\n   */\n  get extensions() {\n    return Object.keys(this._extensions).join();\n  }\n\n  /**\n   * @type {String}\n   */\n  get protocol() {\n    return this._protocol;\n  }\n\n  /**\n   * @type {Number}\n   */\n  get readyState() {\n    return this._readyState;\n  }\n\n  /**\n   * @type {String}\n   */\n  get url() {\n    return this._url;\n  }\n\n  /**\n   * Set up the socket and the internal resources.\n   *\n   * @param {net.Socket} socket The network socket between the server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Number} [maxPayload=0] The maximum allowed message size\n   * @private\n   */\n  setSocket(socket, head, maxPayload) {\n    const receiver = new Receiver(\n      this.binaryType,\n      this._extensions,\n      this._isServer,\n      maxPayload\n    );\n\n    this._sender = new Sender(socket, this._extensions);\n    this._receiver = receiver;\n    this._socket = socket;\n\n    receiver[kWebSocket] = this;\n    socket[kWebSocket] = this;\n\n    receiver.on('conclude', receiverOnConclude);\n    receiver.on('drain', receiverOnDrain);\n    receiver.on('error', receiverOnError);\n    receiver.on('message', receiverOnMessage);\n    receiver.on('ping', receiverOnPing);\n    receiver.on('pong', receiverOnPong);\n\n    socket.setTimeout(0);\n    socket.setNoDelay();\n\n    if (head.length > 0) socket.unshift(head);\n\n    socket.on('close', socketOnClose);\n    socket.on('data', socketOnData);\n    socket.on('end', socketOnEnd);\n    socket.on('error', socketOnError);\n\n    this._readyState = WebSocket.OPEN;\n    this.emit('open');\n  }\n\n  /**\n   * Emit the `'close'` event.\n   *\n   * @private\n   */\n  emitClose() {\n    if (!this._socket) {\n      this._readyState = WebSocket.CLOSED;\n      this.emit('close', this._closeCode, this._closeMessage);\n      return;\n    }\n\n    if (this._extensions[PerMessageDeflate.extensionName]) {\n      this._extensions[PerMessageDeflate.extensionName].cleanup();\n    }\n\n    this._receiver.removeAllListeners();\n    this._readyState = WebSocket.CLOSED;\n    this.emit('close', this._closeCode, this._closeMessage);\n  }\n\n  /**\n   * Start a closing handshake.\n   *\n   *          +----------+   +-----------+   +----------+\n   *     - - -|ws.close()|-->|close frame|-->|ws.close()|- - -\n   *    |     +----------+   +-----------+   +----------+     |\n   *          +----------+   +-----------+         |\n   * CLOSING  |ws.close()|<--|close frame|<--+-----+       CLOSING\n   *          +----------+   +-----------+   |\n   *    |           |                        |   +---+        |\n   *                +------------------------+-->|fin| - - - -\n   *    |         +---+                      |   +---+\n   *     - - - - -|fin|<---------------------+\n   *              +---+\n   *\n   * @param {Number} [code] Status code explaining why the connection is closing\n   * @param {String} [data] A string explaining why the connection is closing\n   * @public\n   */\n  close(code, data) {\n    if (this.readyState === WebSocket.CLOSED) return;\n    if (this.readyState === WebSocket.CONNECTING) {\n      const msg = 'WebSocket was closed before the connection was established';\n      return abortHandshake(this, this._req, msg);\n    }\n\n    if (this.readyState === WebSocket.CLOSING) {\n      if (this._closeFrameSent && this._closeFrameReceived) this._socket.end();\n      return;\n    }\n\n    this._readyState = WebSocket.CLOSING;\n    this._sender.close(code, data, !this._isServer, (err) => {\n      //\n      // This error is handled by the `'error'` listener on the socket. We only\n      // want to know if the close frame has been sent here.\n      //\n      if (err) return;\n\n      this._closeFrameSent = true;\n      if (this._closeFrameReceived) this._socket.end();\n    });\n\n    //\n    // Specify a timeout for the closing handshake to complete.\n    //\n    this._closeTimer = setTimeout(\n      this._socket.destroy.bind(this._socket),\n      closeTimeout\n    );\n  }\n\n  /**\n   * Send a ping.\n   *\n   * @param {*} [data] The data to send\n   * @param {Boolean} [mask] Indicates whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when the ping is sent\n   * @public\n   */\n  ping(data, mask, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof data === 'function') {\n      cb = data;\n      data = mask = undefined;\n    } else if (typeof mask === 'function') {\n      cb = mask;\n      mask = undefined;\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    if (mask === undefined) mask = !this._isServer;\n    this._sender.ping(data || EMPTY_BUFFER, mask, cb);\n  }\n\n  /**\n   * Send a pong.\n   *\n   * @param {*} [data] The data to send\n   * @param {Boolean} [mask] Indicates whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when the pong is sent\n   * @public\n   */\n  pong(data, mask, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof data === 'function') {\n      cb = data;\n      data = mask = undefined;\n    } else if (typeof mask === 'function') {\n      cb = mask;\n      mask = undefined;\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    if (mask === undefined) mask = !this._isServer;\n    this._sender.pong(data || EMPTY_BUFFER, mask, cb);\n  }\n\n  /**\n   * Send a data message.\n   *\n   * @param {*} data The message to send\n   * @param {Object} [options] Options object\n   * @param {Boolean} [options.compress] Specifies whether or not to compress\n   *     `data`\n   * @param {Boolean} [options.binary] Specifies whether `data` is binary or\n   *     text\n   * @param {Boolean} [options.fin=true] Specifies whether the fragment is the\n   *     last one\n   * @param {Boolean} [options.mask] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when data is written out\n   * @public\n   */\n  send(data, options, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof options === 'function') {\n      cb = options;\n      options = {};\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    const opts = {\n      binary: typeof data !== 'string',\n      mask: !this._isServer,\n      compress: true,\n      fin: true,\n      ...options\n    };\n\n    if (!this._extensions[PerMessageDeflate.extensionName]) {\n      opts.compress = false;\n    }\n\n    this._sender.send(data || EMPTY_BUFFER, opts, cb);\n  }\n\n  /**\n   * Forcibly close the connection.\n   *\n   * @public\n   */\n  terminate() {\n    if (this.readyState === WebSocket.CLOSED) return;\n    if (this.readyState === WebSocket.CONNECTING) {\n      const msg = 'WebSocket was closed before the connection was established';\n      return abortHandshake(this, this._req, msg);\n    }\n\n    if (this._socket) {\n      this._readyState = WebSocket.CLOSING;\n      this._socket.destroy();\n    }\n  }\n}\n\nreadyStates.forEach((readyState, i) => {\n  const descriptor = { enumerable: true, value: i };\n\n  Object.defineProperty(WebSocket.prototype, readyState, descriptor);\n  Object.defineProperty(WebSocket, readyState, descriptor);\n});\n\n[\n  'binaryType',\n  'bufferedAmount',\n  'extensions',\n  'protocol',\n  'readyState',\n  'url'\n].forEach((property) => {\n  Object.defineProperty(WebSocket.prototype, property, { enumerable: true });\n});\n\n//\n// Add the `onopen`, `onerror`, `onclose`, and `onmessage` attributes.\n// See https://html.spec.whatwg.org/multipage/comms.html#the-websocket-interface\n//\n['open', 'error', 'close', 'message'].forEach((method) => {\n  Object.defineProperty(WebSocket.prototype, `on${method}`, {\n    configurable: true,\n    enumerable: true,\n    /**\n     * Return the listener of the event.\n     *\n     * @return {(Function|undefined)} The event listener or `undefined`\n     * @public\n     */\n    get() {\n      const listeners = this.listeners(method);\n      for (let i = 0; i < listeners.length; i++) {\n        if (listeners[i]._listener) return listeners[i]._listener;\n      }\n\n      return undefined;\n    },\n    /**\n     * Add a listener for the event.\n     *\n     * @param {Function} listener The listener to add\n     * @public\n     */\n    set(listener) {\n      const listeners = this.listeners(method);\n      for (let i = 0; i < listeners.length; i++) {\n        //\n        // Remove only the listeners added via `addEventListener`.\n        //\n        if (listeners[i]._listener) this.removeListener(method, listeners[i]);\n      }\n      this.addEventListener(method, listener);\n    }\n  });\n});\n\nWebSocket.prototype.addEventListener = addEventListener;\nWebSocket.prototype.removeEventListener = removeEventListener;\n\nmodule.exports = WebSocket;\n\n/**\n * Initialize a WebSocket client.\n *\n * @param {WebSocket} websocket The client to initialize\n * @param {(String|url.URL)} address The URL to which to connect\n * @param {String} [protocols] The subprotocols\n * @param {Object} [options] Connection options\n * @param {(Boolean|Object)} [options.perMessageDeflate=true] Enable/disable\n *     permessage-deflate\n * @param {Number} [options.handshakeTimeout] Timeout in milliseconds for the\n *     handshake request\n * @param {Number} [options.protocolVersion=13] Value of the\n *     `Sec-WebSocket-Version` header\n * @param {String} [options.origin] Value of the `Origin` or\n *     `Sec-WebSocket-Origin` header\n * @param {Number} [options.maxPayload=104857600] The maximum allowed message\n *     size\n * @param {Boolean} [options.followRedirects=false] Whether or not to follow\n *     redirects\n * @param {Number} [options.maxRedirects=10] The maximum number of redirects\n *     allowed\n * @private\n */\nfunction initAsClient(websocket, address, protocols, options) {\n  const opts = {\n    protocolVersion: protocolVersions[1],\n    maxPayload: 100 * 1024 * 1024,\n    perMessageDeflate: true,\n    followRedirects: false,\n    maxRedirects: 10,\n    ...options,\n    createConnection: undefined,\n    socketPath: undefined,\n    hostname: undefined,\n    protocol: undefined,\n    timeout: undefined,\n    method: undefined,\n    host: undefined,\n    path: undefined,\n    port: undefined\n  };\n\n  if (!protocolVersions.includes(opts.protocolVersion)) {\n    throw new RangeError(\n      `Unsupported protocol version: ${opts.protocolVersion} ` +\n        `(supported versions: ${protocolVersions.join(', ')})`\n    );\n  }\n\n  let parsedUrl;\n\n  if (address instanceof URL) {\n    parsedUrl = address;\n    websocket._url = address.href;\n  } else {\n    parsedUrl = new URL(address);\n    websocket._url = address;\n  }\n\n  const isUnixSocket = parsedUrl.protocol === 'ws+unix:';\n\n  if (!parsedUrl.host && (!isUnixSocket || !parsedUrl.pathname)) {\n    throw new Error(`Invalid URL: ${websocket.url}`);\n  }\n\n  const isSecure =\n    parsedUrl.protocol === 'wss:' || parsedUrl.protocol === 'https:';\n  const defaultPort = isSecure ? 443 : 80;\n  const key = randomBytes(16).toString('base64');\n  const get = isSecure ? https.get : http.get;\n  let perMessageDeflate;\n\n  opts.createConnection = isSecure ? tlsConnect : netConnect;\n  opts.defaultPort = opts.defaultPort || defaultPort;\n  opts.port = parsedUrl.port || defaultPort;\n  opts.host = parsedUrl.hostname.startsWith('[')\n    ? parsedUrl.hostname.slice(1, -1)\n    : parsedUrl.hostname;\n  opts.headers = {\n    'Sec-WebSocket-Version': opts.protocolVersion,\n    'Sec-WebSocket-Key': key,\n    Connection: 'Upgrade',\n    Upgrade: 'websocket',\n    ...opts.headers\n  };\n  opts.path = parsedUrl.pathname + parsedUrl.search;\n  opts.timeout = opts.handshakeTimeout;\n\n  if (opts.perMessageDeflate) {\n    perMessageDeflate = new PerMessageDeflate(\n      opts.perMessageDeflate !== true ? opts.perMessageDeflate : {},\n      false,\n      opts.maxPayload\n    );\n    opts.headers['Sec-WebSocket-Extensions'] = format({\n      [PerMessageDeflate.extensionName]: perMessageDeflate.offer()\n    });\n  }\n  if (protocols) {\n    opts.headers['Sec-WebSocket-Protocol'] = protocols;\n  }\n  if (opts.origin) {\n    if (opts.protocolVersion < 13) {\n      opts.headers['Sec-WebSocket-Origin'] = opts.origin;\n    } else {\n      opts.headers.Origin = opts.origin;\n    }\n  }\n  if (parsedUrl.username || parsedUrl.password) {\n    opts.auth = `${parsedUrl.username}:${parsedUrl.password}`;\n  }\n\n  if (isUnixSocket) {\n    const parts = opts.path.split(':');\n\n    opts.socketPath = parts[0];\n    opts.path = parts[1];\n  }\n\n  let req = (websocket._req = get(opts));\n\n  if (opts.timeout) {\n    req.on('timeout', () => {\n      abortHandshake(websocket, req, 'Opening handshake has timed out');\n    });\n  }\n\n  req.on('error', (err) => {\n    if (websocket._req.aborted) return;\n\n    req = websocket._req = null;\n    websocket._readyState = WebSocket.CLOSING;\n    websocket.emit('error', err);\n    websocket.emitClose();\n  });\n\n  req.on('response', (res) => {\n    const location = res.headers.location;\n    const statusCode = res.statusCode;\n\n    if (\n      location &&\n      opts.followRedirects &&\n      statusCode >= 300 &&\n      statusCode < 400\n    ) {\n      if (++websocket._redirects > opts.maxRedirects) {\n        abortHandshake(websocket, req, 'Maximum redirects exceeded');\n        return;\n      }\n\n      req.abort();\n\n      const addr = new URL(location, address);\n\n      initAsClient(websocket, addr, protocols, options);\n    } else if (!websocket.emit('unexpected-response', req, res)) {\n      abortHandshake(\n        websocket,\n        req,\n        `Unexpected server response: ${res.statusCode}`\n      );\n    }\n  });\n\n  req.on('upgrade', (res, socket, head) => {\n    websocket.emit('upgrade', res);\n\n    //\n    // The user may have closed the connection from a listener of the `upgrade`\n    // event.\n    //\n    if (websocket.readyState !== WebSocket.CONNECTING) return;\n\n    req = websocket._req = null;\n\n    const digest = createHash('sha1')\n      .update(key + GUID)\n      .digest('base64');\n\n    if (res.headers['sec-websocket-accept'] !== digest) {\n      abortHandshake(websocket, socket, 'Invalid Sec-WebSocket-Accept header');\n      return;\n    }\n\n    const serverProt = res.headers['sec-websocket-protocol'];\n    const protList = (protocols || '').split(/, */);\n    let protError;\n\n    if (!protocols && serverProt) {\n      protError = 'Server sent a subprotocol but none was requested';\n    } else if (protocols && !serverProt) {\n      protError = 'Server sent no subprotocol';\n    } else if (serverProt && !protList.includes(serverProt)) {\n      protError = 'Server sent an invalid subprotocol';\n    }\n\n    if (protError) {\n      abortHandshake(websocket, socket, protError);\n      return;\n    }\n\n    if (serverProt) websocket._protocol = serverProt;\n\n    if (perMessageDeflate) {\n      try {\n        const extensions = parse(res.headers['sec-websocket-extensions']);\n\n        if (extensions[PerMessageDeflate.extensionName]) {\n          perMessageDeflate.accept(extensions[PerMessageDeflate.extensionName]);\n          websocket._extensions[\n            PerMessageDeflate.extensionName\n          ] = perMessageDeflate;\n        }\n      } catch (err) {\n        abortHandshake(\n          websocket,\n          socket,\n          'Invalid Sec-WebSocket-Extensions header'\n        );\n        return;\n      }\n    }\n\n    websocket.setSocket(socket, head, opts.maxPayload);\n  });\n}\n\n/**\n * Create a `net.Socket` and initiate a connection.\n *\n * @param {Object} options Connection options\n * @return {net.Socket} The newly created socket used to start the connection\n * @private\n */\nfunction netConnect(options) {\n  options.path = options.socketPath;\n  return net.connect(options);\n}\n\n/**\n * Create a `tls.TLSSocket` and initiate a connection.\n *\n * @param {Object} options Connection options\n * @return {tls.TLSSocket} The newly created socket used to start the connection\n * @private\n */\nfunction tlsConnect(options) {\n  options.path = undefined;\n\n  if (!options.servername && options.servername !== '') {\n    options.servername = options.host;\n  }\n\n  return tls.connect(options);\n}\n\n/**\n * Abort the handshake and emit an error.\n *\n * @param {WebSocket} websocket The WebSocket instance\n * @param {(http.ClientRequest|net.Socket)} stream The request to abort or the\n *     socket to destroy\n * @param {String} message The error message\n * @private\n */\nfunction abortHandshake(websocket, stream, message) {\n  websocket._readyState = WebSocket.CLOSING;\n\n  const err = new Error(message);\n  Error.captureStackTrace(err, abortHandshake);\n\n  if (stream.setHeader) {\n    stream.abort();\n    stream.once('abort', websocket.emitClose.bind(websocket));\n    websocket.emit('error', err);\n  } else {\n    stream.destroy(err);\n    stream.once('error', websocket.emit.bind(websocket, 'error'));\n    stream.once('close', websocket.emitClose.bind(websocket));\n  }\n}\n\n/**\n * Handle cases where the `ping()`, `pong()`, or `send()` methods are called\n * when the `readyState` attribute is `CLOSING` or `CLOSED`.\n *\n * @param {WebSocket} websocket The WebSocket instance\n * @param {*} [data] The data to send\n * @param {Function} [cb] Callback\n * @private\n */\nfunction sendAfterClose(websocket, data, cb) {\n  if (data) {\n    const length = toBuffer(data).length;\n\n    //\n    // The `_bufferedAmount` property is used only when the peer is a client and\n    // the opening handshake fails. Under these circumstances, in fact, the\n    // `setSocket()` method is not called, so the `_socket` and `_sender`\n    // properties are set to `null`.\n    //\n    if (websocket._socket) websocket._sender._bufferedBytes += length;\n    else websocket._bufferedAmount += length;\n  }\n\n  if (cb) {\n    const err = new Error(\n      `WebSocket is not open: readyState ${websocket.readyState} ` +\n        `(${readyStates[websocket.readyState]})`\n    );\n    cb(err);\n  }\n}\n\n/**\n * The listener of the `Receiver` `'conclude'` event.\n *\n * @param {Number} code The status code\n * @param {String} reason The reason for closing\n * @private\n */\nfunction receiverOnConclude(code, reason) {\n  const websocket = this[kWebSocket];\n\n  websocket._socket.removeListener('data', socketOnData);\n  websocket._socket.resume();\n\n  websocket._closeFrameReceived = true;\n  websocket._closeMessage = reason;\n  websocket._closeCode = code;\n\n  if (code === 1005) websocket.close();\n  else websocket.close(code, reason);\n}\n\n/**\n * The listener of the `Receiver` `'drain'` event.\n *\n * @private\n */\nfunction receiverOnDrain() {\n  this[kWebSocket]._socket.resume();\n}\n\n/**\n * The listener of the `Receiver` `'error'` event.\n *\n * @param {(RangeError|Error)} err The emitted error\n * @private\n */\nfunction receiverOnError(err) {\n  const websocket = this[kWebSocket];\n\n  websocket._socket.removeListener('data', socketOnData);\n\n  websocket._readyState = WebSocket.CLOSING;\n  websocket._closeCode = err[kStatusCode];\n  websocket.emit('error', err);\n  websocket._socket.destroy();\n}\n\n/**\n * The listener of the `Receiver` `'finish'` event.\n *\n * @private\n */\nfunction receiverOnFinish() {\n  this[kWebSocket].emitClose();\n}\n\n/**\n * The listener of the `Receiver` `'message'` event.\n *\n * @param {(String|Buffer|ArrayBuffer|Buffer[])} data The message\n * @private\n */\nfunction receiverOnMessage(data) {\n  this[kWebSocket].emit('message', data);\n}\n\n/**\n * The listener of the `Receiver` `'ping'` event.\n *\n * @param {Buffer} data The data included in the ping frame\n * @private\n */\nfunction receiverOnPing(data) {\n  const websocket = this[kWebSocket];\n\n  websocket.pong(data, !websocket._isServer, NOOP);\n  websocket.emit('ping', data);\n}\n\n/**\n * The listener of the `Receiver` `'pong'` event.\n *\n * @param {Buffer} data The data included in the pong frame\n * @private\n */\nfunction receiverOnPong(data) {\n  this[kWebSocket].emit('pong', data);\n}\n\n/**\n * The listener of the `net.Socket` `'close'` event.\n *\n * @private\n */\nfunction socketOnClose() {\n  const websocket = this[kWebSocket];\n\n  this.removeListener('close', socketOnClose);\n  this.removeListener('end', socketOnEnd);\n\n  websocket._readyState = WebSocket.CLOSING;\n\n  //\n  // The close frame might not have been received or the `'end'` event emitted,\n  // for example, if the socket was destroyed due to an error. Ensure that the\n  // `receiver` stream is closed after writing any remaining buffered data to\n  // it. If the readable side of the socket is in flowing mode then there is no\n  // buffered data as everything has been already written and `readable.read()`\n  // will return `null`. If instead, the socket is paused, any possible buffered\n  // data will be read as a single chunk and emitted synchronously in a single\n  // `'data'` event.\n  //\n  websocket._socket.read();\n  websocket._receiver.end();\n\n  this.removeListener('data', socketOnData);\n  this[kWebSocket] = undefined;\n\n  clearTimeout(websocket._closeTimer);\n\n  if (\n    websocket._receiver._writableState.finished ||\n    websocket._receiver._writableState.errorEmitted\n  ) {\n    websocket.emitClose();\n  } else {\n    websocket._receiver.on('error', receiverOnFinish);\n    websocket._receiver.on('finish', receiverOnFinish);\n  }\n}\n\n/**\n * The listener of the `net.Socket` `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction socketOnData(chunk) {\n  if (!this[kWebSocket]._receiver.write(chunk)) {\n    this.pause();\n  }\n}\n\n/**\n * The listener of the `net.Socket` `'end'` event.\n *\n * @private\n */\nfunction socketOnEnd() {\n  const websocket = this[kWebSocket];\n\n  websocket._readyState = WebSocket.CLOSING;\n  websocket._receiver.end();\n  this.end();\n}\n\n/**\n * The listener of the `net.Socket` `'error'` event.\n *\n * @private\n */\nfunction socketOnError() {\n  const websocket = this[kWebSocket];\n\n  this.removeListener('error', socketOnError);\n  this.on('error', NOOP);\n\n  if (websocket) {\n    websocket._readyState = WebSocket.CLOSING;\n    this.destroy();\n  }\n}\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./log\"), exports);\n__exportStar(require(\"./utility\"), exports);\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Logger = void 0;\nvar Logger = /** @class */ (function () {\n    function Logger(module, level) {\n        this.module = module;\n        this.level = level;\n    }\n    Logger.prototype.parseLog = function (level, message, context) {\n        var _a;\n        var now = new Date();\n        var month = now.getMonth().toString().padStart(2, \"0\");\n        var day = now.getDay().toString().padStart(2, \"0\");\n        var hour = now.getHours().toString().padStart(2, \"0\");\n        var minute = now.getMinutes().toString().padStart(2, \"0\");\n        var second = now.getSeconds().toString().padStart(2, \"0\");\n        var millisecond = now.getMilliseconds().toString().padEnd(3, \"0\").slice(0, 3);\n        var logTime = month + \"-\" + day + \"|\" + hour + \":\" + minute + \":\" + second + \".\" + millisecond;\n        var colored = function (level, payload) {\n            // TODO coloring in Browser Console\n            return payload;\n        };\n        var contextLiteral = \"\";\n        if (context) {\n            for (var key in context) {\n                if (context.hasOwnProperty(key)) {\n                    // @ts-ignore\n                    contextLiteral += colored(level, key) + \"=\" + ((_a = context[key]) === null || _a === void 0 ? void 0 : _a.toString()) + \" \";\n                }\n            }\n        }\n        return colored(level, Logger.Level.levelString(level).padEnd(5, \" \")) + \"[\" + logTime + \"][\" + this.module + \"] \" + message.toString().padEnd(48, \" \") + \" \" + contextLiteral;\n    };\n    Logger.prototype.log = function (level, message, context) {\n        if (this.level <= level) {\n            switch (this.level) {\n                case Logger.Level.ERROR:\n                    console.error(this.parseLog(level, message, context));\n                    break;\n                case Logger.Level.WARN:\n                    console.warn(this.parseLog(level, message, context));\n                    break;\n                case Logger.Level.INFO:\n                    console.info(this.parseLog(level, message, context));\n                    break;\n                case Logger.Level.DEBUG:\n                    console.debug(this.parseLog(level, message, context));\n                    break;\n                default:\n                    console.log(this.parseLog(level, message, context));\n            }\n        }\n    };\n    Logger.prototype.info = function (message, context) {\n        this.log(Logger.Level.INFO, message, context);\n    };\n    Logger.prototype.warn = function (message, context) {\n        this.log(Logger.Level.WARN, message, context);\n    };\n    Logger.prototype.debug = function (message, context) {\n        this.log(Logger.Level.DEBUG, message, context);\n    };\n    Logger.prototype.error = function (message, context) {\n        this.log(Logger.Level.ERROR, message, context);\n    };\n    Logger.Level = {\n        DEBUG: 1,\n        INFO: 2,\n        WARN: 3,\n        ERROR: 4,\n        levelString: function (lvl) {\n            switch (lvl) {\n                case 1:\n                    return 'DEBUG';\n                case 2:\n                    return 'INFO';\n                case 3:\n                    return 'WARN';\n                case 4:\n                    return 'ERROR';\n                default:\n                    return 'UNKNOWN';\n            }\n        }\n    };\n    return Logger;\n}());\nexports.Logger = Logger;\n//# sourceMappingURL=log.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.prettifyHash = void 0;\nfunction prettifyHash(hash) {\n    var startIndex = 0;\n    if (hash.startsWith(\"0x\")) {\n        startIndex = 2;\n    }\n    return hash.substring(startIndex, startIndex + 6) + \"\\u2026\" + hash.substring(hash.length - 6, hash.length);\n}\nexports.prettifyHash = prettifyHash;\n//# sourceMappingURL=utility.js.map","import {Logger, prettifyHash} from \"@darcher/helpers-browser\";\nimport {Data} from \"./metamask-notifier\";\n\nexport interface SendTransactionTrace {\n    hash: string,\n    stack: string[],\n}\n\nexport interface StackTraceMessage extends Data {\n    type: 'FetchStackTrace',\n    stack: string[],\n}\n\nconst logger = new Logger(\"Trace\", Logger.Level.INFO);\n\nasync function oneTimeWebSocketRequest<T extends Data>(url: string, data: T): Promise<T> {\n    return new Promise<T>((resolve, reject) => {\n        const ws = new WebSocket(url);\n        ws.onopen = () => {\n            // send request\n            ws.send(JSON.stringify(data));\n        };\n        ws.onerror = (ev: ErrorEvent) => {\n            reject(ev);\n        }\n        ws.onmessage = (ev) => {\n            const msg = JSON.parse(ev.data) as T;\n            resolve(msg);\n            ws.close();\n        }\n    });\n}\n\nexport async function getStackTraceByCrawljax(): Promise<string[]> {\n    const resp = await oneTimeWebSocketRequest(\"ws://localhost:1237\", {\n        type: \"FetchStackTrace\",\n        stack: [],\n    } as StackTraceMessage);\n    return resp.stack;\n}\n\nexport interface TraceHistory {\n    method: string,\n    params: any[],\n    stack: string[] | null,\n}\n\ndeclare global {\n    interface Window {\n        traceHistories: TraceHistory[];\n    }\n}\n\nlet isBrowser;\nlet GLOBAL;\nif (typeof window !== 'undefined') {\n    GLOBAL = window;\n    isBrowser = true;\n} else if (typeof global !== \"undefined\") {\n    GLOBAL = global;\n    isBrowser = false;\n} else {\n    throw new Error(\"Failed to load trace-instrument\");\n}\n\nif (typeof GLOBAL !== 'undefined' && !GLOBAL.traceHistories) {\n    GLOBAL.traceHistories = [] as TraceHistory[];\n}\n\n\nexport function traceSendAsync(method: string, params: any[], callback: Function): Function {\n    const traceCache: TraceHistory = {\n        method: method,\n        params: params,\n        stack: null,\n    };\n    if (['eth_sendTransaction', 'eth_sendRawTransaction', 'eth_estimateGas'].includes(method)) {\n        const traceObj = {stack: undefined};\n        Error.captureStackTrace(traceObj, traceSendAsync);\n        callback = new Proxy(callback, {\n            apply(target, thisArg, argArray) {\n                if (method === 'eth_estimateGas') {\n                    // save gas\n                    traceCache.params[0].gas = argArray[1];\n                    // save to history, in case there is a transaction use this call later\n                    traceCache.stack = traceObj.stack.split(/\\n/).map(item => item.trim()).filter(item => item.length > 0 && item !== \"Error\");\n                    GLOBAL.traceHistories.push(traceCache);\n                } else if (['eth_sendTransaction', 'eth_sendRawTransaction'].includes(method)) {\n                    // search trace history for a possible estimateGas cache (which is more precise)\n                    for (let i = GLOBAL.traceHistories.length - 1; i >= 0; i--) {\n                        const history = GLOBAL.traceHistories[i];\n                        if (history.method === 'eth_estimateGas' &&\n                            history.params[0] && params[0] &&\n                            history.params[0].from === params[0].from &&\n                            history.params[0].to === params[0].to &&\n                            history.params[0].data === params[0].data\n                        ) {\n                            // delete this from history\n                            GLOBAL.traceHistories = GLOBAL.traceHistories.filter(value => value !== history);\n                            // use the stack trace of this cache\n                            traceCache.stack = history.stack;\n                            break;\n                        }\n                    }\n                    if (!traceCache.stack) {\n                        // no history found, use current one\n                        traceCache.stack = traceObj.stack.split(/\\n/).map(item => item.trim()).filter(item => item.length > 0 && item !== \"Error\");\n                    }\n                    // send trace to server\n                    const trace = {\n                        hash: argArray[1],\n                        stack: traceCache.stack,\n                    } as SendTransactionTrace;\n                    logger.info(\"Transaction trace\", {hash: prettifyHash(trace.hash), stack: trace.stack})\n                    if (isBrowser) {\n                        const ws = new WebSocket(`ws://localhost:1236`);\n                        ws.onopen = () => {\n                            ws.send(JSON.stringify(trace));\n                        };\n                        ws.onerror = (ev: ErrorEvent) => {\n                            logger.error(\"Send transaction trace error\", {err: ev});\n                        }\n                        ws.onmessage = () => {\n                            ws.close();\n                        }\n                    } else {\n                        const WebSocket = require(\"ws\");\n                        const ws = new WebSocket(\"ws://localhost:1236\");\n                        ws.on('open', () => {\n                            ws.send(JSON.stringify(trace));\n                        });\n                        ws.on(\"error\", e => {\n                            logger.error(\"Send transaction trace error\", {err: e});\n                        });\n                        ws.on(\"message\", () => {\n                            ws.close();\n                        });\n                    }\n\n                }\n                target.apply(thisArg, argArray);\n            },\n        });\n    }\n    return callback;\n}\n\nexport function traceSend(method: string, result: string) {\n    if ((method === 'eth_sendTransaction' || method === 'eth_sendRawTransaction')) {\n        const traceObj = {stack: undefined};\n        Error.captureStackTrace(traceObj, traceSendAsync);\n        const trace = {\n            hash: result,\n            stack: traceObj.stack.split(/\\n/).map(item => item.trim()).filter(item => item.length > 0 && item !== \"Error\"),\n        } as SendTransactionTrace;\n        logger.info(\"Transaction trace\", {hash: prettifyHash(trace.hash), stack: trace.stack});\n        const ws = new WebSocket(`ws://localhost:1236`);\n        ws.onopen = () => {\n            ws.send(JSON.stringify(trace));\n        };\n        ws.onerror = (ev: ErrorEvent) => {\n            logger.error(\"Send transaction trace error\", {err: ev});\n        }\n        ws.onmessage = () => {\n            ws.close();\n        }\n    }\n}\n","module.exports = require(\"crypto\");;","module.exports = require(\"events\");;","module.exports = require(\"fs\");;","module.exports = require(\"http\");;","module.exports = require(\"https\");;","module.exports = require(\"net\");;","module.exports = require(\"os\");;","module.exports = require(\"path\");;","module.exports = require(\"stream\");;","module.exports = require(\"tls\");;","module.exports = require(\"url\");;","module.exports = require(\"zlib\");;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(846);\n"],"sourceRoot":""}