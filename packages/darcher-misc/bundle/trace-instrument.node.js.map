{"version":3,"sources":["webpack://@darcher/misc/../node_modules/bufferutil/fallback.js","webpack://@darcher/misc/../node_modules/bufferutil/index.js","webpack://@darcher/misc/../node_modules/node-gyp-build/index.js","webpack://@darcher/misc/../node_modules/utf-8-validate/fallback.js","webpack://@darcher/misc/../node_modules/utf-8-validate/index.js","webpack://@darcher/misc/../node_modules/ws/index.js","webpack://@darcher/misc/../node_modules/ws/lib/buffer-util.js","webpack://@darcher/misc/../node_modules/ws/lib/constants.js","webpack://@darcher/misc/../node_modules/ws/lib/event-target.js","webpack://@darcher/misc/../node_modules/ws/lib/extension.js","webpack://@darcher/misc/../node_modules/ws/lib/limiter.js","webpack://@darcher/misc/../node_modules/ws/lib/permessage-deflate.js","webpack://@darcher/misc/../node_modules/ws/lib/receiver.js","webpack://@darcher/misc/../node_modules/ws/lib/sender.js","webpack://@darcher/misc/../node_modules/ws/lib/stream.js","webpack://@darcher/misc/../node_modules/ws/lib/validation.js","webpack://@darcher/misc/../node_modules/ws/lib/websocket-server.js","webpack://@darcher/misc/../node_modules/ws/lib/websocket.js","webpack://@darcher/misc/../darcher-helpers-browser/dist/index.js","webpack://@darcher/misc/../darcher-helpers-browser/dist/log.js","webpack://@darcher/misc/../darcher-helpers-browser/dist/utility.js","webpack://@darcher/misc/./src/trace-instrument.ts","webpack://@darcher/misc/external \"crypto\"","webpack://@darcher/misc/external \"events\"","webpack://@darcher/misc/external \"fs\"","webpack://@darcher/misc/external \"http\"","webpack://@darcher/misc/external \"https\"","webpack://@darcher/misc/external \"net\"","webpack://@darcher/misc/external \"os\"","webpack://@darcher/misc/external \"path\"","webpack://@darcher/misc/external \"stream\"","webpack://@darcher/misc/external \"tls\"","webpack://@darcher/misc/external \"url\"","webpack://@darcher/misc/external \"zlib\"","webpack://@darcher/misc/webpack/bootstrap","webpack://@darcher/misc/webpack/startup"],"names":["module","exports","mask","source","output","offset","length","i","unmask","buffer","__dirname","e","fs","path","os","runtimeRequire","vars","process","config","variables","prebuildsOnly","env","PREBUILDS_ONLY","abi","versions","modules","runtime","electron","ELECTRON_RUN_AS_NODE","window","type","arch","platform","libc","LIBC","existsSync","isAlpine","armv","ARM_VERSION","arm_version","uv","split","load","dir","readdirSync","err","getFirst","filter","files","join","matchBuild","name","test","parseTags","file","arr","tags","specificity","pop","tag","napi","slice","matchTags","runtimeAgnostic","compareTags","a","b","resolve","toUpperCase","replace","release","debug","prebuild","nearby","dirname","execPath","target","node","Boolean","Error","prebuilds","winner","map","sort","buf","len","WebSocket","createWebSocketStream","Server","Receiver","Sender","EMPTY_BUFFER","concat","list","totalLength","Buffer","allocUnsafe","set","_mask","_unmask","toArrayBuffer","byteLength","byteOffset","toBuffer","data","readOnly","isBuffer","ArrayBuffer","from","isView","bufferUtil","bu","BufferUtil","BINARY_TYPES","GUID","kStatusCode","Symbol","kWebSocket","alloc","NOOP","Event","this","MessageEvent","super","CloseEvent","code","reason","wasClean","_closeFrameReceived","_closeFrameSent","OpenEvent","ErrorEvent","error","message","EventTarget","listener","options","onMessage","call","onClose","onError","onOpen","method","once","_listener","listeners","removeListener","tokenChars","push","dest","elem","undefined","format","extensions","Object","keys","extension","configurations","Array","isArray","params","k","values","v","parse","header","offers","create","extensionName","paramName","mustUnescape","isEscaping","inQuotes","start","end","charCodeAt","SyntaxError","value","token","kDone","kRun","concurrency","pending","Infinity","jobs","job","shift","zlib","Limiter","TRAILER","kPerMessageDeflate","kTotalLength","kCallback","kBuffers","kError","zlibLimiter","deflateOnData","chunk","inflateOnData","_maxPayload","RangeError","reset","inflateOnError","_inflate","isServer","maxPayload","_options","_threshold","threshold","_isServer","_deflate","concurrencyLimit","serverNoContextTakeover","server_no_context_takeover","clientNoContextTakeover","client_no_context_takeover","serverMaxWindowBits","server_max_window_bits","clientMaxWindowBits","client_max_window_bits","normalizeParams","acceptAsServer","acceptAsClient","close","callback","opts","accepted","find","response","forEach","key","num","Number","isInteger","TypeError","fin","add","done","_decompress","result","_compress","endpoint","windowBits","Z_DEFAULT_WINDOWBITS","createInflateRaw","zlibInflateOptions","on","write","flush","_readableState","endEmitted","createDeflateRaw","zlibDeflateOptions","Z_SYNC_FLUSH","Writable","PerMessageDeflate","isValidStatusCode","isValidUTF8","ErrorCtor","prefix","statusCode","captureStackTrace","binaryType","_binaryType","_extensions","_bufferedBytes","_buffers","_compressed","_payloadLength","_fragmented","_masked","_fin","_opcode","_totalPayloadLength","_messageLength","_fragments","_state","_loop","encoding","cb","startLoop","n","dst","Uint8Array","getInfo","getPayloadLength16","getPayloadLength64","getMask","getData","consume","compressed","haveLength","readUInt16BE","readUInt32BE","Math","pow","controlMessage","decompress","dataMessage","er","messageLength","fragments","emit","toString","randomFillSync","applyMask","socket","_socket","_firstFragment","_deflating","_queue","merge","payloadLength","opcode","rsv1","writeUInt16BE","writeUInt32BE","enqueue","doClose","sendFrame","frame","doPing","doPong","perMessageDeflate","binary","compress","dispatch","_","destroyed","dequeue","Reflect","apply","cork","uncork","Duplex","emitClose","stream","duplexOnEnd","_writableState","finished","destroy","duplexOnError","listenerCount","ws","resumeOnReceiverDrain","receiverOnDrain","resume","readyState","CONNECTING","_receiver","removeAllListeners","duplex","autoDestroy","objectMode","writableObjectMode","msg","pause","_destroy","CLOSED","nextTick","called","terminate","_final","_read","OPEN","needDrain","_write","send","_isValidUTF8","Validation","EventEmitter","createHash","createServer","STATUS_CODES","keyRegex","server","socketOnError","abortHandshake","headers","writable","Connection","h","handleProtocols","clientTracking","verifyClient","noServer","backlog","host","port","_server","req","res","body","writeHead","listen","emitConnection","bind","_removeListeners","event","addListeners","listening","upgrade","head","handleUpgrade","clients","Set","address","client","index","url","indexOf","trim","version","toLowerCase","shouldHandle","accept","info","origin","secure","authorized","encrypted","verified","completeUpgrade","readable","update","digest","protocol","_protocol","setSocket","delete","https","http","net","tls","randomBytes","URL","addEventListener","removeEventListener","readyStates","protocolVersions","protocols","_closeCode","_closeMessage","_closeTimer","_readyState","_sender","_bufferedAmount","_redirects","initAsClient","includes","_url","receiver","receiverOnConclude","receiverOnError","receiverOnMessage","receiverOnPing","receiverOnPong","setTimeout","setNoDelay","unshift","socketOnClose","socketOnData","socketOnEnd","cleanup","_req","CLOSING","ping","sendAfterClose","pong","websocket","protocolVersion","followRedirects","maxRedirects","createConnection","socketPath","hostname","timeout","parsedUrl","href","isUnixSocket","pathname","isSecure","defaultPort","get","tlsConnect","netConnect","startsWith","Upgrade","search","handshakeTimeout","offer","Origin","username","password","auth","parts","aborted","location","abort","addr","serverProt","protList","protError","connect","servername","isIP","setHeader","receiverOnFinish","read","clearTimeout","errorEmitted","descriptor","enumerable","defineProperty","prototype","property","configurable","__createBinding","o","m","k2","__exportStar","p","hasOwnProperty","Logger","level","parseLog","context","_a","now","Date","logTime","getMonth","padStart","getDay","getHours","getMinutes","getSeconds","getMilliseconds","padEnd","colored","payload","contextLiteral","Level","levelString","log","ERROR","console","WARN","warn","INFO","DEBUG","lvl","prettifyHash","hash","startIndex","substring","isBrowser","GLOBAL","logger","oneTimeWebSocketRequest","Promise","reject","onopen","JSON","stringify","onerror","ev","onmessage","stack","global","traceSendAsync","traceCache","Proxy","thisArg","argArray","gas","item","traceHistories","to","traceObj","require","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","__webpack_modules__"],"mappings":"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","file":"trace-instrument.node.js","sourcesContent":["'use strict';\n\n/**\n * Masks a buffer using the given mask.\n *\n * @param {Buffer} source The buffer to mask\n * @param {Buffer} mask The mask to use\n * @param {Buffer} output The buffer where to store the result\n * @param {Number} offset The offset at which to start writing\n * @param {Number} length The number of bytes to mask.\n * @public\n */\nconst mask = (source, mask, output, offset, length) => {\n  for (var i = 0; i < length; i++) {\n    output[offset + i] = source[i] ^ mask[i & 3];\n  }\n};\n\n/**\n * Unmasks a buffer using the given mask.\n *\n * @param {Buffer} buffer The buffer to unmask\n * @param {Buffer} mask The mask to use\n * @public\n */\nconst unmask = (buffer, mask) => {\n  // Required until https://github.com/nodejs/node/issues/9006 is resolved.\n  const length = buffer.length;\n  for (var i = 0; i < length; i++) {\n    buffer[i] ^= mask[i & 3];\n  }\n};\n\nmodule.exports = { mask, unmask };\n","'use strict';\n\ntry {\n  module.exports = require('node-gyp-build')(__dirname);\n} catch (e) {\n  module.exports = require('./fallback');\n}\n","var fs = require('fs')\nvar path = require('path')\nvar os = require('os')\n\n// Workaround to fix webpack's build warnings: 'the request of a dependency is an expression'\nvar runtimeRequire = typeof __webpack_require__ === 'function' ? __non_webpack_require__ : require // eslint-disable-line\n\nvar vars = (process.config && process.config.variables) || {}\nvar prebuildsOnly = !!process.env.PREBUILDS_ONLY\nvar abi = process.versions.modules // TODO: support old node where this is undef\nvar runtime = isElectron() ? 'electron' : 'node'\nvar arch = os.arch()\nvar platform = os.platform()\nvar libc = process.env.LIBC || (isAlpine(platform) ? 'musl' : 'glibc')\nvar armv = process.env.ARM_VERSION || (arch === 'arm64' ? '8' : vars.arm_version) || ''\nvar uv = (process.versions.uv || '').split('.')[0]\n\nmodule.exports = load\n\nfunction load (dir) {\n  return runtimeRequire(load.path(dir))\n}\n\nload.path = function (dir) {\n  dir = path.resolve(dir || '.')\n\n  try {\n    var name = runtimeRequire(path.join(dir, 'package.json')).name.toUpperCase().replace(/-/g, '_')\n    if (process.env[name + '_PREBUILD']) dir = process.env[name + '_PREBUILD']\n  } catch (err) {}\n\n  if (!prebuildsOnly) {\n    var release = getFirst(path.join(dir, 'build/Release'), matchBuild)\n    if (release) return release\n\n    var debug = getFirst(path.join(dir, 'build/Debug'), matchBuild)\n    if (debug) return debug\n  }\n\n  var prebuild = resolve(dir)\n  if (prebuild) return prebuild\n\n  var nearby = resolve(path.dirname(process.execPath))\n  if (nearby) return nearby\n\n  var target = [\n    'platform=' + platform,\n    'arch=' + arch,\n    'runtime=' + runtime,\n    'abi=' + abi,\n    'uv=' + uv,\n    armv ? 'armv=' + armv : '',\n    'libc=' + libc,\n    'node=' + process.versions.node,\n    (process.versions && process.versions.electron) ? 'electron=' + process.versions.electron : '',\n    typeof __webpack_require__ === 'function' ? 'webpack=true' : '' // eslint-disable-line\n  ].filter(Boolean).join(' ')\n\n  throw new Error('No native build was found for ' + target + '\\n    loaded from: ' + dir + '\\n')\n\n  function resolve (dir) {\n    // Find most specific flavor first\n    var prebuilds = path.join(dir, 'prebuilds', platform + '-' + arch)\n    var parsed = readdirSync(prebuilds).map(parseTags)\n    var candidates = parsed.filter(matchTags(runtime, abi))\n    var winner = candidates.sort(compareTags(runtime))[0]\n    if (winner) return path.join(prebuilds, winner.file)\n  }\n}\n\nfunction readdirSync (dir) {\n  try {\n    return fs.readdirSync(dir)\n  } catch (err) {\n    return []\n  }\n}\n\nfunction getFirst (dir, filter) {\n  var files = readdirSync(dir).filter(filter)\n  return files[0] && path.join(dir, files[0])\n}\n\nfunction matchBuild (name) {\n  return /\\.node$/.test(name)\n}\n\nfunction parseTags (file) {\n  var arr = file.split('.')\n  var extension = arr.pop()\n  var tags = { file: file, specificity: 0 }\n\n  if (extension !== 'node') return\n\n  for (var i = 0; i < arr.length; i++) {\n    var tag = arr[i]\n\n    if (tag === 'node' || tag === 'electron' || tag === 'node-webkit') {\n      tags.runtime = tag\n    } else if (tag === 'napi') {\n      tags.napi = true\n    } else if (tag.slice(0, 3) === 'abi') {\n      tags.abi = tag.slice(3)\n    } else if (tag.slice(0, 2) === 'uv') {\n      tags.uv = tag.slice(2)\n    } else if (tag.slice(0, 4) === 'armv') {\n      tags.armv = tag.slice(4)\n    } else if (tag === 'glibc' || tag === 'musl') {\n      tags.libc = tag\n    } else {\n      continue\n    }\n\n    tags.specificity++\n  }\n\n  return tags\n}\n\nfunction matchTags (runtime, abi) {\n  return function (tags) {\n    if (tags == null) return false\n    if (tags.runtime !== runtime && !runtimeAgnostic(tags)) return false\n    if (tags.abi !== abi && !tags.napi) return false\n    if (tags.uv && tags.uv !== uv) return false\n    if (tags.armv && tags.armv !== armv) return false\n    if (tags.libc && tags.libc !== libc) return false\n\n    return true\n  }\n}\n\nfunction runtimeAgnostic (tags) {\n  return tags.runtime === 'node' && tags.napi\n}\n\nfunction compareTags (runtime) {\n  // Precedence: non-agnostic runtime, abi over napi, then by specificity.\n  return function (a, b) {\n    if (a.runtime !== b.runtime) {\n      return a.runtime === runtime ? -1 : 1\n    } else if (a.abi !== b.abi) {\n      return a.abi ? -1 : 1\n    } else if (a.specificity !== b.specificity) {\n      return a.specificity > b.specificity ? -1 : 1\n    } else {\n      return 0\n    }\n  }\n}\n\nfunction isElectron () {\n  if (process.versions && process.versions.electron) return true\n  if (process.env.ELECTRON_RUN_AS_NODE) return true\n  return typeof window !== 'undefined' && window.process && window.process.type === 'renderer'\n}\n\nfunction isAlpine (platform) {\n  return platform === 'linux' && fs.existsSync('/etc/alpine-release')\n}\n\n// Exposed for unit tests\n// TODO: move to lib\nload.parseTags = parseTags\nload.matchTags = matchTags\nload.compareTags = compareTags\n","'use strict';\n\n/**\n * Checks if a given buffer contains only correct UTF-8.\n * Ported from https://www.cl.cam.ac.uk/%7Emgk25/ucs/utf8_check.c by\n * Markus Kuhn.\n *\n * @param {Buffer} buf The buffer to check\n * @return {Boolean} `true` if `buf` contains only correct UTF-8, else `false`\n * @public\n */\nfunction isValidUTF8(buf) {\n  const len = buf.length;\n  let i = 0;\n\n  while (i < len) {\n    if ((buf[i] & 0x80) === 0x00) {  // 0xxxxxxx\n      i++;\n    } else if ((buf[i] & 0xe0) === 0xc0) {  // 110xxxxx 10xxxxxx\n      if (\n        i + 1 === len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i] & 0xfe) === 0xc0  // overlong\n      ) {\n        return false;\n      }\n\n      i += 2;\n    } else if ((buf[i] & 0xf0) === 0xe0) {  // 1110xxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 2 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        buf[i] === 0xe0 && (buf[i + 1] & 0xe0) === 0x80 ||  // overlong\n        buf[i] === 0xed && (buf[i + 1] & 0xe0) === 0xa0  // surrogate (U+D800 - U+DFFF)\n      ) {\n        return false;\n      }\n\n      i += 3;\n    } else if ((buf[i] & 0xf8) === 0xf0) {  // 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 3 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        (buf[i + 3] & 0xc0) !== 0x80 ||\n        buf[i] === 0xf0 && (buf[i + 1] & 0xf0) === 0x80 ||  // overlong\n        buf[i] === 0xf4 && buf[i + 1] > 0x8f || buf[i] > 0xf4  // > U+10FFFF\n      ) {\n        return false;\n      }\n\n      i += 4;\n    } else {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nmodule.exports = isValidUTF8;\n","'use strict';\n\ntry {\n  module.exports = require('node-gyp-build')(__dirname);\n} catch (e) {\n  module.exports = require('./fallback');\n}\n","'use strict';\n\nconst WebSocket = require('./lib/websocket');\n\nWebSocket.createWebSocketStream = require('./lib/stream');\nWebSocket.Server = require('./lib/websocket-server');\nWebSocket.Receiver = require('./lib/receiver');\nWebSocket.Sender = require('./lib/sender');\n\nmodule.exports = WebSocket;\n","'use strict';\n\nconst { EMPTY_BUFFER } = require('./constants');\n\n/**\n * Merges an array of buffers into a new buffer.\n *\n * @param {Buffer[]} list The array of buffers to concat\n * @param {Number} totalLength The total length of buffers in the list\n * @return {Buffer} The resulting buffer\n * @public\n */\nfunction concat(list, totalLength) {\n  if (list.length === 0) return EMPTY_BUFFER;\n  if (list.length === 1) return list[0];\n\n  const target = Buffer.allocUnsafe(totalLength);\n  let offset = 0;\n\n  for (let i = 0; i < list.length; i++) {\n    const buf = list[i];\n    target.set(buf, offset);\n    offset += buf.length;\n  }\n\n  if (offset < totalLength) return target.slice(0, offset);\n\n  return target;\n}\n\n/**\n * Masks a buffer using the given mask.\n *\n * @param {Buffer} source The buffer to mask\n * @param {Buffer} mask The mask to use\n * @param {Buffer} output The buffer where to store the result\n * @param {Number} offset The offset at which to start writing\n * @param {Number} length The number of bytes to mask.\n * @public\n */\nfunction _mask(source, mask, output, offset, length) {\n  for (let i = 0; i < length; i++) {\n    output[offset + i] = source[i] ^ mask[i & 3];\n  }\n}\n\n/**\n * Unmasks a buffer using the given mask.\n *\n * @param {Buffer} buffer The buffer to unmask\n * @param {Buffer} mask The mask to use\n * @public\n */\nfunction _unmask(buffer, mask) {\n  // Required until https://github.com/nodejs/node/issues/9006 is resolved.\n  const length = buffer.length;\n  for (let i = 0; i < length; i++) {\n    buffer[i] ^= mask[i & 3];\n  }\n}\n\n/**\n * Converts a buffer to an `ArrayBuffer`.\n *\n * @param {Buffer} buf The buffer to convert\n * @return {ArrayBuffer} Converted buffer\n * @public\n */\nfunction toArrayBuffer(buf) {\n  if (buf.byteLength === buf.buffer.byteLength) {\n    return buf.buffer;\n  }\n\n  return buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.byteLength);\n}\n\n/**\n * Converts `data` to a `Buffer`.\n *\n * @param {*} data The data to convert\n * @return {Buffer} The buffer\n * @throws {TypeError}\n * @public\n */\nfunction toBuffer(data) {\n  toBuffer.readOnly = true;\n\n  if (Buffer.isBuffer(data)) return data;\n\n  let buf;\n\n  if (data instanceof ArrayBuffer) {\n    buf = Buffer.from(data);\n  } else if (ArrayBuffer.isView(data)) {\n    buf = Buffer.from(data.buffer, data.byteOffset, data.byteLength);\n  } else {\n    buf = Buffer.from(data);\n    toBuffer.readOnly = false;\n  }\n\n  return buf;\n}\n\ntry {\n  const bufferUtil = require('bufferutil');\n  const bu = bufferUtil.BufferUtil || bufferUtil;\n\n  module.exports = {\n    concat,\n    mask(source, mask, output, offset, length) {\n      if (length < 48) _mask(source, mask, output, offset, length);\n      else bu.mask(source, mask, output, offset, length);\n    },\n    toArrayBuffer,\n    toBuffer,\n    unmask(buffer, mask) {\n      if (buffer.length < 32) _unmask(buffer, mask);\n      else bu.unmask(buffer, mask);\n    }\n  };\n} catch (e) /* istanbul ignore next */ {\n  module.exports = {\n    concat,\n    mask: _mask,\n    toArrayBuffer,\n    toBuffer,\n    unmask: _unmask\n  };\n}\n","'use strict';\n\nmodule.exports = {\n  BINARY_TYPES: ['nodebuffer', 'arraybuffer', 'fragments'],\n  GUID: '258EAFA5-E914-47DA-95CA-C5AB0DC85B11',\n  kStatusCode: Symbol('status-code'),\n  kWebSocket: Symbol('websocket'),\n  EMPTY_BUFFER: Buffer.alloc(0),\n  NOOP: () => {}\n};\n","'use strict';\n\n/**\n * Class representing an event.\n *\n * @private\n */\nclass Event {\n  /**\n   * Create a new `Event`.\n   *\n   * @param {String} type The name of the event\n   * @param {Object} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(type, target) {\n    this.target = target;\n    this.type = type;\n  }\n}\n\n/**\n * Class representing a message event.\n *\n * @extends Event\n * @private\n */\nclass MessageEvent extends Event {\n  /**\n   * Create a new `MessageEvent`.\n   *\n   * @param {(String|Buffer|ArrayBuffer|Buffer[])} data The received data\n   * @param {WebSocket} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(data, target) {\n    super('message', target);\n\n    this.data = data;\n  }\n}\n\n/**\n * Class representing a close event.\n *\n * @extends Event\n * @private\n */\nclass CloseEvent extends Event {\n  /**\n   * Create a new `CloseEvent`.\n   *\n   * @param {Number} code The status code explaining why the connection is being\n   *     closed\n   * @param {String} reason A human-readable string explaining why the\n   *     connection is closing\n   * @param {WebSocket} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(code, reason, target) {\n    super('close', target);\n\n    this.wasClean = target._closeFrameReceived && target._closeFrameSent;\n    this.reason = reason;\n    this.code = code;\n  }\n}\n\n/**\n * Class representing an open event.\n *\n * @extends Event\n * @private\n */\nclass OpenEvent extends Event {\n  /**\n   * Create a new `OpenEvent`.\n   *\n   * @param {WebSocket} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(target) {\n    super('open', target);\n  }\n}\n\n/**\n * Class representing an error event.\n *\n * @extends Event\n * @private\n */\nclass ErrorEvent extends Event {\n  /**\n   * Create a new `ErrorEvent`.\n   *\n   * @param {Object} error The error that generated this event\n   * @param {WebSocket} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(error, target) {\n    super('error', target);\n\n    this.message = error.message;\n    this.error = error;\n  }\n}\n\n/**\n * This provides methods for emulating the `EventTarget` interface. It's not\n * meant to be used directly.\n *\n * @mixin\n */\nconst EventTarget = {\n  /**\n   * Register an event listener.\n   *\n   * @param {String} type A string representing the event type to listen for\n   * @param {Function} listener The listener to add\n   * @param {Object} [options] An options object specifies characteristics about\n   *     the event listener\n   * @param {Boolean} [options.once=false] A `Boolean`` indicating that the\n   *     listener should be invoked at most once after being added. If `true`,\n   *     the listener would be automatically removed when invoked.\n   * @public\n   */\n  addEventListener(type, listener, options) {\n    if (typeof listener !== 'function') return;\n\n    function onMessage(data) {\n      listener.call(this, new MessageEvent(data, this));\n    }\n\n    function onClose(code, message) {\n      listener.call(this, new CloseEvent(code, message, this));\n    }\n\n    function onError(error) {\n      listener.call(this, new ErrorEvent(error, this));\n    }\n\n    function onOpen() {\n      listener.call(this, new OpenEvent(this));\n    }\n\n    const method = options && options.once ? 'once' : 'on';\n\n    if (type === 'message') {\n      onMessage._listener = listener;\n      this[method](type, onMessage);\n    } else if (type === 'close') {\n      onClose._listener = listener;\n      this[method](type, onClose);\n    } else if (type === 'error') {\n      onError._listener = listener;\n      this[method](type, onError);\n    } else if (type === 'open') {\n      onOpen._listener = listener;\n      this[method](type, onOpen);\n    } else {\n      this[method](type, listener);\n    }\n  },\n\n  /**\n   * Remove an event listener.\n   *\n   * @param {String} type A string representing the event type to remove\n   * @param {Function} listener The listener to remove\n   * @public\n   */\n  removeEventListener(type, listener) {\n    const listeners = this.listeners(type);\n\n    for (let i = 0; i < listeners.length; i++) {\n      if (listeners[i] === listener || listeners[i]._listener === listener) {\n        this.removeListener(type, listeners[i]);\n      }\n    }\n  }\n};\n\nmodule.exports = EventTarget;\n","'use strict';\n\n//\n// Allowed token characters:\n//\n// '!', '#', '$', '%', '&', ''', '*', '+', '-',\n// '.', 0-9, A-Z, '^', '_', '`', a-z, '|', '~'\n//\n// tokenChars[32] === 0 // ' '\n// tokenChars[33] === 1 // '!'\n// tokenChars[34] === 0 // '\"'\n// ...\n//\n// prettier-ignore\nconst tokenChars = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 0 - 15\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 16 - 31\n  0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, // 32 - 47\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, // 48 - 63\n  0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 64 - 79\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, // 80 - 95\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 96 - 111\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0 // 112 - 127\n];\n\n/**\n * Adds an offer to the map of extension offers or a parameter to the map of\n * parameters.\n *\n * @param {Object} dest The map of extension offers or parameters\n * @param {String} name The extension or parameter name\n * @param {(Object|Boolean|String)} elem The extension parameters or the\n *     parameter value\n * @private\n */\nfunction push(dest, name, elem) {\n  if (dest[name] === undefined) dest[name] = [elem];\n  else dest[name].push(elem);\n}\n\n/**\n * Parses the `Sec-WebSocket-Extensions` header into an object.\n *\n * @param {String} header The field value of the header\n * @return {Object} The parsed object\n * @public\n */\nfunction parse(header) {\n  const offers = Object.create(null);\n\n  if (header === undefined || header === '') return offers;\n\n  let params = Object.create(null);\n  let mustUnescape = false;\n  let isEscaping = false;\n  let inQuotes = false;\n  let extensionName;\n  let paramName;\n  let start = -1;\n  let end = -1;\n  let i = 0;\n\n  for (; i < header.length; i++) {\n    const code = header.charCodeAt(i);\n\n    if (extensionName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20 /* ' ' */ || code === 0x09 /* '\\t' */) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b /* ';' */ || code === 0x2c /* ',' */) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        const name = header.slice(start, end);\n        if (code === 0x2c) {\n          push(offers, name, params);\n          params = Object.create(null);\n        } else {\n          extensionName = name;\n        }\n\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else if (paramName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20 || code === 0x09) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        push(params, header.slice(start, end), true);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = Object.create(null);\n          extensionName = undefined;\n        }\n\n        start = end = -1;\n      } else if (code === 0x3d /* '=' */ && start !== -1 && end === -1) {\n        paramName = header.slice(start, i);\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else {\n      //\n      // The value of a quoted-string after unescaping must conform to the\n      // token ABNF, so only token characters are valid.\n      // Ref: https://tools.ietf.org/html/rfc6455#section-9.1\n      //\n      if (isEscaping) {\n        if (tokenChars[code] !== 1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n        if (start === -1) start = i;\n        else if (!mustUnescape) mustUnescape = true;\n        isEscaping = false;\n      } else if (inQuotes) {\n        if (tokenChars[code] === 1) {\n          if (start === -1) start = i;\n        } else if (code === 0x22 /* '\"' */ && start !== -1) {\n          inQuotes = false;\n          end = i;\n        } else if (code === 0x5c /* '\\' */) {\n          isEscaping = true;\n        } else {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n      } else if (code === 0x22 && header.charCodeAt(i - 1) === 0x3d) {\n        inQuotes = true;\n      } else if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (start !== -1 && (code === 0x20 || code === 0x09)) {\n        if (end === -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        let value = header.slice(start, end);\n        if (mustUnescape) {\n          value = value.replace(/\\\\/g, '');\n          mustUnescape = false;\n        }\n        push(params, paramName, value);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = Object.create(null);\n          extensionName = undefined;\n        }\n\n        paramName = undefined;\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    }\n  }\n\n  if (start === -1 || inQuotes) {\n    throw new SyntaxError('Unexpected end of input');\n  }\n\n  if (end === -1) end = i;\n  const token = header.slice(start, end);\n  if (extensionName === undefined) {\n    push(offers, token, params);\n  } else {\n    if (paramName === undefined) {\n      push(params, token, true);\n    } else if (mustUnescape) {\n      push(params, paramName, token.replace(/\\\\/g, ''));\n    } else {\n      push(params, paramName, token);\n    }\n    push(offers, extensionName, params);\n  }\n\n  return offers;\n}\n\n/**\n * Builds the `Sec-WebSocket-Extensions` header field value.\n *\n * @param {Object} extensions The map of extensions and parameters to format\n * @return {String} A string representing the given object\n * @public\n */\nfunction format(extensions) {\n  return Object.keys(extensions)\n    .map((extension) => {\n      let configurations = extensions[extension];\n      if (!Array.isArray(configurations)) configurations = [configurations];\n      return configurations\n        .map((params) => {\n          return [extension]\n            .concat(\n              Object.keys(params).map((k) => {\n                let values = params[k];\n                if (!Array.isArray(values)) values = [values];\n                return values\n                  .map((v) => (v === true ? k : `${k}=${v}`))\n                  .join('; ');\n              })\n            )\n            .join('; ');\n        })\n        .join(', ');\n    })\n    .join(', ');\n}\n\nmodule.exports = { format, parse };\n","'use strict';\n\nconst kDone = Symbol('kDone');\nconst kRun = Symbol('kRun');\n\n/**\n * A very simple job queue with adjustable concurrency. Adapted from\n * https://github.com/STRML/async-limiter\n */\nclass Limiter {\n  /**\n   * Creates a new `Limiter`.\n   *\n   * @param {Number} [concurrency=Infinity] The maximum number of jobs allowed\n   *     to run concurrently\n   */\n  constructor(concurrency) {\n    this[kDone] = () => {\n      this.pending--;\n      this[kRun]();\n    };\n    this.concurrency = concurrency || Infinity;\n    this.jobs = [];\n    this.pending = 0;\n  }\n\n  /**\n   * Adds a job to the queue.\n   *\n   * @param {Function} job The job to run\n   * @public\n   */\n  add(job) {\n    this.jobs.push(job);\n    this[kRun]();\n  }\n\n  /**\n   * Removes a job from the queue and runs it if possible.\n   *\n   * @private\n   */\n  [kRun]() {\n    if (this.pending === this.concurrency) return;\n\n    if (this.jobs.length) {\n      const job = this.jobs.shift();\n\n      this.pending++;\n      job(this[kDone]);\n    }\n  }\n}\n\nmodule.exports = Limiter;\n","'use strict';\n\nconst zlib = require('zlib');\n\nconst bufferUtil = require('./buffer-util');\nconst Limiter = require('./limiter');\nconst { kStatusCode, NOOP } = require('./constants');\n\nconst TRAILER = Buffer.from([0x00, 0x00, 0xff, 0xff]);\nconst kPerMessageDeflate = Symbol('permessage-deflate');\nconst kTotalLength = Symbol('total-length');\nconst kCallback = Symbol('callback');\nconst kBuffers = Symbol('buffers');\nconst kError = Symbol('error');\n\n//\n// We limit zlib concurrency, which prevents severe memory fragmentation\n// as documented in https://github.com/nodejs/node/issues/8871#issuecomment-250915913\n// and https://github.com/websockets/ws/issues/1202\n//\n// Intentionally global; it's the global thread pool that's an issue.\n//\nlet zlibLimiter;\n\n/**\n * permessage-deflate implementation.\n */\nclass PerMessageDeflate {\n  /**\n   * Creates a PerMessageDeflate instance.\n   *\n   * @param {Object} [options] Configuration options\n   * @param {Boolean} [options.serverNoContextTakeover=false] Request/accept\n   *     disabling of server context takeover\n   * @param {Boolean} [options.clientNoContextTakeover=false] Advertise/\n   *     acknowledge disabling of client context takeover\n   * @param {(Boolean|Number)} [options.serverMaxWindowBits] Request/confirm the\n   *     use of a custom server window size\n   * @param {(Boolean|Number)} [options.clientMaxWindowBits] Advertise support\n   *     for, or request, a custom client window size\n   * @param {Object} [options.zlibDeflateOptions] Options to pass to zlib on\n   *     deflate\n   * @param {Object} [options.zlibInflateOptions] Options to pass to zlib on\n   *     inflate\n   * @param {Number} [options.threshold=1024] Size (in bytes) below which\n   *     messages should not be compressed\n   * @param {Number} [options.concurrencyLimit=10] The number of concurrent\n   *     calls to zlib\n   * @param {Boolean} [isServer=false] Create the instance in either server or\n   *     client mode\n   * @param {Number} [maxPayload=0] The maximum allowed message length\n   */\n  constructor(options, isServer, maxPayload) {\n    this._maxPayload = maxPayload | 0;\n    this._options = options || {};\n    this._threshold =\n      this._options.threshold !== undefined ? this._options.threshold : 1024;\n    this._isServer = !!isServer;\n    this._deflate = null;\n    this._inflate = null;\n\n    this.params = null;\n\n    if (!zlibLimiter) {\n      const concurrency =\n        this._options.concurrencyLimit !== undefined\n          ? this._options.concurrencyLimit\n          : 10;\n      zlibLimiter = new Limiter(concurrency);\n    }\n  }\n\n  /**\n   * @type {String}\n   */\n  static get extensionName() {\n    return 'permessage-deflate';\n  }\n\n  /**\n   * Create an extension negotiation offer.\n   *\n   * @return {Object} Extension parameters\n   * @public\n   */\n  offer() {\n    const params = {};\n\n    if (this._options.serverNoContextTakeover) {\n      params.server_no_context_takeover = true;\n    }\n    if (this._options.clientNoContextTakeover) {\n      params.client_no_context_takeover = true;\n    }\n    if (this._options.serverMaxWindowBits) {\n      params.server_max_window_bits = this._options.serverMaxWindowBits;\n    }\n    if (this._options.clientMaxWindowBits) {\n      params.client_max_window_bits = this._options.clientMaxWindowBits;\n    } else if (this._options.clientMaxWindowBits == null) {\n      params.client_max_window_bits = true;\n    }\n\n    return params;\n  }\n\n  /**\n   * Accept an extension negotiation offer/response.\n   *\n   * @param {Array} configurations The extension negotiation offers/reponse\n   * @return {Object} Accepted configuration\n   * @public\n   */\n  accept(configurations) {\n    configurations = this.normalizeParams(configurations);\n\n    this.params = this._isServer\n      ? this.acceptAsServer(configurations)\n      : this.acceptAsClient(configurations);\n\n    return this.params;\n  }\n\n  /**\n   * Releases all resources used by the extension.\n   *\n   * @public\n   */\n  cleanup() {\n    if (this._inflate) {\n      this._inflate.close();\n      this._inflate = null;\n    }\n\n    if (this._deflate) {\n      const callback = this._deflate[kCallback];\n\n      this._deflate.close();\n      this._deflate = null;\n\n      if (callback) {\n        callback(\n          new Error(\n            'The deflate stream was closed while data was being processed'\n          )\n        );\n      }\n    }\n  }\n\n  /**\n   *  Accept an extension negotiation offer.\n   *\n   * @param {Array} offers The extension negotiation offers\n   * @return {Object} Accepted configuration\n   * @private\n   */\n  acceptAsServer(offers) {\n    const opts = this._options;\n    const accepted = offers.find((params) => {\n      if (\n        (opts.serverNoContextTakeover === false &&\n          params.server_no_context_takeover) ||\n        (params.server_max_window_bits &&\n          (opts.serverMaxWindowBits === false ||\n            (typeof opts.serverMaxWindowBits === 'number' &&\n              opts.serverMaxWindowBits > params.server_max_window_bits))) ||\n        (typeof opts.clientMaxWindowBits === 'number' &&\n          !params.client_max_window_bits)\n      ) {\n        return false;\n      }\n\n      return true;\n    });\n\n    if (!accepted) {\n      throw new Error('None of the extension offers can be accepted');\n    }\n\n    if (opts.serverNoContextTakeover) {\n      accepted.server_no_context_takeover = true;\n    }\n    if (opts.clientNoContextTakeover) {\n      accepted.client_no_context_takeover = true;\n    }\n    if (typeof opts.serverMaxWindowBits === 'number') {\n      accepted.server_max_window_bits = opts.serverMaxWindowBits;\n    }\n    if (typeof opts.clientMaxWindowBits === 'number') {\n      accepted.client_max_window_bits = opts.clientMaxWindowBits;\n    } else if (\n      accepted.client_max_window_bits === true ||\n      opts.clientMaxWindowBits === false\n    ) {\n      delete accepted.client_max_window_bits;\n    }\n\n    return accepted;\n  }\n\n  /**\n   * Accept the extension negotiation response.\n   *\n   * @param {Array} response The extension negotiation response\n   * @return {Object} Accepted configuration\n   * @private\n   */\n  acceptAsClient(response) {\n    const params = response[0];\n\n    if (\n      this._options.clientNoContextTakeover === false &&\n      params.client_no_context_takeover\n    ) {\n      throw new Error('Unexpected parameter \"client_no_context_takeover\"');\n    }\n\n    if (!params.client_max_window_bits) {\n      if (typeof this._options.clientMaxWindowBits === 'number') {\n        params.client_max_window_bits = this._options.clientMaxWindowBits;\n      }\n    } else if (\n      this._options.clientMaxWindowBits === false ||\n      (typeof this._options.clientMaxWindowBits === 'number' &&\n        params.client_max_window_bits > this._options.clientMaxWindowBits)\n    ) {\n      throw new Error(\n        'Unexpected or invalid parameter \"client_max_window_bits\"'\n      );\n    }\n\n    return params;\n  }\n\n  /**\n   * Normalize parameters.\n   *\n   * @param {Array} configurations The extension negotiation offers/reponse\n   * @return {Array} The offers/response with normalized parameters\n   * @private\n   */\n  normalizeParams(configurations) {\n    configurations.forEach((params) => {\n      Object.keys(params).forEach((key) => {\n        let value = params[key];\n\n        if (value.length > 1) {\n          throw new Error(`Parameter \"${key}\" must have only a single value`);\n        }\n\n        value = value[0];\n\n        if (key === 'client_max_window_bits') {\n          if (value !== true) {\n            const num = +value;\n            if (!Number.isInteger(num) || num < 8 || num > 15) {\n              throw new TypeError(\n                `Invalid value for parameter \"${key}\": ${value}`\n              );\n            }\n            value = num;\n          } else if (!this._isServer) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n        } else if (key === 'server_max_window_bits') {\n          const num = +value;\n          if (!Number.isInteger(num) || num < 8 || num > 15) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n          value = num;\n        } else if (\n          key === 'client_no_context_takeover' ||\n          key === 'server_no_context_takeover'\n        ) {\n          if (value !== true) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n        } else {\n          throw new Error(`Unknown parameter \"${key}\"`);\n        }\n\n        params[key] = value;\n      });\n    });\n\n    return configurations;\n  }\n\n  /**\n   * Decompress data. Concurrency limited.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @public\n   */\n  decompress(data, fin, callback) {\n    zlibLimiter.add((done) => {\n      this._decompress(data, fin, (err, result) => {\n        done();\n        callback(err, result);\n      });\n    });\n  }\n\n  /**\n   * Compress data. Concurrency limited.\n   *\n   * @param {Buffer} data Data to compress\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @public\n   */\n  compress(data, fin, callback) {\n    zlibLimiter.add((done) => {\n      this._compress(data, fin, (err, result) => {\n        done();\n        callback(err, result);\n      });\n    });\n  }\n\n  /**\n   * Decompress data.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @private\n   */\n  _decompress(data, fin, callback) {\n    const endpoint = this._isServer ? 'client' : 'server';\n\n    if (!this._inflate) {\n      const key = `${endpoint}_max_window_bits`;\n      const windowBits =\n        typeof this.params[key] !== 'number'\n          ? zlib.Z_DEFAULT_WINDOWBITS\n          : this.params[key];\n\n      this._inflate = zlib.createInflateRaw({\n        ...this._options.zlibInflateOptions,\n        windowBits\n      });\n      this._inflate[kPerMessageDeflate] = this;\n      this._inflate[kTotalLength] = 0;\n      this._inflate[kBuffers] = [];\n      this._inflate.on('error', inflateOnError);\n      this._inflate.on('data', inflateOnData);\n    }\n\n    this._inflate[kCallback] = callback;\n\n    this._inflate.write(data);\n    if (fin) this._inflate.write(TRAILER);\n\n    this._inflate.flush(() => {\n      const err = this._inflate[kError];\n\n      if (err) {\n        this._inflate.close();\n        this._inflate = null;\n        callback(err);\n        return;\n      }\n\n      const data = bufferUtil.concat(\n        this._inflate[kBuffers],\n        this._inflate[kTotalLength]\n      );\n\n      if (this._inflate._readableState.endEmitted) {\n        this._inflate.close();\n        this._inflate = null;\n      } else {\n        this._inflate[kTotalLength] = 0;\n        this._inflate[kBuffers] = [];\n\n        if (fin && this.params[`${endpoint}_no_context_takeover`]) {\n          this._inflate.reset();\n        }\n      }\n\n      callback(null, data);\n    });\n  }\n\n  /**\n   * Compress data.\n   *\n   * @param {Buffer} data Data to compress\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @private\n   */\n  _compress(data, fin, callback) {\n    const endpoint = this._isServer ? 'server' : 'client';\n\n    if (!this._deflate) {\n      const key = `${endpoint}_max_window_bits`;\n      const windowBits =\n        typeof this.params[key] !== 'number'\n          ? zlib.Z_DEFAULT_WINDOWBITS\n          : this.params[key];\n\n      this._deflate = zlib.createDeflateRaw({\n        ...this._options.zlibDeflateOptions,\n        windowBits\n      });\n\n      this._deflate[kTotalLength] = 0;\n      this._deflate[kBuffers] = [];\n\n      //\n      // An `'error'` event is emitted, only on Node.js < 10.0.0, if the\n      // `zlib.DeflateRaw` instance is closed while data is being processed.\n      // This can happen if `PerMessageDeflate#cleanup()` is called at the wrong\n      // time due to an abnormal WebSocket closure.\n      //\n      this._deflate.on('error', NOOP);\n      this._deflate.on('data', deflateOnData);\n    }\n\n    this._deflate[kCallback] = callback;\n\n    this._deflate.write(data);\n    this._deflate.flush(zlib.Z_SYNC_FLUSH, () => {\n      if (!this._deflate) {\n        //\n        // The deflate stream was closed while data was being processed.\n        //\n        return;\n      }\n\n      let data = bufferUtil.concat(\n        this._deflate[kBuffers],\n        this._deflate[kTotalLength]\n      );\n\n      if (fin) data = data.slice(0, data.length - 4);\n\n      //\n      // Ensure that the callback will not be called again in\n      // `PerMessageDeflate#cleanup()`.\n      //\n      this._deflate[kCallback] = null;\n\n      this._deflate[kTotalLength] = 0;\n      this._deflate[kBuffers] = [];\n\n      if (fin && this.params[`${endpoint}_no_context_takeover`]) {\n        this._deflate.reset();\n      }\n\n      callback(null, data);\n    });\n  }\n}\n\nmodule.exports = PerMessageDeflate;\n\n/**\n * The listener of the `zlib.DeflateRaw` stream `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction deflateOnData(chunk) {\n  this[kBuffers].push(chunk);\n  this[kTotalLength] += chunk.length;\n}\n\n/**\n * The listener of the `zlib.InflateRaw` stream `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction inflateOnData(chunk) {\n  this[kTotalLength] += chunk.length;\n\n  if (\n    this[kPerMessageDeflate]._maxPayload < 1 ||\n    this[kTotalLength] <= this[kPerMessageDeflate]._maxPayload\n  ) {\n    this[kBuffers].push(chunk);\n    return;\n  }\n\n  this[kError] = new RangeError('Max payload size exceeded');\n  this[kError][kStatusCode] = 1009;\n  this.removeListener('data', inflateOnData);\n  this.reset();\n}\n\n/**\n * The listener of the `zlib.InflateRaw` stream `'error'` event.\n *\n * @param {Error} err The emitted error\n * @private\n */\nfunction inflateOnError(err) {\n  //\n  // There is no need to call `Zlib#close()` as the handle is automatically\n  // closed when an error is emitted.\n  //\n  this[kPerMessageDeflate]._inflate = null;\n  err[kStatusCode] = 1007;\n  this[kCallback](err);\n}\n","'use strict';\n\nconst { Writable } = require('stream');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst {\n  BINARY_TYPES,\n  EMPTY_BUFFER,\n  kStatusCode,\n  kWebSocket\n} = require('./constants');\nconst { concat, toArrayBuffer, unmask } = require('./buffer-util');\nconst { isValidStatusCode, isValidUTF8 } = require('./validation');\n\nconst GET_INFO = 0;\nconst GET_PAYLOAD_LENGTH_16 = 1;\nconst GET_PAYLOAD_LENGTH_64 = 2;\nconst GET_MASK = 3;\nconst GET_DATA = 4;\nconst INFLATING = 5;\n\n/**\n * HyBi Receiver implementation.\n *\n * @extends stream.Writable\n */\nclass Receiver extends Writable {\n  /**\n   * Creates a Receiver instance.\n   *\n   * @param {String} [binaryType=nodebuffer] The type for binary data\n   * @param {Object} [extensions] An object containing the negotiated extensions\n   * @param {Boolean} [isServer=false] Specifies whether to operate in client or\n   *     server mode\n   * @param {Number} [maxPayload=0] The maximum allowed message length\n   */\n  constructor(binaryType, extensions, isServer, maxPayload) {\n    super();\n\n    this._binaryType = binaryType || BINARY_TYPES[0];\n    this[kWebSocket] = undefined;\n    this._extensions = extensions || {};\n    this._isServer = !!isServer;\n    this._maxPayload = maxPayload | 0;\n\n    this._bufferedBytes = 0;\n    this._buffers = [];\n\n    this._compressed = false;\n    this._payloadLength = 0;\n    this._mask = undefined;\n    this._fragmented = 0;\n    this._masked = false;\n    this._fin = false;\n    this._opcode = 0;\n\n    this._totalPayloadLength = 0;\n    this._messageLength = 0;\n    this._fragments = [];\n\n    this._state = GET_INFO;\n    this._loop = false;\n  }\n\n  /**\n   * Implements `Writable.prototype._write()`.\n   *\n   * @param {Buffer} chunk The chunk of data to write\n   * @param {String} encoding The character encoding of `chunk`\n   * @param {Function} cb Callback\n   * @private\n   */\n  _write(chunk, encoding, cb) {\n    if (this._opcode === 0x08 && this._state == GET_INFO) return cb();\n\n    this._bufferedBytes += chunk.length;\n    this._buffers.push(chunk);\n    this.startLoop(cb);\n  }\n\n  /**\n   * Consumes `n` bytes from the buffered data.\n   *\n   * @param {Number} n The number of bytes to consume\n   * @return {Buffer} The consumed bytes\n   * @private\n   */\n  consume(n) {\n    this._bufferedBytes -= n;\n\n    if (n === this._buffers[0].length) return this._buffers.shift();\n\n    if (n < this._buffers[0].length) {\n      const buf = this._buffers[0];\n      this._buffers[0] = buf.slice(n);\n      return buf.slice(0, n);\n    }\n\n    const dst = Buffer.allocUnsafe(n);\n\n    do {\n      const buf = this._buffers[0];\n      const offset = dst.length - n;\n\n      if (n >= buf.length) {\n        dst.set(this._buffers.shift(), offset);\n      } else {\n        dst.set(new Uint8Array(buf.buffer, buf.byteOffset, n), offset);\n        this._buffers[0] = buf.slice(n);\n      }\n\n      n -= buf.length;\n    } while (n > 0);\n\n    return dst;\n  }\n\n  /**\n   * Starts the parsing loop.\n   *\n   * @param {Function} cb Callback\n   * @private\n   */\n  startLoop(cb) {\n    let err;\n    this._loop = true;\n\n    do {\n      switch (this._state) {\n        case GET_INFO:\n          err = this.getInfo();\n          break;\n        case GET_PAYLOAD_LENGTH_16:\n          err = this.getPayloadLength16();\n          break;\n        case GET_PAYLOAD_LENGTH_64:\n          err = this.getPayloadLength64();\n          break;\n        case GET_MASK:\n          this.getMask();\n          break;\n        case GET_DATA:\n          err = this.getData(cb);\n          break;\n        default:\n          // `INFLATING`\n          this._loop = false;\n          return;\n      }\n    } while (this._loop);\n\n    cb(err);\n  }\n\n  /**\n   * Reads the first two bytes of a frame.\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  getInfo() {\n    if (this._bufferedBytes < 2) {\n      this._loop = false;\n      return;\n    }\n\n    const buf = this.consume(2);\n\n    if ((buf[0] & 0x30) !== 0x00) {\n      this._loop = false;\n      return error(RangeError, 'RSV2 and RSV3 must be clear', true, 1002);\n    }\n\n    const compressed = (buf[0] & 0x40) === 0x40;\n\n    if (compressed && !this._extensions[PerMessageDeflate.extensionName]) {\n      this._loop = false;\n      return error(RangeError, 'RSV1 must be clear', true, 1002);\n    }\n\n    this._fin = (buf[0] & 0x80) === 0x80;\n    this._opcode = buf[0] & 0x0f;\n    this._payloadLength = buf[1] & 0x7f;\n\n    if (this._opcode === 0x00) {\n      if (compressed) {\n        this._loop = false;\n        return error(RangeError, 'RSV1 must be clear', true, 1002);\n      }\n\n      if (!this._fragmented) {\n        this._loop = false;\n        return error(RangeError, 'invalid opcode 0', true, 1002);\n      }\n\n      this._opcode = this._fragmented;\n    } else if (this._opcode === 0x01 || this._opcode === 0x02) {\n      if (this._fragmented) {\n        this._loop = false;\n        return error(RangeError, `invalid opcode ${this._opcode}`, true, 1002);\n      }\n\n      this._compressed = compressed;\n    } else if (this._opcode > 0x07 && this._opcode < 0x0b) {\n      if (!this._fin) {\n        this._loop = false;\n        return error(RangeError, 'FIN must be set', true, 1002);\n      }\n\n      if (compressed) {\n        this._loop = false;\n        return error(RangeError, 'RSV1 must be clear', true, 1002);\n      }\n\n      if (this._payloadLength > 0x7d) {\n        this._loop = false;\n        return error(\n          RangeError,\n          `invalid payload length ${this._payloadLength}`,\n          true,\n          1002\n        );\n      }\n    } else {\n      this._loop = false;\n      return error(RangeError, `invalid opcode ${this._opcode}`, true, 1002);\n    }\n\n    if (!this._fin && !this._fragmented) this._fragmented = this._opcode;\n    this._masked = (buf[1] & 0x80) === 0x80;\n\n    if (this._isServer) {\n      if (!this._masked) {\n        this._loop = false;\n        return error(RangeError, 'MASK must be set', true, 1002);\n      }\n    } else if (this._masked) {\n      this._loop = false;\n      return error(RangeError, 'MASK must be clear', true, 1002);\n    }\n\n    if (this._payloadLength === 126) this._state = GET_PAYLOAD_LENGTH_16;\n    else if (this._payloadLength === 127) this._state = GET_PAYLOAD_LENGTH_64;\n    else return this.haveLength();\n  }\n\n  /**\n   * Gets extended payload length (7+16).\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  getPayloadLength16() {\n    if (this._bufferedBytes < 2) {\n      this._loop = false;\n      return;\n    }\n\n    this._payloadLength = this.consume(2).readUInt16BE(0);\n    return this.haveLength();\n  }\n\n  /**\n   * Gets extended payload length (7+64).\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  getPayloadLength64() {\n    if (this._bufferedBytes < 8) {\n      this._loop = false;\n      return;\n    }\n\n    const buf = this.consume(8);\n    const num = buf.readUInt32BE(0);\n\n    //\n    // The maximum safe integer in JavaScript is 2^53 - 1. An error is returned\n    // if payload length is greater than this number.\n    //\n    if (num > Math.pow(2, 53 - 32) - 1) {\n      this._loop = false;\n      return error(\n        RangeError,\n        'Unsupported WebSocket frame: payload length > 2^53 - 1',\n        false,\n        1009\n      );\n    }\n\n    this._payloadLength = num * Math.pow(2, 32) + buf.readUInt32BE(4);\n    return this.haveLength();\n  }\n\n  /**\n   * Payload length has been read.\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  haveLength() {\n    if (this._payloadLength && this._opcode < 0x08) {\n      this._totalPayloadLength += this._payloadLength;\n      if (this._totalPayloadLength > this._maxPayload && this._maxPayload > 0) {\n        this._loop = false;\n        return error(RangeError, 'Max payload size exceeded', false, 1009);\n      }\n    }\n\n    if (this._masked) this._state = GET_MASK;\n    else this._state = GET_DATA;\n  }\n\n  /**\n   * Reads mask bytes.\n   *\n   * @private\n   */\n  getMask() {\n    if (this._bufferedBytes < 4) {\n      this._loop = false;\n      return;\n    }\n\n    this._mask = this.consume(4);\n    this._state = GET_DATA;\n  }\n\n  /**\n   * Reads data bytes.\n   *\n   * @param {Function} cb Callback\n   * @return {(Error|RangeError|undefined)} A possible error\n   * @private\n   */\n  getData(cb) {\n    let data = EMPTY_BUFFER;\n\n    if (this._payloadLength) {\n      if (this._bufferedBytes < this._payloadLength) {\n        this._loop = false;\n        return;\n      }\n\n      data = this.consume(this._payloadLength);\n      if (this._masked) unmask(data, this._mask);\n    }\n\n    if (this._opcode > 0x07) return this.controlMessage(data);\n\n    if (this._compressed) {\n      this._state = INFLATING;\n      this.decompress(data, cb);\n      return;\n    }\n\n    if (data.length) {\n      //\n      // This message is not compressed so its lenght is the sum of the payload\n      // length of all fragments.\n      //\n      this._messageLength = this._totalPayloadLength;\n      this._fragments.push(data);\n    }\n\n    return this.dataMessage();\n  }\n\n  /**\n   * Decompresses data.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Function} cb Callback\n   * @private\n   */\n  decompress(data, cb) {\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n\n    perMessageDeflate.decompress(data, this._fin, (err, buf) => {\n      if (err) return cb(err);\n\n      if (buf.length) {\n        this._messageLength += buf.length;\n        if (this._messageLength > this._maxPayload && this._maxPayload > 0) {\n          return cb(\n            error(RangeError, 'Max payload size exceeded', false, 1009)\n          );\n        }\n\n        this._fragments.push(buf);\n      }\n\n      const er = this.dataMessage();\n      if (er) return cb(er);\n\n      this.startLoop(cb);\n    });\n  }\n\n  /**\n   * Handles a data message.\n   *\n   * @return {(Error|undefined)} A possible error\n   * @private\n   */\n  dataMessage() {\n    if (this._fin) {\n      const messageLength = this._messageLength;\n      const fragments = this._fragments;\n\n      this._totalPayloadLength = 0;\n      this._messageLength = 0;\n      this._fragmented = 0;\n      this._fragments = [];\n\n      if (this._opcode === 2) {\n        let data;\n\n        if (this._binaryType === 'nodebuffer') {\n          data = concat(fragments, messageLength);\n        } else if (this._binaryType === 'arraybuffer') {\n          data = toArrayBuffer(concat(fragments, messageLength));\n        } else {\n          data = fragments;\n        }\n\n        this.emit('message', data);\n      } else {\n        const buf = concat(fragments, messageLength);\n\n        if (!isValidUTF8(buf)) {\n          this._loop = false;\n          return error(Error, 'invalid UTF-8 sequence', true, 1007);\n        }\n\n        this.emit('message', buf.toString());\n      }\n    }\n\n    this._state = GET_INFO;\n  }\n\n  /**\n   * Handles a control message.\n   *\n   * @param {Buffer} data Data to handle\n   * @return {(Error|RangeError|undefined)} A possible error\n   * @private\n   */\n  controlMessage(data) {\n    if (this._opcode === 0x08) {\n      this._loop = false;\n\n      if (data.length === 0) {\n        this.emit('conclude', 1005, '');\n        this.end();\n      } else if (data.length === 1) {\n        return error(RangeError, 'invalid payload length 1', true, 1002);\n      } else {\n        const code = data.readUInt16BE(0);\n\n        if (!isValidStatusCode(code)) {\n          return error(RangeError, `invalid status code ${code}`, true, 1002);\n        }\n\n        const buf = data.slice(2);\n\n        if (!isValidUTF8(buf)) {\n          return error(Error, 'invalid UTF-8 sequence', true, 1007);\n        }\n\n        this.emit('conclude', code, buf.toString());\n        this.end();\n      }\n    } else if (this._opcode === 0x09) {\n      this.emit('ping', data);\n    } else {\n      this.emit('pong', data);\n    }\n\n    this._state = GET_INFO;\n  }\n}\n\nmodule.exports = Receiver;\n\n/**\n * Builds an error object.\n *\n * @param {(Error|RangeError)} ErrorCtor The error constructor\n * @param {String} message The error message\n * @param {Boolean} prefix Specifies whether or not to add a default prefix to\n *     `message`\n * @param {Number} statusCode The status code\n * @return {(Error|RangeError)} The error\n * @private\n */\nfunction error(ErrorCtor, message, prefix, statusCode) {\n  const err = new ErrorCtor(\n    prefix ? `Invalid WebSocket frame: ${message}` : message\n  );\n\n  Error.captureStackTrace(err, error);\n  err[kStatusCode] = statusCode;\n  return err;\n}\n","'use strict';\n\nconst { randomFillSync } = require('crypto');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst { EMPTY_BUFFER } = require('./constants');\nconst { isValidStatusCode } = require('./validation');\nconst { mask: applyMask, toBuffer } = require('./buffer-util');\n\nconst mask = Buffer.alloc(4);\n\n/**\n * HyBi Sender implementation.\n */\nclass Sender {\n  /**\n   * Creates a Sender instance.\n   *\n   * @param {net.Socket} socket The connection socket\n   * @param {Object} [extensions] An object containing the negotiated extensions\n   */\n  constructor(socket, extensions) {\n    this._extensions = extensions || {};\n    this._socket = socket;\n\n    this._firstFragment = true;\n    this._compress = false;\n\n    this._bufferedBytes = 0;\n    this._deflating = false;\n    this._queue = [];\n  }\n\n  /**\n   * Frames a piece of data according to the HyBi WebSocket protocol.\n   *\n   * @param {Buffer} data The data to frame\n   * @param {Object} options Options object\n   * @param {Number} options.opcode The opcode\n   * @param {Boolean} [options.readOnly=false] Specifies whether `data` can be\n   *     modified\n   * @param {Boolean} [options.fin=false] Specifies whether or not to set the\n   *     FIN bit\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Boolean} [options.rsv1=false] Specifies whether or not to set the\n   *     RSV1 bit\n   * @return {Buffer[]} The framed data as a list of `Buffer` instances\n   * @public\n   */\n  static frame(data, options) {\n    const merge = options.mask && options.readOnly;\n    let offset = options.mask ? 6 : 2;\n    let payloadLength = data.length;\n\n    if (data.length >= 65536) {\n      offset += 8;\n      payloadLength = 127;\n    } else if (data.length > 125) {\n      offset += 2;\n      payloadLength = 126;\n    }\n\n    const target = Buffer.allocUnsafe(merge ? data.length + offset : offset);\n\n    target[0] = options.fin ? options.opcode | 0x80 : options.opcode;\n    if (options.rsv1) target[0] |= 0x40;\n\n    target[1] = payloadLength;\n\n    if (payloadLength === 126) {\n      target.writeUInt16BE(data.length, 2);\n    } else if (payloadLength === 127) {\n      target.writeUInt32BE(0, 2);\n      target.writeUInt32BE(data.length, 6);\n    }\n\n    if (!options.mask) return [target, data];\n\n    randomFillSync(mask, 0, 4);\n\n    target[1] |= 0x80;\n    target[offset - 4] = mask[0];\n    target[offset - 3] = mask[1];\n    target[offset - 2] = mask[2];\n    target[offset - 1] = mask[3];\n\n    if (merge) {\n      applyMask(data, mask, target, offset, data.length);\n      return [target];\n    }\n\n    applyMask(data, mask, data, 0, data.length);\n    return [target, data];\n  }\n\n  /**\n   * Sends a close message to the other peer.\n   *\n   * @param {Number} [code] The status code component of the body\n   * @param {String} [data] The message component of the body\n   * @param {Boolean} [mask=false] Specifies whether or not to mask the message\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  close(code, data, mask, cb) {\n    let buf;\n\n    if (code === undefined) {\n      buf = EMPTY_BUFFER;\n    } else if (typeof code !== 'number' || !isValidStatusCode(code)) {\n      throw new TypeError('First argument must be a valid error code number');\n    } else if (data === undefined || data === '') {\n      buf = Buffer.allocUnsafe(2);\n      buf.writeUInt16BE(code, 0);\n    } else {\n      const length = Buffer.byteLength(data);\n\n      if (length > 123) {\n        throw new RangeError('The message must not be greater than 123 bytes');\n      }\n\n      buf = Buffer.allocUnsafe(2 + length);\n      buf.writeUInt16BE(code, 0);\n      buf.write(data, 2);\n    }\n\n    if (this._deflating) {\n      this.enqueue([this.doClose, buf, mask, cb]);\n    } else {\n      this.doClose(buf, mask, cb);\n    }\n  }\n\n  /**\n   * Frames and sends a close message.\n   *\n   * @param {Buffer} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  doClose(data, mask, cb) {\n    this.sendFrame(\n      Sender.frame(data, {\n        fin: true,\n        rsv1: false,\n        opcode: 0x08,\n        mask,\n        readOnly: false\n      }),\n      cb\n    );\n  }\n\n  /**\n   * Sends a ping message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  ping(data, mask, cb) {\n    const buf = toBuffer(data);\n\n    if (buf.length > 125) {\n      throw new RangeError('The data size must not be greater than 125 bytes');\n    }\n\n    if (this._deflating) {\n      this.enqueue([this.doPing, buf, mask, toBuffer.readOnly, cb]);\n    } else {\n      this.doPing(buf, mask, toBuffer.readOnly, cb);\n    }\n  }\n\n  /**\n   * Frames and sends a ping message.\n   *\n   * @param {Buffer} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Boolean} [readOnly=false] Specifies whether `data` can be modified\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  doPing(data, mask, readOnly, cb) {\n    this.sendFrame(\n      Sender.frame(data, {\n        fin: true,\n        rsv1: false,\n        opcode: 0x09,\n        mask,\n        readOnly\n      }),\n      cb\n    );\n  }\n\n  /**\n   * Sends a pong message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  pong(data, mask, cb) {\n    const buf = toBuffer(data);\n\n    if (buf.length > 125) {\n      throw new RangeError('The data size must not be greater than 125 bytes');\n    }\n\n    if (this._deflating) {\n      this.enqueue([this.doPong, buf, mask, toBuffer.readOnly, cb]);\n    } else {\n      this.doPong(buf, mask, toBuffer.readOnly, cb);\n    }\n  }\n\n  /**\n   * Frames and sends a pong message.\n   *\n   * @param {Buffer} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Boolean} [readOnly=false] Specifies whether `data` can be modified\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  doPong(data, mask, readOnly, cb) {\n    this.sendFrame(\n      Sender.frame(data, {\n        fin: true,\n        rsv1: false,\n        opcode: 0x0a,\n        mask,\n        readOnly\n      }),\n      cb\n    );\n  }\n\n  /**\n   * Sends a data message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Object} options Options object\n   * @param {Boolean} [options.compress=false] Specifies whether or not to\n   *     compress `data`\n   * @param {Boolean} [options.binary=false] Specifies whether `data` is binary\n   *     or text\n   * @param {Boolean} [options.fin=false] Specifies whether the fragment is the\n   *     last one\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  send(data, options, cb) {\n    const buf = toBuffer(data);\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n    let opcode = options.binary ? 2 : 1;\n    let rsv1 = options.compress;\n\n    if (this._firstFragment) {\n      this._firstFragment = false;\n      if (rsv1 && perMessageDeflate) {\n        rsv1 = buf.length >= perMessageDeflate._threshold;\n      }\n      this._compress = rsv1;\n    } else {\n      rsv1 = false;\n      opcode = 0;\n    }\n\n    if (options.fin) this._firstFragment = true;\n\n    if (perMessageDeflate) {\n      const opts = {\n        fin: options.fin,\n        rsv1,\n        opcode,\n        mask: options.mask,\n        readOnly: toBuffer.readOnly\n      };\n\n      if (this._deflating) {\n        this.enqueue([this.dispatch, buf, this._compress, opts, cb]);\n      } else {\n        this.dispatch(buf, this._compress, opts, cb);\n      }\n    } else {\n      this.sendFrame(\n        Sender.frame(buf, {\n          fin: options.fin,\n          rsv1: false,\n          opcode,\n          mask: options.mask,\n          readOnly: toBuffer.readOnly\n        }),\n        cb\n      );\n    }\n  }\n\n  /**\n   * Dispatches a data message.\n   *\n   * @param {Buffer} data The message to send\n   * @param {Boolean} [compress=false] Specifies whether or not to compress\n   *     `data`\n   * @param {Object} options Options object\n   * @param {Number} options.opcode The opcode\n   * @param {Boolean} [options.readOnly=false] Specifies whether `data` can be\n   *     modified\n   * @param {Boolean} [options.fin=false] Specifies whether or not to set the\n   *     FIN bit\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Boolean} [options.rsv1=false] Specifies whether or not to set the\n   *     RSV1 bit\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  dispatch(data, compress, options, cb) {\n    if (!compress) {\n      this.sendFrame(Sender.frame(data, options), cb);\n      return;\n    }\n\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n\n    this._bufferedBytes += data.length;\n    this._deflating = true;\n    perMessageDeflate.compress(data, options.fin, (_, buf) => {\n      if (this._socket.destroyed) {\n        const err = new Error(\n          'The socket was closed while data was being compressed'\n        );\n\n        if (typeof cb === 'function') cb(err);\n\n        for (let i = 0; i < this._queue.length; i++) {\n          const callback = this._queue[i][4];\n\n          if (typeof callback === 'function') callback(err);\n        }\n\n        return;\n      }\n\n      this._bufferedBytes -= data.length;\n      this._deflating = false;\n      options.readOnly = false;\n      this.sendFrame(Sender.frame(buf, options), cb);\n      this.dequeue();\n    });\n  }\n\n  /**\n   * Executes queued send operations.\n   *\n   * @private\n   */\n  dequeue() {\n    while (!this._deflating && this._queue.length) {\n      const params = this._queue.shift();\n\n      this._bufferedBytes -= params[1].length;\n      Reflect.apply(params[0], this, params.slice(1));\n    }\n  }\n\n  /**\n   * Enqueues a send operation.\n   *\n   * @param {Array} params Send operation parameters.\n   * @private\n   */\n  enqueue(params) {\n    this._bufferedBytes += params[1].length;\n    this._queue.push(params);\n  }\n\n  /**\n   * Sends a frame.\n   *\n   * @param {Buffer[]} list The frame to send\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  sendFrame(list, cb) {\n    if (list.length === 2) {\n      this._socket.cork();\n      this._socket.write(list[0]);\n      this._socket.write(list[1], cb);\n      this._socket.uncork();\n    } else {\n      this._socket.write(list[0], cb);\n    }\n  }\n}\n\nmodule.exports = Sender;\n","'use strict';\n\nconst { Duplex } = require('stream');\n\n/**\n * Emits the `'close'` event on a stream.\n *\n * @param {stream.Duplex} The stream.\n * @private\n */\nfunction emitClose(stream) {\n  stream.emit('close');\n}\n\n/**\n * The listener of the `'end'` event.\n *\n * @private\n */\nfunction duplexOnEnd() {\n  if (!this.destroyed && this._writableState.finished) {\n    this.destroy();\n  }\n}\n\n/**\n * The listener of the `'error'` event.\n *\n * @param {Error} err The error\n * @private\n */\nfunction duplexOnError(err) {\n  this.removeListener('error', duplexOnError);\n  this.destroy();\n  if (this.listenerCount('error') === 0) {\n    // Do not suppress the throwing behavior.\n    this.emit('error', err);\n  }\n}\n\n/**\n * Wraps a `WebSocket` in a duplex stream.\n *\n * @param {WebSocket} ws The `WebSocket` to wrap\n * @param {Object} [options] The options for the `Duplex` constructor\n * @return {stream.Duplex} The duplex stream\n * @public\n */\nfunction createWebSocketStream(ws, options) {\n  let resumeOnReceiverDrain = true;\n\n  function receiverOnDrain() {\n    if (resumeOnReceiverDrain) ws._socket.resume();\n  }\n\n  if (ws.readyState === ws.CONNECTING) {\n    ws.once('open', function open() {\n      ws._receiver.removeAllListeners('drain');\n      ws._receiver.on('drain', receiverOnDrain);\n    });\n  } else {\n    ws._receiver.removeAllListeners('drain');\n    ws._receiver.on('drain', receiverOnDrain);\n  }\n\n  const duplex = new Duplex({\n    ...options,\n    autoDestroy: false,\n    emitClose: false,\n    objectMode: false,\n    writableObjectMode: false\n  });\n\n  ws.on('message', function message(msg) {\n    if (!duplex.push(msg)) {\n      resumeOnReceiverDrain = false;\n      ws._socket.pause();\n    }\n  });\n\n  ws.once('error', function error(err) {\n    if (duplex.destroyed) return;\n\n    duplex.destroy(err);\n  });\n\n  ws.once('close', function close() {\n    if (duplex.destroyed) return;\n\n    duplex.push(null);\n  });\n\n  duplex._destroy = function (err, callback) {\n    if (ws.readyState === ws.CLOSED) {\n      callback(err);\n      process.nextTick(emitClose, duplex);\n      return;\n    }\n\n    let called = false;\n\n    ws.once('error', function error(err) {\n      called = true;\n      callback(err);\n    });\n\n    ws.once('close', function close() {\n      if (!called) callback(err);\n      process.nextTick(emitClose, duplex);\n    });\n    ws.terminate();\n  };\n\n  duplex._final = function (callback) {\n    if (ws.readyState === ws.CONNECTING) {\n      ws.once('open', function open() {\n        duplex._final(callback);\n      });\n      return;\n    }\n\n    // If the value of the `_socket` property is `null` it means that `ws` is a\n    // client websocket and the handshake failed. In fact, when this happens, a\n    // socket is never assigned to the websocket. Wait for the `'error'` event\n    // that will be emitted by the websocket.\n    if (ws._socket === null) return;\n\n    if (ws._socket._writableState.finished) {\n      callback();\n      if (duplex._readableState.endEmitted) duplex.destroy();\n    } else {\n      ws._socket.once('finish', function finish() {\n        // `duplex` is not destroyed here because the `'end'` event will be\n        // emitted on `duplex` after this `'finish'` event. The EOF signaling\n        // `null` chunk is, in fact, pushed when the websocket emits `'close'`.\n        callback();\n      });\n      ws.close();\n    }\n  };\n\n  duplex._read = function () {\n    if (ws.readyState === ws.OPEN && !resumeOnReceiverDrain) {\n      resumeOnReceiverDrain = true;\n      if (!ws._receiver._writableState.needDrain) ws._socket.resume();\n    }\n  };\n\n  duplex._write = function (chunk, encoding, callback) {\n    if (ws.readyState === ws.CONNECTING) {\n      ws.once('open', function open() {\n        duplex._write(chunk, encoding, callback);\n      });\n      return;\n    }\n\n    ws.send(chunk, callback);\n  };\n\n  duplex.on('end', duplexOnEnd);\n  duplex.on('error', duplexOnError);\n  return duplex;\n}\n\nmodule.exports = createWebSocketStream;\n","'use strict';\n\n/**\n * Checks if a status code is allowed in a close frame.\n *\n * @param {Number} code The status code\n * @return {Boolean} `true` if the status code is valid, else `false`\n * @public\n */\nfunction isValidStatusCode(code) {\n  return (\n    (code >= 1000 &&\n      code <= 1014 &&\n      code !== 1004 &&\n      code !== 1005 &&\n      code !== 1006) ||\n    (code >= 3000 && code <= 4999)\n  );\n}\n\n/**\n * Checks if a given buffer contains only correct UTF-8.\n * Ported from https://www.cl.cam.ac.uk/%7Emgk25/ucs/utf8_check.c by\n * Markus Kuhn.\n *\n * @param {Buffer} buf The buffer to check\n * @return {Boolean} `true` if `buf` contains only correct UTF-8, else `false`\n * @public\n */\nfunction _isValidUTF8(buf) {\n  const len = buf.length;\n  let i = 0;\n\n  while (i < len) {\n    if (buf[i] < 0x80) {\n      // 0xxxxxxx\n      i++;\n    } else if ((buf[i] & 0xe0) === 0xc0) {\n      // 110xxxxx 10xxxxxx\n      if (\n        i + 1 === len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i] & 0xfe) === 0xc0 // Overlong\n      ) {\n        return false;\n      } else {\n        i += 2;\n      }\n    } else if ((buf[i] & 0xf0) === 0xe0) {\n      // 1110xxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 2 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        (buf[i] === 0xe0 && (buf[i + 1] & 0xe0) === 0x80) || // Overlong\n        (buf[i] === 0xed && (buf[i + 1] & 0xe0) === 0xa0) // Surrogate (U+D800 - U+DFFF)\n      ) {\n        return false;\n      } else {\n        i += 3;\n      }\n    } else if ((buf[i] & 0xf8) === 0xf0) {\n      // 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 3 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        (buf[i + 3] & 0xc0) !== 0x80 ||\n        (buf[i] === 0xf0 && (buf[i + 1] & 0xf0) === 0x80) || // Overlong\n        (buf[i] === 0xf4 && buf[i + 1] > 0x8f) ||\n        buf[i] > 0xf4 // > U+10FFFF\n      ) {\n        return false;\n      } else {\n        i += 4;\n      }\n    } else {\n      return false;\n    }\n  }\n\n  return true;\n}\n\ntry {\n  let isValidUTF8 = require('utf-8-validate');\n\n  /* istanbul ignore if */\n  if (typeof isValidUTF8 === 'object') {\n    isValidUTF8 = isValidUTF8.Validation.isValidUTF8; // utf-8-validate@<3.0.0\n  }\n\n  module.exports = {\n    isValidStatusCode,\n    isValidUTF8(buf) {\n      return buf.length < 150 ? _isValidUTF8(buf) : isValidUTF8(buf);\n    }\n  };\n} catch (e) /* istanbul ignore next */ {\n  module.exports = {\n    isValidStatusCode,\n    isValidUTF8: _isValidUTF8\n  };\n}\n","'use strict';\n\nconst EventEmitter = require('events');\nconst { createHash } = require('crypto');\nconst { createServer, STATUS_CODES } = require('http');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst WebSocket = require('./websocket');\nconst { format, parse } = require('./extension');\nconst { GUID, kWebSocket } = require('./constants');\n\nconst keyRegex = /^[+/0-9A-Za-z]{22}==$/;\n\n/**\n * Class representing a WebSocket server.\n *\n * @extends EventEmitter\n */\nclass WebSocketServer extends EventEmitter {\n  /**\n   * Create a `WebSocketServer` instance.\n   *\n   * @param {Object} options Configuration options\n   * @param {Number} [options.backlog=511] The maximum length of the queue of\n   *     pending connections\n   * @param {Boolean} [options.clientTracking=true] Specifies whether or not to\n   *     track clients\n   * @param {Function} [options.handleProtocols] A hook to handle protocols\n   * @param {String} [options.host] The hostname where to bind the server\n   * @param {Number} [options.maxPayload=104857600] The maximum allowed message\n   *     size\n   * @param {Boolean} [options.noServer=false] Enable no server mode\n   * @param {String} [options.path] Accept only connections matching this path\n   * @param {(Boolean|Object)} [options.perMessageDeflate=false] Enable/disable\n   *     permessage-deflate\n   * @param {Number} [options.port] The port where to bind the server\n   * @param {http.Server} [options.server] A pre-created HTTP/S server to use\n   * @param {Function} [options.verifyClient] A hook to reject connections\n   * @param {Function} [callback] A listener for the `listening` event\n   */\n  constructor(options, callback) {\n    super();\n\n    options = {\n      maxPayload: 100 * 1024 * 1024,\n      perMessageDeflate: false,\n      handleProtocols: null,\n      clientTracking: true,\n      verifyClient: null,\n      noServer: false,\n      backlog: null, // use default (511 as implemented in net.js)\n      server: null,\n      host: null,\n      path: null,\n      port: null,\n      ...options\n    };\n\n    if (options.port == null && !options.server && !options.noServer) {\n      throw new TypeError(\n        'One of the \"port\", \"server\", or \"noServer\" options must be specified'\n      );\n    }\n\n    if (options.port != null) {\n      this._server = createServer((req, res) => {\n        const body = STATUS_CODES[426];\n\n        res.writeHead(426, {\n          'Content-Length': body.length,\n          'Content-Type': 'text/plain'\n        });\n        res.end(body);\n      });\n      this._server.listen(\n        options.port,\n        options.host,\n        options.backlog,\n        callback\n      );\n    } else if (options.server) {\n      this._server = options.server;\n    }\n\n    if (this._server) {\n      const emitConnection = this.emit.bind(this, 'connection');\n\n      this._removeListeners = addListeners(this._server, {\n        listening: this.emit.bind(this, 'listening'),\n        error: this.emit.bind(this, 'error'),\n        upgrade: (req, socket, head) => {\n          this.handleUpgrade(req, socket, head, emitConnection);\n        }\n      });\n    }\n\n    if (options.perMessageDeflate === true) options.perMessageDeflate = {};\n    if (options.clientTracking) this.clients = new Set();\n    this.options = options;\n  }\n\n  /**\n   * Returns the bound address, the address family name, and port of the server\n   * as reported by the operating system if listening on an IP socket.\n   * If the server is listening on a pipe or UNIX domain socket, the name is\n   * returned as a string.\n   *\n   * @return {(Object|String|null)} The address of the server\n   * @public\n   */\n  address() {\n    if (this.options.noServer) {\n      throw new Error('The server is operating in \"noServer\" mode');\n    }\n\n    if (!this._server) return null;\n    return this._server.address();\n  }\n\n  /**\n   * Close the server.\n   *\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  close(cb) {\n    if (cb) this.once('close', cb);\n\n    //\n    // Terminate all associated clients.\n    //\n    if (this.clients) {\n      for (const client of this.clients) client.terminate();\n    }\n\n    const server = this._server;\n\n    if (server) {\n      this._removeListeners();\n      this._removeListeners = this._server = null;\n\n      //\n      // Close the http server if it was internally created.\n      //\n      if (this.options.port != null) {\n        server.close(() => this.emit('close'));\n        return;\n      }\n    }\n\n    process.nextTick(emitClose, this);\n  }\n\n  /**\n   * See if a given request should be handled by this server instance.\n   *\n   * @param {http.IncomingMessage} req Request object to inspect\n   * @return {Boolean} `true` if the request is valid, else `false`\n   * @public\n   */\n  shouldHandle(req) {\n    if (this.options.path) {\n      const index = req.url.indexOf('?');\n      const pathname = index !== -1 ? req.url.slice(0, index) : req.url;\n\n      if (pathname !== this.options.path) return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Handle a HTTP Upgrade request.\n   *\n   * @param {http.IncomingMessage} req The request object\n   * @param {net.Socket} socket The network socket between the server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Function} cb Callback\n   * @public\n   */\n  handleUpgrade(req, socket, head, cb) {\n    socket.on('error', socketOnError);\n\n    const key =\n      req.headers['sec-websocket-key'] !== undefined\n        ? req.headers['sec-websocket-key'].trim()\n        : false;\n    const version = +req.headers['sec-websocket-version'];\n    const extensions = {};\n\n    if (\n      req.method !== 'GET' ||\n      req.headers.upgrade.toLowerCase() !== 'websocket' ||\n      !key ||\n      !keyRegex.test(key) ||\n      (version !== 8 && version !== 13) ||\n      !this.shouldHandle(req)\n    ) {\n      return abortHandshake(socket, 400);\n    }\n\n    if (this.options.perMessageDeflate) {\n      const perMessageDeflate = new PerMessageDeflate(\n        this.options.perMessageDeflate,\n        true,\n        this.options.maxPayload\n      );\n\n      try {\n        const offers = parse(req.headers['sec-websocket-extensions']);\n\n        if (offers[PerMessageDeflate.extensionName]) {\n          perMessageDeflate.accept(offers[PerMessageDeflate.extensionName]);\n          extensions[PerMessageDeflate.extensionName] = perMessageDeflate;\n        }\n      } catch (err) {\n        return abortHandshake(socket, 400);\n      }\n    }\n\n    //\n    // Optionally call external client verification handler.\n    //\n    if (this.options.verifyClient) {\n      const info = {\n        origin:\n          req.headers[`${version === 8 ? 'sec-websocket-origin' : 'origin'}`],\n        secure: !!(req.socket.authorized || req.socket.encrypted),\n        req\n      };\n\n      if (this.options.verifyClient.length === 2) {\n        this.options.verifyClient(info, (verified, code, message, headers) => {\n          if (!verified) {\n            return abortHandshake(socket, code || 401, message, headers);\n          }\n\n          this.completeUpgrade(key, extensions, req, socket, head, cb);\n        });\n        return;\n      }\n\n      if (!this.options.verifyClient(info)) return abortHandshake(socket, 401);\n    }\n\n    this.completeUpgrade(key, extensions, req, socket, head, cb);\n  }\n\n  /**\n   * Upgrade the connection to WebSocket.\n   *\n   * @param {String} key The value of the `Sec-WebSocket-Key` header\n   * @param {Object} extensions The accepted extensions\n   * @param {http.IncomingMessage} req The request object\n   * @param {net.Socket} socket The network socket between the server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Function} cb Callback\n   * @throws {Error} If called more than once with the same socket\n   * @private\n   */\n  completeUpgrade(key, extensions, req, socket, head, cb) {\n    //\n    // Destroy the socket if the client has already sent a FIN packet.\n    //\n    if (!socket.readable || !socket.writable) return socket.destroy();\n\n    if (socket[kWebSocket]) {\n      throw new Error(\n        'server.handleUpgrade() was called more than once with the same ' +\n          'socket, possibly due to a misconfiguration'\n      );\n    }\n\n    const digest = createHash('sha1')\n      .update(key + GUID)\n      .digest('base64');\n\n    const headers = [\n      'HTTP/1.1 101 Switching Protocols',\n      'Upgrade: websocket',\n      'Connection: Upgrade',\n      `Sec-WebSocket-Accept: ${digest}`\n    ];\n\n    const ws = new WebSocket(null);\n    let protocol = req.headers['sec-websocket-protocol'];\n\n    if (protocol) {\n      protocol = protocol.trim().split(/ *, */);\n\n      //\n      // Optionally call external protocol selection handler.\n      //\n      if (this.options.handleProtocols) {\n        protocol = this.options.handleProtocols(protocol, req);\n      } else {\n        protocol = protocol[0];\n      }\n\n      if (protocol) {\n        headers.push(`Sec-WebSocket-Protocol: ${protocol}`);\n        ws._protocol = protocol;\n      }\n    }\n\n    if (extensions[PerMessageDeflate.extensionName]) {\n      const params = extensions[PerMessageDeflate.extensionName].params;\n      const value = format({\n        [PerMessageDeflate.extensionName]: [params]\n      });\n      headers.push(`Sec-WebSocket-Extensions: ${value}`);\n      ws._extensions = extensions;\n    }\n\n    //\n    // Allow external modification/inspection of handshake headers.\n    //\n    this.emit('headers', headers, req);\n\n    socket.write(headers.concat('\\r\\n').join('\\r\\n'));\n    socket.removeListener('error', socketOnError);\n\n    ws.setSocket(socket, head, this.options.maxPayload);\n\n    if (this.clients) {\n      this.clients.add(ws);\n      ws.on('close', () => this.clients.delete(ws));\n    }\n\n    cb(ws, req);\n  }\n}\n\nmodule.exports = WebSocketServer;\n\n/**\n * Add event listeners on an `EventEmitter` using a map of <event, listener>\n * pairs.\n *\n * @param {EventEmitter} server The event emitter\n * @param {Object.<String, Function>} map The listeners to add\n * @return {Function} A function that will remove the added listeners when\n *     called\n * @private\n */\nfunction addListeners(server, map) {\n  for (const event of Object.keys(map)) server.on(event, map[event]);\n\n  return function removeListeners() {\n    for (const event of Object.keys(map)) {\n      server.removeListener(event, map[event]);\n    }\n  };\n}\n\n/**\n * Emit a `'close'` event on an `EventEmitter`.\n *\n * @param {EventEmitter} server The event emitter\n * @private\n */\nfunction emitClose(server) {\n  server.emit('close');\n}\n\n/**\n * Handle premature socket errors.\n *\n * @private\n */\nfunction socketOnError() {\n  this.destroy();\n}\n\n/**\n * Close the connection when preconditions are not fulfilled.\n *\n * @param {net.Socket} socket The socket of the upgrade request\n * @param {Number} code The HTTP response status code\n * @param {String} [message] The HTTP response body\n * @param {Object} [headers] Additional HTTP response headers\n * @private\n */\nfunction abortHandshake(socket, code, message, headers) {\n  if (socket.writable) {\n    message = message || STATUS_CODES[code];\n    headers = {\n      Connection: 'close',\n      'Content-Type': 'text/html',\n      'Content-Length': Buffer.byteLength(message),\n      ...headers\n    };\n\n    socket.write(\n      `HTTP/1.1 ${code} ${STATUS_CODES[code]}\\r\\n` +\n        Object.keys(headers)\n          .map((h) => `${h}: ${headers[h]}`)\n          .join('\\r\\n') +\n        '\\r\\n\\r\\n' +\n        message\n    );\n  }\n\n  socket.removeListener('error', socketOnError);\n  socket.destroy();\n}\n","'use strict';\n\nconst EventEmitter = require('events');\nconst https = require('https');\nconst http = require('http');\nconst net = require('net');\nconst tls = require('tls');\nconst { randomBytes, createHash } = require('crypto');\nconst { URL } = require('url');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst Receiver = require('./receiver');\nconst Sender = require('./sender');\nconst {\n  BINARY_TYPES,\n  EMPTY_BUFFER,\n  GUID,\n  kStatusCode,\n  kWebSocket,\n  NOOP\n} = require('./constants');\nconst { addEventListener, removeEventListener } = require('./event-target');\nconst { format, parse } = require('./extension');\nconst { toBuffer } = require('./buffer-util');\n\nconst readyStates = ['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED'];\nconst protocolVersions = [8, 13];\nconst closeTimeout = 30 * 1000;\n\n/**\n * Class representing a WebSocket.\n *\n * @extends EventEmitter\n */\nclass WebSocket extends EventEmitter {\n  /**\n   * Create a new `WebSocket`.\n   *\n   * @param {(String|url.URL)} address The URL to which to connect\n   * @param {(String|String[])} [protocols] The subprotocols\n   * @param {Object} [options] Connection options\n   */\n  constructor(address, protocols, options) {\n    super();\n\n    this._binaryType = BINARY_TYPES[0];\n    this._closeCode = 1006;\n    this._closeFrameReceived = false;\n    this._closeFrameSent = false;\n    this._closeMessage = '';\n    this._closeTimer = null;\n    this._extensions = {};\n    this._protocol = '';\n    this._readyState = WebSocket.CONNECTING;\n    this._receiver = null;\n    this._sender = null;\n    this._socket = null;\n\n    if (address !== null) {\n      this._bufferedAmount = 0;\n      this._isServer = false;\n      this._redirects = 0;\n\n      if (Array.isArray(protocols)) {\n        protocols = protocols.join(', ');\n      } else if (typeof protocols === 'object' && protocols !== null) {\n        options = protocols;\n        protocols = undefined;\n      }\n\n      initAsClient(this, address, protocols, options);\n    } else {\n      this._isServer = true;\n    }\n  }\n\n  /**\n   * This deviates from the WHATWG interface since ws doesn't support the\n   * required default \"blob\" type (instead we define a custom \"nodebuffer\"\n   * type).\n   *\n   * @type {String}\n   */\n  get binaryType() {\n    return this._binaryType;\n  }\n\n  set binaryType(type) {\n    if (!BINARY_TYPES.includes(type)) return;\n\n    this._binaryType = type;\n\n    //\n    // Allow to change `binaryType` on the fly.\n    //\n    if (this._receiver) this._receiver._binaryType = type;\n  }\n\n  /**\n   * @type {Number}\n   */\n  get bufferedAmount() {\n    if (!this._socket) return this._bufferedAmount;\n\n    return this._socket._writableState.length + this._sender._bufferedBytes;\n  }\n\n  /**\n   * @type {String}\n   */\n  get extensions() {\n    return Object.keys(this._extensions).join();\n  }\n\n  /**\n   * @type {String}\n   */\n  get protocol() {\n    return this._protocol;\n  }\n\n  /**\n   * @type {Number}\n   */\n  get readyState() {\n    return this._readyState;\n  }\n\n  /**\n   * @type {String}\n   */\n  get url() {\n    return this._url;\n  }\n\n  /**\n   * Set up the socket and the internal resources.\n   *\n   * @param {net.Socket} socket The network socket between the server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Number} [maxPayload=0] The maximum allowed message size\n   * @private\n   */\n  setSocket(socket, head, maxPayload) {\n    const receiver = new Receiver(\n      this.binaryType,\n      this._extensions,\n      this._isServer,\n      maxPayload\n    );\n\n    this._sender = new Sender(socket, this._extensions);\n    this._receiver = receiver;\n    this._socket = socket;\n\n    receiver[kWebSocket] = this;\n    socket[kWebSocket] = this;\n\n    receiver.on('conclude', receiverOnConclude);\n    receiver.on('drain', receiverOnDrain);\n    receiver.on('error', receiverOnError);\n    receiver.on('message', receiverOnMessage);\n    receiver.on('ping', receiverOnPing);\n    receiver.on('pong', receiverOnPong);\n\n    socket.setTimeout(0);\n    socket.setNoDelay();\n\n    if (head.length > 0) socket.unshift(head);\n\n    socket.on('close', socketOnClose);\n    socket.on('data', socketOnData);\n    socket.on('end', socketOnEnd);\n    socket.on('error', socketOnError);\n\n    this._readyState = WebSocket.OPEN;\n    this.emit('open');\n  }\n\n  /**\n   * Emit the `'close'` event.\n   *\n   * @private\n   */\n  emitClose() {\n    if (!this._socket) {\n      this._readyState = WebSocket.CLOSED;\n      this.emit('close', this._closeCode, this._closeMessage);\n      return;\n    }\n\n    if (this._extensions[PerMessageDeflate.extensionName]) {\n      this._extensions[PerMessageDeflate.extensionName].cleanup();\n    }\n\n    this._receiver.removeAllListeners();\n    this._readyState = WebSocket.CLOSED;\n    this.emit('close', this._closeCode, this._closeMessage);\n  }\n\n  /**\n   * Start a closing handshake.\n   *\n   *          +----------+   +-----------+   +----------+\n   *     - - -|ws.close()|-->|close frame|-->|ws.close()|- - -\n   *    |     +----------+   +-----------+   +----------+     |\n   *          +----------+   +-----------+         |\n   * CLOSING  |ws.close()|<--|close frame|<--+-----+       CLOSING\n   *          +----------+   +-----------+   |\n   *    |           |                        |   +---+        |\n   *                +------------------------+-->|fin| - - - -\n   *    |         +---+                      |   +---+\n   *     - - - - -|fin|<---------------------+\n   *              +---+\n   *\n   * @param {Number} [code] Status code explaining why the connection is closing\n   * @param {String} [data] A string explaining why the connection is closing\n   * @public\n   */\n  close(code, data) {\n    if (this.readyState === WebSocket.CLOSED) return;\n    if (this.readyState === WebSocket.CONNECTING) {\n      const msg = 'WebSocket was closed before the connection was established';\n      return abortHandshake(this, this._req, msg);\n    }\n\n    if (this.readyState === WebSocket.CLOSING) {\n      if (this._closeFrameSent && this._closeFrameReceived) this._socket.end();\n      return;\n    }\n\n    this._readyState = WebSocket.CLOSING;\n    this._sender.close(code, data, !this._isServer, (err) => {\n      //\n      // This error is handled by the `'error'` listener on the socket. We only\n      // want to know if the close frame has been sent here.\n      //\n      if (err) return;\n\n      this._closeFrameSent = true;\n      if (this._closeFrameReceived) this._socket.end();\n    });\n\n    //\n    // Specify a timeout for the closing handshake to complete.\n    //\n    this._closeTimer = setTimeout(\n      this._socket.destroy.bind(this._socket),\n      closeTimeout\n    );\n  }\n\n  /**\n   * Send a ping.\n   *\n   * @param {*} [data] The data to send\n   * @param {Boolean} [mask] Indicates whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when the ping is sent\n   * @public\n   */\n  ping(data, mask, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof data === 'function') {\n      cb = data;\n      data = mask = undefined;\n    } else if (typeof mask === 'function') {\n      cb = mask;\n      mask = undefined;\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    if (mask === undefined) mask = !this._isServer;\n    this._sender.ping(data || EMPTY_BUFFER, mask, cb);\n  }\n\n  /**\n   * Send a pong.\n   *\n   * @param {*} [data] The data to send\n   * @param {Boolean} [mask] Indicates whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when the pong is sent\n   * @public\n   */\n  pong(data, mask, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof data === 'function') {\n      cb = data;\n      data = mask = undefined;\n    } else if (typeof mask === 'function') {\n      cb = mask;\n      mask = undefined;\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    if (mask === undefined) mask = !this._isServer;\n    this._sender.pong(data || EMPTY_BUFFER, mask, cb);\n  }\n\n  /**\n   * Send a data message.\n   *\n   * @param {*} data The message to send\n   * @param {Object} [options] Options object\n   * @param {Boolean} [options.compress] Specifies whether or not to compress\n   *     `data`\n   * @param {Boolean} [options.binary] Specifies whether `data` is binary or\n   *     text\n   * @param {Boolean} [options.fin=true] Specifies whether the fragment is the\n   *     last one\n   * @param {Boolean} [options.mask] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when data is written out\n   * @public\n   */\n  send(data, options, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof options === 'function') {\n      cb = options;\n      options = {};\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    const opts = {\n      binary: typeof data !== 'string',\n      mask: !this._isServer,\n      compress: true,\n      fin: true,\n      ...options\n    };\n\n    if (!this._extensions[PerMessageDeflate.extensionName]) {\n      opts.compress = false;\n    }\n\n    this._sender.send(data || EMPTY_BUFFER, opts, cb);\n  }\n\n  /**\n   * Forcibly close the connection.\n   *\n   * @public\n   */\n  terminate() {\n    if (this.readyState === WebSocket.CLOSED) return;\n    if (this.readyState === WebSocket.CONNECTING) {\n      const msg = 'WebSocket was closed before the connection was established';\n      return abortHandshake(this, this._req, msg);\n    }\n\n    if (this._socket) {\n      this._readyState = WebSocket.CLOSING;\n      this._socket.destroy();\n    }\n  }\n}\n\nreadyStates.forEach((readyState, i) => {\n  const descriptor = { enumerable: true, value: i };\n\n  Object.defineProperty(WebSocket.prototype, readyState, descriptor);\n  Object.defineProperty(WebSocket, readyState, descriptor);\n});\n\n[\n  'binaryType',\n  'bufferedAmount',\n  'extensions',\n  'protocol',\n  'readyState',\n  'url'\n].forEach((property) => {\n  Object.defineProperty(WebSocket.prototype, property, { enumerable: true });\n});\n\n//\n// Add the `onopen`, `onerror`, `onclose`, and `onmessage` attributes.\n// See https://html.spec.whatwg.org/multipage/comms.html#the-websocket-interface\n//\n['open', 'error', 'close', 'message'].forEach((method) => {\n  Object.defineProperty(WebSocket.prototype, `on${method}`, {\n    configurable: true,\n    enumerable: true,\n    /**\n     * Return the listener of the event.\n     *\n     * @return {(Function|undefined)} The event listener or `undefined`\n     * @public\n     */\n    get() {\n      const listeners = this.listeners(method);\n      for (let i = 0; i < listeners.length; i++) {\n        if (listeners[i]._listener) return listeners[i]._listener;\n      }\n\n      return undefined;\n    },\n    /**\n     * Add a listener for the event.\n     *\n     * @param {Function} listener The listener to add\n     * @public\n     */\n    set(listener) {\n      const listeners = this.listeners(method);\n      for (let i = 0; i < listeners.length; i++) {\n        //\n        // Remove only the listeners added via `addEventListener`.\n        //\n        if (listeners[i]._listener) this.removeListener(method, listeners[i]);\n      }\n      this.addEventListener(method, listener);\n    }\n  });\n});\n\nWebSocket.prototype.addEventListener = addEventListener;\nWebSocket.prototype.removeEventListener = removeEventListener;\n\nmodule.exports = WebSocket;\n\n/**\n * Initialize a WebSocket client.\n *\n * @param {WebSocket} websocket The client to initialize\n * @param {(String|url.URL)} address The URL to which to connect\n * @param {String} [protocols] The subprotocols\n * @param {Object} [options] Connection options\n * @param {(Boolean|Object)} [options.perMessageDeflate=true] Enable/disable\n *     permessage-deflate\n * @param {Number} [options.handshakeTimeout] Timeout in milliseconds for the\n *     handshake request\n * @param {Number} [options.protocolVersion=13] Value of the\n *     `Sec-WebSocket-Version` header\n * @param {String} [options.origin] Value of the `Origin` or\n *     `Sec-WebSocket-Origin` header\n * @param {Number} [options.maxPayload=104857600] The maximum allowed message\n *     size\n * @param {Boolean} [options.followRedirects=false] Whether or not to follow\n *     redirects\n * @param {Number} [options.maxRedirects=10] The maximum number of redirects\n *     allowed\n * @private\n */\nfunction initAsClient(websocket, address, protocols, options) {\n  const opts = {\n    protocolVersion: protocolVersions[1],\n    maxPayload: 100 * 1024 * 1024,\n    perMessageDeflate: true,\n    followRedirects: false,\n    maxRedirects: 10,\n    ...options,\n    createConnection: undefined,\n    socketPath: undefined,\n    hostname: undefined,\n    protocol: undefined,\n    timeout: undefined,\n    method: undefined,\n    host: undefined,\n    path: undefined,\n    port: undefined\n  };\n\n  if (!protocolVersions.includes(opts.protocolVersion)) {\n    throw new RangeError(\n      `Unsupported protocol version: ${opts.protocolVersion} ` +\n        `(supported versions: ${protocolVersions.join(', ')})`\n    );\n  }\n\n  let parsedUrl;\n\n  if (address instanceof URL) {\n    parsedUrl = address;\n    websocket._url = address.href;\n  } else {\n    parsedUrl = new URL(address);\n    websocket._url = address;\n  }\n\n  const isUnixSocket = parsedUrl.protocol === 'ws+unix:';\n\n  if (!parsedUrl.host && (!isUnixSocket || !parsedUrl.pathname)) {\n    throw new Error(`Invalid URL: ${websocket.url}`);\n  }\n\n  const isSecure =\n    parsedUrl.protocol === 'wss:' || parsedUrl.protocol === 'https:';\n  const defaultPort = isSecure ? 443 : 80;\n  const key = randomBytes(16).toString('base64');\n  const get = isSecure ? https.get : http.get;\n  let perMessageDeflate;\n\n  opts.createConnection = isSecure ? tlsConnect : netConnect;\n  opts.defaultPort = opts.defaultPort || defaultPort;\n  opts.port = parsedUrl.port || defaultPort;\n  opts.host = parsedUrl.hostname.startsWith('[')\n    ? parsedUrl.hostname.slice(1, -1)\n    : parsedUrl.hostname;\n  opts.headers = {\n    'Sec-WebSocket-Version': opts.protocolVersion,\n    'Sec-WebSocket-Key': key,\n    Connection: 'Upgrade',\n    Upgrade: 'websocket',\n    ...opts.headers\n  };\n  opts.path = parsedUrl.pathname + parsedUrl.search;\n  opts.timeout = opts.handshakeTimeout;\n\n  if (opts.perMessageDeflate) {\n    perMessageDeflate = new PerMessageDeflate(\n      opts.perMessageDeflate !== true ? opts.perMessageDeflate : {},\n      false,\n      opts.maxPayload\n    );\n    opts.headers['Sec-WebSocket-Extensions'] = format({\n      [PerMessageDeflate.extensionName]: perMessageDeflate.offer()\n    });\n  }\n  if (protocols) {\n    opts.headers['Sec-WebSocket-Protocol'] = protocols;\n  }\n  if (opts.origin) {\n    if (opts.protocolVersion < 13) {\n      opts.headers['Sec-WebSocket-Origin'] = opts.origin;\n    } else {\n      opts.headers.Origin = opts.origin;\n    }\n  }\n  if (parsedUrl.username || parsedUrl.password) {\n    opts.auth = `${parsedUrl.username}:${parsedUrl.password}`;\n  }\n\n  if (isUnixSocket) {\n    const parts = opts.path.split(':');\n\n    opts.socketPath = parts[0];\n    opts.path = parts[1];\n  }\n\n  let req = (websocket._req = get(opts));\n\n  if (opts.timeout) {\n    req.on('timeout', () => {\n      abortHandshake(websocket, req, 'Opening handshake has timed out');\n    });\n  }\n\n  req.on('error', (err) => {\n    if (req === null || req.aborted) return;\n\n    req = websocket._req = null;\n    websocket._readyState = WebSocket.CLOSING;\n    websocket.emit('error', err);\n    websocket.emitClose();\n  });\n\n  req.on('response', (res) => {\n    const location = res.headers.location;\n    const statusCode = res.statusCode;\n\n    if (\n      location &&\n      opts.followRedirects &&\n      statusCode >= 300 &&\n      statusCode < 400\n    ) {\n      if (++websocket._redirects > opts.maxRedirects) {\n        abortHandshake(websocket, req, 'Maximum redirects exceeded');\n        return;\n      }\n\n      req.abort();\n\n      const addr = new URL(location, address);\n\n      initAsClient(websocket, addr, protocols, options);\n    } else if (!websocket.emit('unexpected-response', req, res)) {\n      abortHandshake(\n        websocket,\n        req,\n        `Unexpected server response: ${res.statusCode}`\n      );\n    }\n  });\n\n  req.on('upgrade', (res, socket, head) => {\n    websocket.emit('upgrade', res);\n\n    //\n    // The user may have closed the connection from a listener of the `upgrade`\n    // event.\n    //\n    if (websocket.readyState !== WebSocket.CONNECTING) return;\n\n    req = websocket._req = null;\n\n    const digest = createHash('sha1')\n      .update(key + GUID)\n      .digest('base64');\n\n    if (res.headers['sec-websocket-accept'] !== digest) {\n      abortHandshake(websocket, socket, 'Invalid Sec-WebSocket-Accept header');\n      return;\n    }\n\n    const serverProt = res.headers['sec-websocket-protocol'];\n    const protList = (protocols || '').split(/, */);\n    let protError;\n\n    if (!protocols && serverProt) {\n      protError = 'Server sent a subprotocol but none was requested';\n    } else if (protocols && !serverProt) {\n      protError = 'Server sent no subprotocol';\n    } else if (serverProt && !protList.includes(serverProt)) {\n      protError = 'Server sent an invalid subprotocol';\n    }\n\n    if (protError) {\n      abortHandshake(websocket, socket, protError);\n      return;\n    }\n\n    if (serverProt) websocket._protocol = serverProt;\n\n    if (perMessageDeflate) {\n      try {\n        const extensions = parse(res.headers['sec-websocket-extensions']);\n\n        if (extensions[PerMessageDeflate.extensionName]) {\n          perMessageDeflate.accept(extensions[PerMessageDeflate.extensionName]);\n          websocket._extensions[\n            PerMessageDeflate.extensionName\n          ] = perMessageDeflate;\n        }\n      } catch (err) {\n        abortHandshake(\n          websocket,\n          socket,\n          'Invalid Sec-WebSocket-Extensions header'\n        );\n        return;\n      }\n    }\n\n    websocket.setSocket(socket, head, opts.maxPayload);\n  });\n}\n\n/**\n * Create a `net.Socket` and initiate a connection.\n *\n * @param {Object} options Connection options\n * @return {net.Socket} The newly created socket used to start the connection\n * @private\n */\nfunction netConnect(options) {\n  options.path = options.socketPath;\n  return net.connect(options);\n}\n\n/**\n * Create a `tls.TLSSocket` and initiate a connection.\n *\n * @param {Object} options Connection options\n * @return {tls.TLSSocket} The newly created socket used to start the connection\n * @private\n */\nfunction tlsConnect(options) {\n  options.path = undefined;\n\n  if (!options.servername && options.servername !== '') {\n    options.servername = net.isIP(options.host) ? '' : options.host;\n  }\n\n  return tls.connect(options);\n}\n\n/**\n * Abort the handshake and emit an error.\n *\n * @param {WebSocket} websocket The WebSocket instance\n * @param {(http.ClientRequest|net.Socket)} stream The request to abort or the\n *     socket to destroy\n * @param {String} message The error message\n * @private\n */\nfunction abortHandshake(websocket, stream, message) {\n  websocket._readyState = WebSocket.CLOSING;\n\n  const err = new Error(message);\n  Error.captureStackTrace(err, abortHandshake);\n\n  if (stream.setHeader) {\n    stream.abort();\n\n    if (stream.socket && !stream.socket.destroyed) {\n      //\n      // On Node.js >= 14.3.0 `request.abort()` does not destroy the socket if\n      // called after the request completed. See\n      // https://github.com/websockets/ws/issues/1869.\n      //\n      stream.socket.destroy();\n    }\n\n    stream.once('abort', websocket.emitClose.bind(websocket));\n    websocket.emit('error', err);\n  } else {\n    stream.destroy(err);\n    stream.once('error', websocket.emit.bind(websocket, 'error'));\n    stream.once('close', websocket.emitClose.bind(websocket));\n  }\n}\n\n/**\n * Handle cases where the `ping()`, `pong()`, or `send()` methods are called\n * when the `readyState` attribute is `CLOSING` or `CLOSED`.\n *\n * @param {WebSocket} websocket The WebSocket instance\n * @param {*} [data] The data to send\n * @param {Function} [cb] Callback\n * @private\n */\nfunction sendAfterClose(websocket, data, cb) {\n  if (data) {\n    const length = toBuffer(data).length;\n\n    //\n    // The `_bufferedAmount` property is used only when the peer is a client and\n    // the opening handshake fails. Under these circumstances, in fact, the\n    // `setSocket()` method is not called, so the `_socket` and `_sender`\n    // properties are set to `null`.\n    //\n    if (websocket._socket) websocket._sender._bufferedBytes += length;\n    else websocket._bufferedAmount += length;\n  }\n\n  if (cb) {\n    const err = new Error(\n      `WebSocket is not open: readyState ${websocket.readyState} ` +\n        `(${readyStates[websocket.readyState]})`\n    );\n    cb(err);\n  }\n}\n\n/**\n * The listener of the `Receiver` `'conclude'` event.\n *\n * @param {Number} code The status code\n * @param {String} reason The reason for closing\n * @private\n */\nfunction receiverOnConclude(code, reason) {\n  const websocket = this[kWebSocket];\n\n  websocket._socket.removeListener('data', socketOnData);\n  websocket._socket.resume();\n\n  websocket._closeFrameReceived = true;\n  websocket._closeMessage = reason;\n  websocket._closeCode = code;\n\n  if (code === 1005) websocket.close();\n  else websocket.close(code, reason);\n}\n\n/**\n * The listener of the `Receiver` `'drain'` event.\n *\n * @private\n */\nfunction receiverOnDrain() {\n  this[kWebSocket]._socket.resume();\n}\n\n/**\n * The listener of the `Receiver` `'error'` event.\n *\n * @param {(RangeError|Error)} err The emitted error\n * @private\n */\nfunction receiverOnError(err) {\n  const websocket = this[kWebSocket];\n\n  websocket._socket.removeListener('data', socketOnData);\n\n  websocket._readyState = WebSocket.CLOSING;\n  websocket._closeCode = err[kStatusCode];\n  websocket.emit('error', err);\n  websocket._socket.destroy();\n}\n\n/**\n * The listener of the `Receiver` `'finish'` event.\n *\n * @private\n */\nfunction receiverOnFinish() {\n  this[kWebSocket].emitClose();\n}\n\n/**\n * The listener of the `Receiver` `'message'` event.\n *\n * @param {(String|Buffer|ArrayBuffer|Buffer[])} data The message\n * @private\n */\nfunction receiverOnMessage(data) {\n  this[kWebSocket].emit('message', data);\n}\n\n/**\n * The listener of the `Receiver` `'ping'` event.\n *\n * @param {Buffer} data The data included in the ping frame\n * @private\n */\nfunction receiverOnPing(data) {\n  const websocket = this[kWebSocket];\n\n  websocket.pong(data, !websocket._isServer, NOOP);\n  websocket.emit('ping', data);\n}\n\n/**\n * The listener of the `Receiver` `'pong'` event.\n *\n * @param {Buffer} data The data included in the pong frame\n * @private\n */\nfunction receiverOnPong(data) {\n  this[kWebSocket].emit('pong', data);\n}\n\n/**\n * The listener of the `net.Socket` `'close'` event.\n *\n * @private\n */\nfunction socketOnClose() {\n  const websocket = this[kWebSocket];\n\n  this.removeListener('close', socketOnClose);\n  this.removeListener('end', socketOnEnd);\n\n  websocket._readyState = WebSocket.CLOSING;\n\n  //\n  // The close frame might not have been received or the `'end'` event emitted,\n  // for example, if the socket was destroyed due to an error. Ensure that the\n  // `receiver` stream is closed after writing any remaining buffered data to\n  // it. If the readable side of the socket is in flowing mode then there is no\n  // buffered data as everything has been already written and `readable.read()`\n  // will return `null`. If instead, the socket is paused, any possible buffered\n  // data will be read as a single chunk and emitted synchronously in a single\n  // `'data'` event.\n  //\n  websocket._socket.read();\n  websocket._receiver.end();\n\n  this.removeListener('data', socketOnData);\n  this[kWebSocket] = undefined;\n\n  clearTimeout(websocket._closeTimer);\n\n  if (\n    websocket._receiver._writableState.finished ||\n    websocket._receiver._writableState.errorEmitted\n  ) {\n    websocket.emitClose();\n  } else {\n    websocket._receiver.on('error', receiverOnFinish);\n    websocket._receiver.on('finish', receiverOnFinish);\n  }\n}\n\n/**\n * The listener of the `net.Socket` `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction socketOnData(chunk) {\n  if (!this[kWebSocket]._receiver.write(chunk)) {\n    this.pause();\n  }\n}\n\n/**\n * The listener of the `net.Socket` `'end'` event.\n *\n * @private\n */\nfunction socketOnEnd() {\n  const websocket = this[kWebSocket];\n\n  websocket._readyState = WebSocket.CLOSING;\n  websocket._receiver.end();\n  this.end();\n}\n\n/**\n * The listener of the `net.Socket` `'error'` event.\n *\n * @private\n */\nfunction socketOnError() {\n  const websocket = this[kWebSocket];\n\n  this.removeListener('error', socketOnError);\n  this.on('error', NOOP);\n\n  if (websocket) {\n    websocket._readyState = WebSocket.CLOSING;\n    this.destroy();\n  }\n}\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./log\"), exports);\n__exportStar(require(\"./utility\"), exports);\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Logger = void 0;\nvar Logger = /** @class */ (function () {\n    function Logger(module, level) {\n        this.module = module;\n        this.level = level;\n    }\n    Logger.prototype.parseLog = function (level, message, context) {\n        var _a;\n        var now = new Date();\n        var month = now.getMonth().toString().padStart(2, \"0\");\n        var day = now.getDay().toString().padStart(2, \"0\");\n        var hour = now.getHours().toString().padStart(2, \"0\");\n        var minute = now.getMinutes().toString().padStart(2, \"0\");\n        var second = now.getSeconds().toString().padStart(2, \"0\");\n        var millisecond = now.getMilliseconds().toString().padEnd(3, \"0\").slice(0, 3);\n        var logTime = month + \"-\" + day + \"|\" + hour + \":\" + minute + \":\" + second + \".\" + millisecond;\n        var colored = function (level, payload) {\n            // TODO coloring in Browser Console\n            return payload;\n        };\n        var contextLiteral = \"\";\n        if (context) {\n            for (var key in context) {\n                if (context.hasOwnProperty(key)) {\n                    // @ts-ignore\n                    contextLiteral += colored(level, key) + \"=\" + ((_a = context[key]) === null || _a === void 0 ? void 0 : _a.toString()) + \" \";\n                }\n            }\n        }\n        return colored(level, Logger.Level.levelString(level).padEnd(5, \" \")) + \"[\" + logTime + \"][\" + this.module + \"] \" + message.toString().padEnd(48, \" \") + \" \" + contextLiteral;\n    };\n    Logger.prototype.log = function (level, message, context) {\n        if (this.level <= level) {\n            switch (this.level) {\n                case Logger.Level.ERROR:\n                    console.error(this.parseLog(level, message, context));\n                    break;\n                case Logger.Level.WARN:\n                    console.warn(this.parseLog(level, message, context));\n                    break;\n                case Logger.Level.INFO:\n                    console.info(this.parseLog(level, message, context));\n                    break;\n                case Logger.Level.DEBUG:\n                    console.debug(this.parseLog(level, message, context));\n                    break;\n                default:\n                    console.log(this.parseLog(level, message, context));\n            }\n        }\n    };\n    Logger.prototype.info = function (message, context) {\n        this.log(Logger.Level.INFO, message, context);\n    };\n    Logger.prototype.warn = function (message, context) {\n        this.log(Logger.Level.WARN, message, context);\n    };\n    Logger.prototype.debug = function (message, context) {\n        this.log(Logger.Level.DEBUG, message, context);\n    };\n    Logger.prototype.error = function (message, context) {\n        this.log(Logger.Level.ERROR, message, context);\n    };\n    Logger.Level = {\n        DEBUG: 1,\n        INFO: 2,\n        WARN: 3,\n        ERROR: 4,\n        levelString: function (lvl) {\n            switch (lvl) {\n                case 1:\n                    return 'DEBUG';\n                case 2:\n                    return 'INFO';\n                case 3:\n                    return 'WARN';\n                case 4:\n                    return 'ERROR';\n                default:\n                    return 'UNKNOWN';\n            }\n        }\n    };\n    return Logger;\n}());\nexports.Logger = Logger;\n//# sourceMappingURL=log.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.prettifyHash = void 0;\nfunction prettifyHash(hash) {\n    var startIndex = 0;\n    if (hash.startsWith(\"0x\")) {\n        startIndex = 2;\n    }\n    return hash.substring(startIndex, startIndex + 6) + \"\\u2026\" + hash.substring(hash.length - 6, hash.length);\n}\nexports.prettifyHash = prettifyHash;\n//# sourceMappingURL=utility.js.map","import {Logger, prettifyHash} from \"@darcher/helpers-browser\";\nimport {Data} from \"./metamask-notifier\";\n\nexport interface SendTransactionTrace {\n    hash: string,\n    stack: string[],\n}\n\nexport interface StackTraceMessage extends Data {\n    type: 'FetchStackTrace',\n    stack: string[],\n}\n\nconst logger = new Logger(\"Trace\", Logger.Level.INFO);\n\nasync function oneTimeWebSocketRequest<T extends Data>(url: string, data: T): Promise<T> {\n    return new Promise<T>((resolve, reject) => {\n        const ws = new WebSocket(url);\n        ws.onopen = () => {\n            // send request\n            ws.send(JSON.stringify(data));\n        };\n        ws.onerror = (ev: ErrorEvent) => {\n            reject(ev);\n        }\n        ws.onmessage = (ev) => {\n            const msg = JSON.parse(ev.data) as T;\n            resolve(msg);\n            ws.close();\n        }\n    });\n}\n\nexport async function getStackTraceByCrawljax(): Promise<string[]> {\n    const resp = await oneTimeWebSocketRequest(\"ws://localhost:1237\", {\n        type: \"FetchStackTrace\",\n        stack: [],\n    } as StackTraceMessage);\n    return resp.stack;\n}\n\nexport interface TraceHistory {\n    method: string,\n    params: any[],\n    stack: string[] | null,\n}\n\ndeclare global {\n    interface Window {\n        traceHistories: TraceHistory[];\n    }\n}\n\nlet isBrowser;\nlet GLOBAL;\nif (typeof window !== 'undefined') {\n    GLOBAL = window;\n    isBrowser = true;\n} else if (typeof global !== \"undefined\") {\n    GLOBAL = global;\n    isBrowser = false;\n} else {\n    throw new Error(\"Failed to load trace-instrument\");\n}\n\nif (typeof GLOBAL !== 'undefined' && !GLOBAL.traceHistories) {\n    GLOBAL.traceHistories = [] as TraceHistory[];\n}\n\n\nexport function traceSendAsync(method: string, params: any[], callback: Function): Function {\n    const traceCache: TraceHistory = {\n        method: method,\n        params: params,\n        stack: null,\n    };\n    if (['eth_sendTransaction', 'eth_sendRawTransaction', 'eth_estimateGas'].includes(method)) {\n        const traceObj = {stack: undefined};\n        Error.captureStackTrace(traceObj, traceSendAsync);\n        callback = new Proxy(callback, {\n            apply(target, thisArg, argArray) {\n                if (method === 'eth_estimateGas') {\n                    // save gas\n                    traceCache.params[0].gas = argArray[1];\n                    // save to history, in case there is a transaction use this call later\n                    traceCache.stack = traceObj.stack.split(/\\n/).map(item => item.trim()).filter(item => item.length > 0 && item !== \"Error\");\n                    GLOBAL.traceHistories.push(traceCache);\n                } else if (['eth_sendTransaction', 'eth_sendRawTransaction'].includes(method)) {\n                    // search trace history for a possible estimateGas cache (which is more precise)\n                    for (let i = GLOBAL.traceHistories.length - 1; i >= 0; i--) {\n                        const history = GLOBAL.traceHistories[i];\n                        if (history.method === 'eth_estimateGas' &&\n                            history.params[0] && params[0] &&\n                            history.params[0].from === params[0].from &&\n                            history.params[0].to === params[0].to &&\n                            history.params[0].data === params[0].data\n                        ) {\n                            // delete this from history\n                            GLOBAL.traceHistories = GLOBAL.traceHistories.filter(value => value !== history);\n                            // use the stack trace of this cache\n                            traceCache.stack = history.stack;\n                            break;\n                        }\n                    }\n                    if (!traceCache.stack) {\n                        // no history found, use current one\n                        traceCache.stack = traceObj.stack.split(/\\n/).map(item => item.trim()).filter(item => item.length > 0 && item !== \"Error\");\n                    }\n                    // send trace to server\n                    const trace = {\n                        hash: typeof argArray[1] === \"string\" ? argArray[1] : argArray[1].result,\n                        stack: traceCache.stack,\n                    } as SendTransactionTrace;\n                    logger.info(\"Transaction trace\", {hash: trace.hash, stack: trace.stack})\n                    if (isBrowser) {\n                        const ws = new WebSocket(`ws://localhost:1236`);\n                        ws.onopen = () => {\n                            ws.send(JSON.stringify(trace));\n                        };\n                        ws.onerror = (ev: ErrorEvent) => {\n                            logger.error(\"Send transaction trace error\", {err: ev});\n                        }\n                        ws.onmessage = () => {\n                            ws.close();\n                        }\n                    } else {\n                        const WebSocket = require(\"ws\");\n                        const ws = new WebSocket(\"ws://localhost:1236\");\n                        ws.on('open', () => {\n                            ws.send(JSON.stringify(trace));\n                        });\n                        ws.on(\"error\", e => {\n                            logger.error(\"Send transaction trace error\", {err: e});\n                        });\n                        ws.on(\"message\", () => {\n                            ws.close();\n                        });\n                    }\n\n                }\n                target.apply(thisArg, argArray);\n            },\n        });\n    }\n    return callback;\n}\n\nexport function traceSend(method: string, result: string) {\n    if ((method === 'eth_sendTransaction' || method === 'eth_sendRawTransaction')) {\n        const traceObj = {stack: undefined};\n        Error.captureStackTrace(traceObj, traceSendAsync);\n        const trace = {\n            hash: result,\n            stack: traceObj.stack.split(/\\n/).map(item => item.trim()).filter(item => item.length > 0 && item !== \"Error\"),\n        } as SendTransactionTrace;\n        logger.info(\"Transaction trace\", {hash: prettifyHash(trace.hash), stack: trace.stack});\n        const ws = new WebSocket(`ws://localhost:1236`);\n        ws.onopen = () => {\n            ws.send(JSON.stringify(trace));\n        };\n        ws.onerror = (ev: ErrorEvent) => {\n            logger.error(\"Send transaction trace error\", {err: ev});\n        }\n        ws.onmessage = () => {\n            ws.close();\n        }\n    }\n}\n","module.exports = require(\"crypto\");;","module.exports = require(\"events\");;","module.exports = require(\"fs\");;","module.exports = require(\"http\");;","module.exports = require(\"https\");;","module.exports = require(\"net\");;","module.exports = require(\"os\");;","module.exports = require(\"path\");;","module.exports = require(\"stream\");;","module.exports = require(\"tls\");;","module.exports = require(\"url\");;","module.exports = require(\"zlib\");;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(846);\n"],"sourceRoot":""}